| Клон-группа | Действие | Риск | Проверка | Артефакт |
| --- | --- | --- | --- | --- |
| CLI command factories (ChEMBL pipelines) | Вынести общую функцию `build_chembl_command` в `bioetl.cli.command_factories` с параметрами имени пайплайна, класса и описания; модули `chembl_activity`, `chembl_assay`, `chembl_testitem` заменяют локальные фабрики на вызов helper. | Ошибочное значение путей по умолчанию; потеря индивидуальных описаний. | Запустить `pytest tests/e2e/test_cli_golden.py::test_changing_pipeline_defaults` и проверить генерацию CLI help. | patches/0001-cli-chembl-command-factory.diff |
| CLI command factories (literature/external pipelines) | Создать универсальную функцию `build_simple_command` принимающую имя пайплайна и путь к конфигу; использовать в `openalex`, `pubmed`, `crossref`, `semantic_scholar`, `uniprot_protein`, `pubchem_molecule`. | Нарушение совместимости CLI из-за неверных путей конфигурации. | `pytest tests/e2e/test_cli_golden.py` и ручная проверка `python -m bioetl.cli --help`. | patches/0002-cli-simple-command-factory.diff |
| Lazy экспорт фасады (`bioetl.pipelines` / `bioetl.schemas`) | Вынести общий helper `lazy_module_export(__all__, mapping, package_name)` в `bioetl.utils.module_exports` и использовать в обоих `__init__` чтобы убрать дублированные `__getattr__`/`__dir__`. | Преждевременный импорт тяжелых модулей при ошибочной реализации helper. | `pytest tests/unit/test_pipelines.py::test_lazy_exports` и `pytest tests/unit/schemas/test_registry.py`. | patches/0003-lazy-export-helper.diff |
| Schema Config повторения | Добавить базовый класс `StrictDataFrameModel(pa.DataFrameModel)` с вложенным `Config` и переиспользовать его в схемах вместо локальных `Config`. | Возможные побочные эффекты если отдельным схемам требуются отличные настройки Pandera. | `pytest tests/unit/schemas` и `pytest tests/integration/pipelines/test_extended_mode_outputs.py`. | patches/0004-strict-schema-base.diff |
| Конфигурации pipeline `pipeline`/`materialization` блоки | Вынести общие ключи в YAML include (`includes/pipeline_defaults.yaml`) и заменить повторяющиеся блоки ссылками в соответствующих конфигурациях. | Неправильное разрешение относительных путей YAML `extends`. | `python -m bioetl.config.validator --config configs/pipelines/<name>.yaml` (проверка загрузки). | patches/0005-pipeline-config-includes.diff |
| Финализаторы ресурсов `close_resources` | Добавить в `PipelineBase` и внешние пайплайны общую реализацию `close_resources` с поддержкой регистрации cleanup callbacks; удалить пустые overrides. | Непреднамеренное удержание ресурсов, если конкретные пайплайны ожидали side-effects в override. | `pytest tests/integration/pipelines/test_bit_identical_output.py` и `pytest tests/unit/test_pipelines.py`. | patches/0006-pipeline-close-resources.diff |
