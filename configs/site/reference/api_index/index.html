
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://satorykono.github.io/bioactivity_data_acquisition/reference/api_index/">
      
      
        <link rel="prev" href="../../quality/qc_checklist/">
      
      
        <link rel="next" href="../../guides/howto_add_pipeline/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>API - Bioactivity Data Acquisition</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href="../.." title="Bioactivity Data Acquisition" class="md-header__button md-logo" aria-label="Bioactivity Data Acquisition" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Bioactivity Data Acquisition
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Поиск">
        
        <button type="reset" class="md-search__icon md-icon" title="Очистить" aria-label="Очистить" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Инициализация поиска
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/SatoryKono/bioactivity_data_acquisition" title="Перейти к репозиторию" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    SatoryKono/bioactivity_data_acquisition
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Вкладки" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Обзор

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../architecture/" class="md-tabs__link">
        
  
  
    
  
  Архитектура

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../setup/install/" class="md-tabs__link">
          
  
  
    
  
  Установка и настройка

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../pipelines/documents/" class="md-tabs__link">
          
  
  
    
  
  Пайплайны

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../operations/makefiles/" class="md-tabs__link">
          
  
  
    
  
  Операции

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../quality/validation/" class="md-tabs__link">
          
  
  
    
  
  Контроль качества

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
    
  
  Справочник

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/howto_add_pipeline/" class="md-tabs__link">
          
  
  
    
  
  Руководства

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Bioactivity Data Acquisition" class="md-nav__button md-logo" aria-label="Bioactivity Data Acquisition" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Bioactivity Data Acquisition
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/SatoryKono/bioactivity_data_acquisition" title="Перейти к репозиторию" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    SatoryKono/bioactivity_data_acquisition
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Обзор
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Архитектура
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Установка и настройка
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Установка и настройка
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Установка
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Конфигурация
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Пайплайны
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Пайплайны
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipelines/documents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipelines/activities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Activities
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipelines/targets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Targets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipelines/assays/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assays
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipelines/testitems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testitems
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Операции
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Операции
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/makefiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Makefiles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/ci-cd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CI/CD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Контроль качества
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Контроль качества
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quality/validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Валидация
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quality/qc_checklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    QC Чек-листы
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Справочник
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Справочник
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      Пайплайны
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Пайплайны">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#documents" class="md-nav__link">
    <span class="md-ellipsis">
      Documents
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.documents.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.DocumentETLResult" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentETLResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.DocumentHTTPError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentHTTPError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.DocumentIOError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentIOError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.DocumentPipelineError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentPipelineError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.DocumentQCError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentQCError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.DocumentValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentValidationError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.read_document_input" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;read_document_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.run_document_etl" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_document_etl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.write_document_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;write_document_outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#targets" class="md-nav__link">
    <span class="md-ellipsis">
      Targets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.target.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.target.pipeline-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.target.pipeline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assays" class="md-nav__link">
    <span class="md-ellipsis">
      Assays
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.assay.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.AssayETLResult" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayETLResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.AssayHTTPError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayHTTPError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.AssayIOError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayIOError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.AssayPipelineError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayPipelineError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.AssayQCError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayQCError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.AssayValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayValidationError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.read_assay_input" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;read_assay_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.run_assay_etl" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_assay_etl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.write_assay_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;write_assay_outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activities" class="md-nav__link">
    <span class="md-ellipsis">
      Activities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.activity.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityHTTPError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ActivityHTTPError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityIOError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ActivityIOError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityPipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ActivityPipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ActivityPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityPipeline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityPipeline.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityPipelineError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ActivityPipelineError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityQCError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ActivityQCError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ActivityValidationError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.run_activity_etl" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_activity_etl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testitems" class="md-nav__link">
    <span class="md-ellipsis">
      Testitems
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.testitem.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.TestitemETLResult" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemETLResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.TestitemHTTPError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemHTTPError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.TestitemIOError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemIOError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.TestitemPipelineError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemPipelineError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.TestitemQCError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemQCError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.TestitemValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemValidationError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.read_testitem_input" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;read_testitem_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.run_testitem_etl" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_testitem_etl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.write_testitem_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;write_testitem_outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      Клиенты
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Клиенты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chembl" class="md-nav__link">
    <span class="md-ellipsis">
      ChEMBL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.clients.chembl" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;chembl
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" chembl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.ChEMBLClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ChEMBLClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ChEMBLClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.ChEMBLClient-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.ChEMBLClient.fetch_by_doc_id" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_doc_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.ChEMBLClient.fetch_documents_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_documents_batch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemChEMBLClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestitemChEMBLClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_atc_classification" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_atc_classification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_atc_classification_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_atc_classification_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_compound_synonym" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_compound_synonym
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_drug" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_drug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_drug_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_drug_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_drug_warning" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_drug_warning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_drug_warning_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_drug_warning_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_mechanism
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_mechanism_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_mechanism_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecule" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_molecule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecule_form" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_molecule_form
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecule_properties" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_molecule_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecule_properties_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_molecule_properties_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecules_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_molecules_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecules_batch_streaming" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_molecules_batch_streaming
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_xref_source" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_xref_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.get_chembl_status" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_chembl_status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.resolve_molregno_to_chembl_id" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;resolve_molregno_to_chembl_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crossref" class="md-nav__link">
    <span class="md-ellipsis">
      Crossref
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.clients.crossref" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;crossref
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" crossref">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref.CrossrefClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CrossrefClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" CrossrefClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref.CrossrefClient-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref.CrossrefClient.fetch_by_doi" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_doi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref.CrossrefClient.fetch_by_dois_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_dois_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref.CrossrefClient.fetch_by_pmid" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_pmid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref.CrossrefClient.fetch_by_pmids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_pmids_batch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openalex" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAlex
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.clients.openalex" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;openalex
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" openalex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex.OpenAlexClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;OpenAlexClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" OpenAlexClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex.OpenAlexClient-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex.OpenAlexClient.fetch_by_doi" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_doi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex.OpenAlexClient.fetch_by_dois_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_dois_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex.OpenAlexClient.fetch_by_pmid" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_pmid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex.OpenAlexClient.fetch_by_pmids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_pmids_batch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pubmed" class="md-nav__link">
    <span class="md-ellipsis">
      PubMed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.clients.pubmed" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pubmed
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pubmed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.pubmed-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.pubmed.PubMedClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PubMedClient
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#semantic-scholar" class="md-nav__link">
    <span class="md-ellipsis">
      Semantic Scholar
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.clients.semantic_scholar" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;semantic_scholar
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" semantic_scholar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.semantic_scholar-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.semantic_scholar.SemanticScholarClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SemanticScholarClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SemanticScholarClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.semantic_scholar.SemanticScholarClient-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.semantic_scholar.SemanticScholarClient.fetch_by_pmids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_pmids_batch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pubchem" class="md-nav__link">
    <span class="md-ellipsis">
      PubChem
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.clients.pubchem" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pubchem
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pubchem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PubChemClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" PubChemClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_cids_by_inchikey" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_cids_by_inchikey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_cids_by_smiles" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_cids_by_smiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_compound_by_name" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_compound_by_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_compound_properties" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_compound_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_compound_synonyms" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_compound_synonyms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_compound_xrefs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_compound_xrefs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_compounds_properties_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_compounds_properties_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_record_smiles" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_record_smiles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      Схемы валидации
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Схемы валидации">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      Документы
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.document_input_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;document_input_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" document_input_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.document_input_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.document_input_schema.DocumentInputSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentInputSchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.document_output_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;document_output_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" document_output_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.document_output_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.document_output_schema.DocumentOutputSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentOutputSchema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.schemas.document_output_schema.DocumentQCSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentQCSchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      Активности
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.input_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;input_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" input_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.input_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.input_schema.RawBioactivitySchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RawBioactivitySchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.output_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;output_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" output_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.output_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.output_schema.NormalizedBioactivitySchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;NormalizedBioactivitySchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#targets_1" class="md-nav__link">
    <span class="md-ellipsis">
      Targets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.target_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;target_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" target_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.target_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.target_schema.TargetInputSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TargetInputSchema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.schemas.target_schema.TargetNormalizedSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TargetNormalizedSchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assays_1" class="md-nav__link">
    <span class="md-ellipsis">
      Assays
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.assay_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;assay_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" assay_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.assay_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.assay_schema.AssayInputSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayInputSchema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.schemas.assay_schema.AssayNormalizedSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayNormalizedSchema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.schemas.assay_schema.AssayRawSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayRawSchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testitems_1" class="md-nav__link">
    <span class="md-ellipsis">
      Testitems
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.testitem_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;testitem_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" testitem_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.testitem_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.testitem_schema.TestitemInputSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemInputSchema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.schemas.testitem_schema.TestitemNormalizedSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemNormalizedSchema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.schemas.testitem_schema.TestitemRawSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemRawSchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#etl" class="md-nav__link">
    <span class="md-ellipsis">
      ETL утилиты
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ETL утилиты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extract" class="md-nav__link">
    <span class="md-ellipsis">
      Extract
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.etl.extract" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;extract
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" extract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.extract-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.extract-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.extract.fetch_bioactivity_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;fetch_bioactivity_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transform" class="md-nav__link">
    <span class="md-ellipsis">
      Transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.etl.transform" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;transform
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" transform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.transform-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.transform-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.transform.normalize_bioactivity_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;normalize_bioactivity_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load" class="md-nav__link">
    <span class="md-ellipsis">
      Load
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.etl.load" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;load
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" load">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.load-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.load-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.load.write_deterministic_csv" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;write_deterministic_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.load.write_qc_artifacts" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;write_qc_artifacts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qc" class="md-nav__link">
    <span class="md-ellipsis">
      QC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.etl.qc" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;qc
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" qc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.qc-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_correlation_insights_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_correlation_insights_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_correlation_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_correlation_matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_enhanced_correlation_analysis_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_correlation_analysis_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_enhanced_correlation_reports_df" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_correlation_reports_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_enhanced_qc_detailed_reports" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_qc_detailed_reports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_enhanced_qc_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_qc_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_qc_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_qc_report
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;enhanced_qc
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" enhanced_qc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;EnhancedTableQualityProfiler
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" EnhancedTableQualityProfiler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler.consume" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;consume
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler.generate_detailed_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;generate_detailed_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler.generate_summary_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;generate_summary_report
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.build_enhanced_qc_detailed" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_qc_detailed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.build_enhanced_qc_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_qc_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.build_enhanced_qc_summary" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_qc_summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      Конфигурация
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.config" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;config
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.APIClientConfig" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;APIClientConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.Config" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Config
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.Config-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.Config.load" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.Config.parse_cli_overrides" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;parse_cli_overrides
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.ConsoleLoggingSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ConsoleLoggingSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.CorrelationSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CorrelationSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.CsvFormatSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CsvFormatSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.DeterminismSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DeterminismSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.FileLoggingSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FileLoggingSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPGlobalSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;HTTPGlobalSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" HTTPGlobalSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPGlobalSettings-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPGlobalSettings.timeout" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;timeout
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;HTTPSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPSourceSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;HTTPSourceSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" HTTPSourceSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPSourceSettings-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPSourceSettings.timeout" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;timeout
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.IOSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;IOSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.InputSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;InputSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.LoggingSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LoggingSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.OutputSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;OutputSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.PaginationSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PaginationSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.ParquetFormatSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ParquetFormatSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.PostprocessSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PostprocessSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.QCStepSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;QCStepSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.QCValidationSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;QCValidationSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.RateLimitSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RateLimitSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.RetrySettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RetrySettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RetrySettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.RetrySettings-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.RetrySettings.max_tries" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;max_tries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.RuntimeSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RuntimeSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.SortSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SortSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.SourceSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SourceSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.TransformSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TransformSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.ValidationSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ValidationSettings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.ensure_output_directories_exist" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;ensure_output_directories_exist
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli" class="md-nav__link">
    <span class="md-ellipsis">
      CLI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.cli" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;cli
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" cli">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.cli-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.cli.ExitCode" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ExitCode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.TestitemExitCode" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemExitCode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.cli.get_activity_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_activity_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.get_document_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_document_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.get_target_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_target_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.health" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;health
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.install_completion" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;install_completion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.main" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.testitem_info" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;testitem_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.testitem_run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;testitem_run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.testitem_validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;testitem_validate_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.version" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;version
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      Утилиты
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Утилиты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      Логирование
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.logging_setup" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;logging_setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" logging_setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.AddContextFilter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AddContextFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AddContextFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.AddContextFilter-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.AddContextFilter.filter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;filter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.RedactSecretsFilter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RedactSecretsFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RedactSecretsFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.RedactSecretsFilter-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.RedactSecretsFilter.filter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;filter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.bind_stage" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;bind_stage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.cleanup_old_logs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;cleanup_old_logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.configure_logging" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;configure_logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.generate_run_id" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;generate_run_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.get_logger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.get_run_context" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_run_context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.set_run_context" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;set_run_context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      Телеметрия
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.telemetry" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;telemetry
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" telemetry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.telemetry-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.telemetry.TraceContextManager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TraceContextManager
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.telemetry.add_span_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;add_span_attribute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.add_span_event" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;add_span_event
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.get_current_span_id" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_current_span_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.get_current_trace_id" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_current_trace_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.instrument_api_client" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;instrument_api_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.instrument_etl_stage" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;instrument_etl_stage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.setup_telemetry" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;setup_telemetry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.traced_operation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;traced_operation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      Примеры использования
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Примеры использования">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      Базовое использование
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      Работа с клиентами
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      Валидация данных
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      Конфигурация
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      Типы данных
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Типы данных">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      Основные типы
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      Перечисления
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      Исключения
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Исключения">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      Основные исключения
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      Обработка исключений
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      Константы
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Константы">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      API константы
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      Константы валидации
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      Утилиты
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Утилиты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      Функции работы с данными
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      Функции работы с файлами
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      Функции логирования
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api_1" class="md-nav__link">
    <span class="md-ellipsis">
      Расширение API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Расширение API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      Создание нового клиента
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      Создание новой схемы валидации
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      Создание нового пайплайна
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      Производительность
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Производительность">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      Оптимизация
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      Мониторинг
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      Безопасность
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Безопасность">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      Валидация входных данных
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      Обработка секретов
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Руководства
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Руководства
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/howto_add_pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Добавление пайплайна
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Устранение неполадок
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      Пайплайны
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Пайплайны">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#documents" class="md-nav__link">
    <span class="md-ellipsis">
      Documents
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.documents.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.DocumentETLResult" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentETLResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.DocumentHTTPError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentHTTPError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.DocumentIOError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentIOError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.DocumentPipelineError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentPipelineError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.DocumentQCError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentQCError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.DocumentValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentValidationError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.read_document_input" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;read_document_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.run_document_etl" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_document_etl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.documents.pipeline.write_document_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;write_document_outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#targets" class="md-nav__link">
    <span class="md-ellipsis">
      Targets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.target.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.target.pipeline-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.target.pipeline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assays" class="md-nav__link">
    <span class="md-ellipsis">
      Assays
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.assay.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.AssayETLResult" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayETLResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.AssayHTTPError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayHTTPError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.AssayIOError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayIOError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.AssayPipelineError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayPipelineError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.AssayQCError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayQCError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.AssayValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayValidationError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.read_assay_input" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;read_assay_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.run_assay_etl" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_assay_etl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.assay.pipeline.write_assay_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;write_assay_outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activities" class="md-nav__link">
    <span class="md-ellipsis">
      Activities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.activity.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityHTTPError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ActivityHTTPError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityIOError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ActivityIOError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityPipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ActivityPipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ActivityPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityPipeline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityPipeline.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityPipelineError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ActivityPipelineError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityQCError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ActivityQCError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.ActivityValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ActivityValidationError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.activity.pipeline.run_activity_etl" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_activity_etl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testitems" class="md-nav__link">
    <span class="md-ellipsis">
      Testitems
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.testitem.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.TestitemETLResult" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemETLResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.TestitemHTTPError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemHTTPError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.TestitemIOError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemIOError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.TestitemPipelineError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemPipelineError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.TestitemQCError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemQCError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.TestitemValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemValidationError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.read_testitem_input" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;read_testitem_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.run_testitem_etl" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;run_testitem_etl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.testitem.pipeline.write_testitem_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;write_testitem_outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      Клиенты
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Клиенты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chembl" class="md-nav__link">
    <span class="md-ellipsis">
      ChEMBL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.clients.chembl" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;chembl
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" chembl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.ChEMBLClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ChEMBLClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ChEMBLClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.ChEMBLClient-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.ChEMBLClient.fetch_by_doc_id" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_doc_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.ChEMBLClient.fetch_documents_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_documents_batch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemChEMBLClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" TestitemChEMBLClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_atc_classification" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_atc_classification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_atc_classification_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_atc_classification_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_compound_synonym" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_compound_synonym
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_drug" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_drug
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_drug_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_drug_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_drug_warning" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_drug_warning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_drug_warning_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_drug_warning_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_mechanism
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_mechanism_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_mechanism_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecule" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_molecule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecule_form" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_molecule_form
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecule_properties" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_molecule_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecule_properties_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_molecule_properties_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecules_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_molecules_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecules_batch_streaming" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_molecules_batch_streaming
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.fetch_xref_source" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_xref_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.get_chembl_status" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_chembl_status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.chembl.TestitemChEMBLClient.resolve_molregno_to_chembl_id" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;resolve_molregno_to_chembl_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crossref" class="md-nav__link">
    <span class="md-ellipsis">
      Crossref
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.clients.crossref" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;crossref
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" crossref">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref.CrossrefClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CrossrefClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" CrossrefClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref.CrossrefClient-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref.CrossrefClient.fetch_by_doi" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_doi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref.CrossrefClient.fetch_by_dois_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_dois_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref.CrossrefClient.fetch_by_pmid" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_pmid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.crossref.CrossrefClient.fetch_by_pmids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_pmids_batch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openalex" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAlex
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.clients.openalex" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;openalex
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" openalex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex.OpenAlexClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;OpenAlexClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" OpenAlexClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex.OpenAlexClient-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex.OpenAlexClient.fetch_by_doi" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_doi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex.OpenAlexClient.fetch_by_dois_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_dois_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex.OpenAlexClient.fetch_by_pmid" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_pmid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.openalex.OpenAlexClient.fetch_by_pmids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_pmids_batch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pubmed" class="md-nav__link">
    <span class="md-ellipsis">
      PubMed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.clients.pubmed" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pubmed
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pubmed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.pubmed-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.pubmed.PubMedClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PubMedClient
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#semantic-scholar" class="md-nav__link">
    <span class="md-ellipsis">
      Semantic Scholar
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.clients.semantic_scholar" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;semantic_scholar
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" semantic_scholar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.semantic_scholar-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.semantic_scholar.SemanticScholarClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SemanticScholarClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SemanticScholarClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.semantic_scholar.SemanticScholarClient-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.semantic_scholar.SemanticScholarClient.fetch_by_pmids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_by_pmids_batch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pubchem" class="md-nav__link">
    <span class="md-ellipsis">
      PubChem
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.clients.pubchem" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;pubchem
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" pubchem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PubChemClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" PubChemClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_cids_by_inchikey" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_cids_by_inchikey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_cids_by_smiles" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_cids_by_smiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_compound_by_name" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_compound_by_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_compound_properties" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_compound_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_compound_synonyms" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_compound_synonyms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_compound_xrefs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_compound_xrefs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_compounds_properties_batch" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_compounds_properties_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.clients.pubchem.PubChemClient.fetch_record_smiles" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fetch_record_smiles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      Схемы валидации
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Схемы валидации">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      Документы
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.document_input_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;document_input_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" document_input_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.document_input_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.document_input_schema.DocumentInputSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentInputSchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.document_output_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;document_output_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" document_output_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.document_output_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.document_output_schema.DocumentOutputSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentOutputSchema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.schemas.document_output_schema.DocumentQCSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DocumentQCSchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      Активности
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.input_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;input_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" input_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.input_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.input_schema.RawBioactivitySchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RawBioactivitySchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.output_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;output_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" output_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.output_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.output_schema.NormalizedBioactivitySchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;NormalizedBioactivitySchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#targets_1" class="md-nav__link">
    <span class="md-ellipsis">
      Targets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.target_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;target_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" target_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.target_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.target_schema.TargetInputSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TargetInputSchema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.schemas.target_schema.TargetNormalizedSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TargetNormalizedSchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assays_1" class="md-nav__link">
    <span class="md-ellipsis">
      Assays
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.assay_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;assay_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" assay_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.assay_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.assay_schema.AssayInputSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayInputSchema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.schemas.assay_schema.AssayNormalizedSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayNormalizedSchema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.schemas.assay_schema.AssayRawSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AssayRawSchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testitems_1" class="md-nav__link">
    <span class="md-ellipsis">
      Testitems
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.schemas.testitem_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;testitem_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" testitem_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.testitem_schema-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.schemas.testitem_schema.TestitemInputSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemInputSchema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.schemas.testitem_schema.TestitemNormalizedSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemNormalizedSchema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.schemas.testitem_schema.TestitemRawSchema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemRawSchema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#etl" class="md-nav__link">
    <span class="md-ellipsis">
      ETL утилиты
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ETL утилиты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extract" class="md-nav__link">
    <span class="md-ellipsis">
      Extract
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.etl.extract" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;extract
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" extract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.extract-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.extract-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.extract.fetch_bioactivity_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;fetch_bioactivity_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transform" class="md-nav__link">
    <span class="md-ellipsis">
      Transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.etl.transform" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;transform
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" transform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.transform-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.transform-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.transform.normalize_bioactivity_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;normalize_bioactivity_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load" class="md-nav__link">
    <span class="md-ellipsis">
      Load
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.etl.load" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;load
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" load">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.load-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.load-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.load.write_deterministic_csv" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;write_deterministic_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.load.write_qc_artifacts" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;write_qc_artifacts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qc" class="md-nav__link">
    <span class="md-ellipsis">
      QC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.etl.qc" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;qc
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" qc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.qc-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_correlation_insights_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_correlation_insights_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_correlation_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_correlation_matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_enhanced_correlation_analysis_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_correlation_analysis_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_enhanced_correlation_reports_df" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_correlation_reports_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_enhanced_qc_detailed_reports" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_qc_detailed_reports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_enhanced_qc_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_qc_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.qc.build_qc_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_qc_report
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;enhanced_qc
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" enhanced_qc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;EnhancedTableQualityProfiler
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" EnhancedTableQualityProfiler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler.consume" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;consume
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler.generate_detailed_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;generate_detailed_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler.generate_summary_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;generate_summary_report
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.build_enhanced_qc_detailed" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_qc_detailed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.build_enhanced_qc_report" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_qc_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.etl.enhanced_qc.build_enhanced_qc_summary" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_enhanced_qc_summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      Конфигурация
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.config" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;config
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.APIClientConfig" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;APIClientConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.Config" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Config
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.Config-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.Config.load" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.Config.parse_cli_overrides" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;parse_cli_overrides
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.ConsoleLoggingSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ConsoleLoggingSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.CorrelationSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CorrelationSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.CsvFormatSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CsvFormatSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.DeterminismSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DeterminismSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.FileLoggingSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FileLoggingSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPGlobalSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;HTTPGlobalSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" HTTPGlobalSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPGlobalSettings-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPGlobalSettings.timeout" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;timeout
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;HTTPSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPSourceSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;HTTPSourceSettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" HTTPSourceSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPSourceSettings-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.HTTPSourceSettings.timeout" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;timeout
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.IOSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;IOSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.InputSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;InputSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.LoggingSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LoggingSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.OutputSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;OutputSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.PaginationSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PaginationSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.ParquetFormatSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ParquetFormatSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.PostprocessSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PostprocessSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.QCStepSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;QCStepSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.QCValidationSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;QCValidationSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.RateLimitSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RateLimitSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.RetrySettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RetrySettings
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RetrySettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.RetrySettings-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.RetrySettings.max_tries" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;max_tries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.RuntimeSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RuntimeSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.SortSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SortSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.SourceSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SourceSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.TransformSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TransformSettings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config.ValidationSettings" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ValidationSettings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.config-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.config.ensure_output_directories_exist" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;ensure_output_directories_exist
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli" class="md-nav__link">
    <span class="md-ellipsis">
      CLI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.cli" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;cli
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" cli">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.cli-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.cli.ExitCode" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ExitCode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.TestitemExitCode" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TestitemExitCode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.cli.get_activity_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_activity_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.get_document_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_document_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.get_target_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_target_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.health" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;health
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.install_completion" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;install_completion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.main" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.testitem_info" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;testitem_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.testitem_run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;testitem_run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.testitem_validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;testitem_validate_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.cli.version" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;version
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      Утилиты
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Утилиты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      Логирование
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.logging_setup" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;logging_setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" logging_setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.AddContextFilter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AddContextFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AddContextFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.AddContextFilter-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.AddContextFilter.filter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;filter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.RedactSecretsFilter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RedactSecretsFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RedactSecretsFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.RedactSecretsFilter-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.RedactSecretsFilter.filter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;filter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.bind_stage" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;bind_stage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.cleanup_old_logs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;cleanup_old_logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.configure_logging" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;configure_logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.generate_run_id" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;generate_run_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.get_logger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.get_run_context" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_run_context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.logging_setup.set_run_context" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;set_run_context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      Телеметрия
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library.telemetry" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;telemetry
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" telemetry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.telemetry-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.telemetry.TraceContextManager" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TraceContextManager
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library.telemetry.add_span_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;add_span_attribute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.add_span_event" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;add_span_event
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.get_current_span_id" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_current_span_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.get_current_trace_id" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_current_trace_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.instrument_api_client" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;instrument_api_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.instrument_etl_stage" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;instrument_etl_stage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.setup_telemetry" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;setup_telemetry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#library.telemetry.traced_operation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;traced_operation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      Примеры использования
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Примеры использования">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      Базовое использование
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      Работа с клиентами
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      Валидация данных
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      Конфигурация
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      Типы данных
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Типы данных">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      Основные типы
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      Перечисления
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      Исключения
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Исключения">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      Основные исключения
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      Обработка исключений
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      Константы
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Константы">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      API константы
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      Константы валидации
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      Утилиты
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Утилиты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      Функции работы с данными
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      Функции работы с файлами
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      Функции логирования
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api_1" class="md-nav__link">
    <span class="md-ellipsis">
      Расширение API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Расширение API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      Создание нового клиента
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      Создание новой схемы валидации
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      Создание нового пайплайна
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      Производительность
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Производительность">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      Оптимизация
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      Мониторинг
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      Безопасность
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Безопасность">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      Валидация входных данных
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      Обработка секретов
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/SatoryKono/bioactivity_data_acquisition/edit/main/docs/reference/api_index.md" title="Редактировать страницу" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h1>
<p>Автогенерируемая документация API по модулям src/library/.</p>
<h2 id="_1">Пайплайны<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="documents">Documents<a class="headerlink" href="#documents" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.documents.pipeline" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.documents.pipeline</span>


<a href="#library.documents.pipeline" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Simplified document ETL pipeline orchestration.</p>










  <div class="doc doc-children">







<h3 id="library.documents.pipeline-classes">Classes<a href="#library.documents.pipeline-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.documents.pipeline.DocumentETLResult" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DocumentETLResult</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#library.documents.pipeline.DocumentETLResult" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">DocumentETLResult</span><span class="p">(</span>
    <span class="n">documents</span><span class="p">,</span>
    <span class="n">qc</span><span class="p">,</span>
    <span class="n">meta</span><span class="p">,</span>
    <span class="n">correlation_analysis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">correlation_reports</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">correlation_insights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


        <p>Container for ETL artefacts.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.documents.pipeline.DocumentHTTPError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DocumentHTTPError</span>


<a href="#library.documents.pipeline.DocumentHTTPError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            DocumentPipelineError (library.documents.pipeline.DocumentPipelineError)" href="#library.documents.pipeline.DocumentPipelineError">DocumentPipelineError</a></code></p>


        <p>Raised when upstream HTTP requests fail irrecoverably.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.documents.pipeline.DocumentIOError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DocumentIOError</span>


<a href="#library.documents.pipeline.DocumentIOError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            DocumentPipelineError (library.documents.pipeline.DocumentPipelineError)" href="#library.documents.pipeline.DocumentPipelineError">DocumentPipelineError</a></code></p>


        <p>Raised when reading or writing files fails.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.documents.pipeline.DocumentPipelineError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DocumentPipelineError</span>


<a href="#library.documents.pipeline.DocumentPipelineError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="RuntimeError">RuntimeError</span></code></p>


        <p>Base class for document pipeline errors.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.documents.pipeline.DocumentQCError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DocumentQCError</span>


<a href="#library.documents.pipeline.DocumentQCError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            DocumentPipelineError (library.documents.pipeline.DocumentPipelineError)" href="#library.documents.pipeline.DocumentPipelineError">DocumentPipelineError</a></code></p>


        <p>Raised when QC checks do not pass configured thresholds.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.documents.pipeline.DocumentValidationError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DocumentValidationError</span>


<a href="#library.documents.pipeline.DocumentValidationError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            DocumentPipelineError (library.documents.pipeline.DocumentPipelineError)" href="#library.documents.pipeline.DocumentPipelineError">DocumentPipelineError</a></code></p>


        <p>Raised when the input data does not meet schema expectations.</p>









    </div>

</div>
<h3 id="library.documents.pipeline-functions">Functions<a href="#library.documents.pipeline-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.documents.pipeline.read_document_input" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">read_document_input</span>


<a href="#library.documents.pipeline.read_document_input" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">read_document_input</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load the input CSV containing document identifiers.</p>


            <details class="quote">
              <summary>Source code in <code>library\documents\pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_document_input</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the input CSV containing document identifiers.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DocumentIOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input CSV not found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
    <span class="k">except</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">EmptyDataError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DocumentValidationError</span><span class="p">(</span><span class="s2">&quot;Input CSV is empty&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover - filesystem-level errors are rare</span>
        <span class="k">raise</span> <span class="n">DocumentIOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read input CSV: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
    <span class="k">return</span> <span class="n">frame</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.documents.pipeline.run_document_etl" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">run_document_etl</span>


<a href="#library.documents.pipeline.run_document_etl" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run_document_etl</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute the document ETL pipeline returning enriched artefacts.</p>


            <details class="quote">
              <summary>Source code in <code>library\documents\pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_document_etl</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">DocumentConfig</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DocumentETLResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the document ETL pipeline returning enriched artefacts.&quot;&quot;&quot;</span>

    <span class="n">normalised</span> <span class="o">=</span> <span class="n">_normalise_columns</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">normalised</span> <span class="o">=</span> <span class="n">normalised</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span><span class="p">)</span>

    <span class="n">duplicates</span> <span class="o">=</span> <span class="n">normalised</span><span class="p">[</span><span class="s2">&quot;document_chembl_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">duplicates</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="n">DocumentQCError</span><span class="p">(</span><span class="s2">&quot;Duplicate document_chembl_id values detected&quot;</span><span class="p">)</span>

    <span class="c1"># Use streaming batch processing</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">total_rows</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">document_batches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">enabled_sources</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">enabled_sources</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using streaming batch processing with batch_size=</span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">normalised</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents in batches&quot;</span><span class="p">)</span>

    <span class="c1"># Split documents into batches for streaming processing</span>
    <span class="k">for</span> <span class="n">batch_index</span><span class="p">,</span> <span class="n">batch_frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_batch_dataframe</span><span class="p">(</span><span class="n">normalised</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing batch </span><span class="si">{</span><span class="n">batch_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batch_frame</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents&quot;</span><span class="p">)</span>

        <span class="c1"># Initialize all possible columns with default values for this batch</span>
        <span class="n">enriched_batch</span> <span class="o">=</span> <span class="n">_initialize_all_columns</span><span class="p">(</span><span class="n">batch_frame</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

        <span class="c1"># Process each source for this batch</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">enabled_sources</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracting data from </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> for batch </span><span class="si">{</span><span class="n">batch_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">_create_api_client</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

                <span class="c1"># Для источников с высоким rate limiting добавляем дополнительную задержку</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;semantic_scholar&quot;</span><span class="p">,</span> <span class="s2">&quot;openalex&quot;</span><span class="p">]:</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

                    <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;semantic_scholar&quot;</span><span class="p">:</span>
                        <span class="c1"># Проверяем, есть ли API ключ для Semantic Scholar</span>
                        <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SEMANTIC_SCHOLAR_API_KEY&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using Semantic Scholar with API key: </span><span class="si">{</span><span class="n">api_key</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Semantic Scholar: Rate limiting controlled by configuration...&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using conservative rate limiting for </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> (no API key)&quot;</span><span class="p">)</span>
                            <span class="c1"># Semantic Scholar имеет очень строгие ограничения без API ключа</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;SEMANTIC SCHOLAR RATE LIMITING INFO:&quot;</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Semantic Scholar API has very strict rate limits without an API key.&quot;</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Current limit: 1 request per minute (controlled by rate limiter)&quot;</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;To get higher limits, apply for an API key at:&quot;</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;https://www.semanticscholar.org/product/api#api-key-form&quot;</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                            <span class="c1"># Убираем избыточную задержку - rate limiter уже контролирует это</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Semantic Scholar: Rate limiting controlled by configuration...&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using conservative rate limiting for </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Дополнительная задержка для OpenAlex</span>

                <span class="c1"># Use batch processing where available</span>
                <span class="n">enriched_batch</span> <span class="o">=</span> <span class="n">_extract_data_from_source_batch</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">enriched_batch</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

                <span class="c1"># Log success statistics for this batch</span>
                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;chembl&quot;</span><span class="p">:</span>
                    <span class="n">success_count</span> <span class="o">=</span> <span class="n">enriched_batch</span><span class="p">[</span><span class="s2">&quot;chembl_title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;crossref&quot;</span><span class="p">:</span>
                    <span class="c1"># Count successful records (either with title or with graceful degradation)</span>
                    <span class="n">success_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">enriched_batch</span><span class="p">[</span><span class="s2">&quot;crossref_title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span> <span class="o">|</span> 
                                   <span class="n">enriched_batch</span><span class="p">[</span><span class="s2">&quot;crossref_error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;openalex&quot;</span><span class="p">:</span>
                    <span class="n">success_count</span> <span class="o">=</span> <span class="n">enriched_batch</span><span class="p">[</span><span class="s2">&quot;openalex_title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;pubmed&quot;</span><span class="p">:</span>
                    <span class="n">success_count</span> <span class="o">=</span> <span class="n">enriched_batch</span><span class="p">[</span><span class="s2">&quot;pubmed_pmid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;semantic_scholar&quot;</span><span class="p">:</span>
                    <span class="n">success_count</span> <span class="o">=</span> <span class="n">enriched_batch</span><span class="p">[</span><span class="s2">&quot;semantic_scholar_pmid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully extracted data from </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> for batch </span><span class="si">{</span><span class="n">batch_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: &quot;</span>
                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">enriched_batch</span><span class="p">)</span><span class="si">}</span><span class="s2"> records&quot;</span><span class="p">)</span>

                <span class="c1"># Для источников с высоким rate limiting добавляем задержку после завершения</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;semantic_scholar&quot;</span><span class="p">,</span> <span class="s2">&quot;openalex&quot;</span><span class="p">]:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Rate limiting controlled by configuration...&quot;</span><span class="p">)</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
                    <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;semantic_scholar&quot;</span><span class="p">:</span>
                        <span class="c1"># Убираем избыточную задержку - rate limiter уже контролирует это</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Semantic Scholar: Rate limiting handled by configuration.&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Задержка для OpenAlex</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to extract data from </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> for batch </span><span class="si">{</span><span class="n">batch_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Специальная информация для Semantic Scholar</span>
                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;semantic_scholar&quot;</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;SEMANTIC SCHOLAR ERROR - RECOMMENDATIONS:&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;1. Consider getting an API key for higher rate limits:&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;   https://www.semanticscholar.org/product/api#api-key-form&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;2. Or disable Semantic Scholar in your config file:&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;   sources.semantic_scholar.enabled: false&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;3. The pipeline will continue with other sources.&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

                <span class="c1"># Continue with other sources even if one fails</span>

        <span class="n">total_rows</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">enriched_batch</span><span class="p">)</span>
        <span class="n">document_batches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enriched_batch</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed batch </span><span class="si">{</span><span class="n">batch_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">enriched_batch</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents, total=</span><span class="si">{</span><span class="n">total_rows</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Check limit</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">total_rows</span> <span class="o">&gt;=</span> <span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reached global limit of </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span><span class="si">}</span><span class="s2"> documents&quot;</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">document_batches</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No documents processed in streaming mode&quot;</span><span class="p">)</span>
        <span class="n">enriched_frame</span> <span class="o">=</span> <span class="n">_initialize_all_columns</span><span class="p">(</span><span class="n">normalised</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">enriched_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">document_batches</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span><span class="p">:</span>
            <span class="n">enriched_frame</span> <span class="o">=</span> <span class="n">enriched_frame</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents in </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">document_batches</span><span class="p">)</span><span class="si">}</span><span class="s2"> batches&quot;</span><span class="p">)</span>

    <span class="c1"># Добавляем колонку publication_date на основе полей PubMed</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Добавляем колонку publication_date...&quot;</span><span class="p">)</span>
    <span class="n">enriched_frame</span> <span class="o">=</span> <span class="n">_add_publication_date_column</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">)</span>

    <span class="c1"># Добавляем колонку document_sortorder на основе pubmed_issn, publication_date и index</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Добавляем колонку document_sortorder...&quot;</span><span class="p">)</span>
    <span class="n">enriched_frame</span> <span class="o">=</span> <span class="n">_add_document_sortorder_column</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">)</span>

    <span class="c1"># Добавляем технические поля для отслеживания</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Добавляем технические поля отслеживания...&quot;</span><span class="p">)</span>
    <span class="n">enriched_frame</span> <span class="o">=</span> <span class="n">_add_tracking_fields</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">)</span>

    <span class="c1"># Calculate QC metrics</span>
    <span class="n">qc_metrics</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;row_count&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">))},</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;enabled_sources&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">enabled_sources</span><span class="p">)},</span>
    <span class="p">]</span>

    <span class="c1"># Add source-specific metrics based on non-null fields</span>
    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">enabled_sources</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;chembl&quot;</span><span class="p">:</span>
            <span class="n">source_data_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">[</span><span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;document_chembl_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()])</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;openalex&quot;</span><span class="p">:</span>
            <span class="n">source_data_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">[</span><span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;openalex_title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()])</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;crossref&quot;</span><span class="p">:</span>
            <span class="c1"># Count records with either title or graceful degradation</span>
            <span class="n">source_data_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">[</span>
                <span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;crossref_title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span> <span class="o">|</span> 
                <span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;crossref_error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
            <span class="p">])</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;pubmed&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;pubmed_pmid&quot;</span> <span class="ow">in</span> <span class="n">enriched_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">source_data_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">[</span><span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;pubmed_pmid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source_data_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;semantic_scholar&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;semantic_scholar_pmid&quot;</span> <span class="ow">in</span> <span class="n">enriched_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">source_data_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                    <span class="n">enriched_frame</span><span class="p">[</span><span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;semantic_scholar_pmid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source_data_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">source_data_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">qc_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">_records&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">source_data_count</span><span class="p">})</span>

    <span class="n">qc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">qc_metrics</span><span class="p">)</span>
    <span class="c1"># Унифицируем базовые QC метрики</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">library.etl.qc_common</span><span class="w"> </span><span class="kn">import</span> <span class="n">ensure_common_qc</span>
        <span class="n">qc</span> <span class="o">=</span> <span class="n">ensure_common_qc</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">,</span> <span class="n">qc</span><span class="p">,</span> <span class="n">module_name</span><span class="o">=</span><span class="s2">&quot;documents&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">logging</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_logging</span>
        <span class="n">_logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to normalize QC metrics for documents: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Выполняем корреляционный анализ если включен в конфигурации</span>
    <span class="n">correlation_analysis</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">correlation_reports</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">correlation_insights</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Проверяем, включен ли корреляционный анализ в конфигурации</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s1">&#39;postprocess&#39;</span><span class="p">)</span> <span class="ow">and</span> 
        <span class="nb">hasattr</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">postprocess</span><span class="p">,</span> <span class="s1">&#39;correlation&#39;</span><span class="p">)</span> <span class="ow">and</span> 
        <span class="n">config</span><span class="o">.</span><span class="n">postprocess</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">enabled</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Выполняем корреляционный анализ документов...&quot;</span><span class="p">)</span>

            <span class="c1"># Подготавливаем данные для корреляционного анализа</span>
            <span class="n">analysis_df</span> <span class="o">=</span> <span class="n">prepare_data_for_correlation_analysis</span><span class="p">(</span>
                <span class="n">enriched_frame</span><span class="p">,</span> 
                <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span> 
                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
            <span class="p">)</span>

            <span class="c1"># Выполняем корреляционный анализ</span>
            <span class="n">correlation_analysis</span> <span class="o">=</span> <span class="n">build_enhanced_correlation_analysis</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="n">correlation_reports</span> <span class="o">=</span> <span class="n">build_enhanced_correlation_reports</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="n">correlation_insights</span> <span class="o">=</span> <span class="n">build_correlation_insights</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Корреляционный анализ завершен. Найдено </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation_insights</span><span class="p">)</span><span class="si">}</span><span class="s2"> инсайтов.&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ошибка при выполнении корреляционного анализа: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Тип ошибки: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Продолжаем без корреляционного анализа</span>

    <span class="c1"># Создаем метаданные</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;pipeline_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;row_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">),</span>
        <span class="s2">&quot;enabled_sources&quot;</span><span class="p">:</span> <span class="n">enabled_sources</span><span class="p">,</span>
        <span class="s2">&quot;extraction_parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;total_documents&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">),</span>
            <span class="s2">&quot;sources_processed&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">enabled_sources</span><span class="p">),</span>
            <span class="s2">&quot;correlation_analysis_enabled&quot;</span><span class="p">:</span> <span class="n">correlation_analysis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;correlation_insights_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">correlation_insights</span><span class="p">)</span> <span class="k">if</span> <span class="n">correlation_insights</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># Добавляем статистику по источникам</span>
    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">enabled_sources</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;chembl&quot;</span><span class="p">:</span>
            <span class="n">source_data_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">[</span><span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;document_chembl_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()])</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;openalex&quot;</span><span class="p">:</span>
            <span class="n">source_data_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">[</span><span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;openalex_title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()])</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;crossref&quot;</span><span class="p">:</span>
            <span class="n">source_data_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">[</span>
                <span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;crossref_title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span> <span class="o">|</span> 
                <span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;crossref_error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
            <span class="p">])</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;pubmed&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;pubmed_pmid&quot;</span> <span class="ow">in</span> <span class="n">enriched_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">source_data_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">[</span><span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;pubmed_pmid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source_data_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;semantic_scholar&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;semantic_scholar_pmid&quot;</span> <span class="ow">in</span> <span class="n">enriched_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">source_data_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                    <span class="n">enriched_frame</span><span class="p">[</span><span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;semantic_scholar_pmid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source_data_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">source_data_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;extraction_parameters&quot;</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">_records&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source_data_count</span>

    <span class="k">return</span> <span class="n">DocumentETLResult</span><span class="p">(</span>
        <span class="n">documents</span><span class="o">=</span><span class="n">enriched_frame</span><span class="p">,</span> 
        <span class="n">qc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
        <span class="n">correlation_analysis</span><span class="o">=</span><span class="n">correlation_analysis</span><span class="p">,</span>
        <span class="n">correlation_reports</span><span class="o">=</span><span class="n">correlation_reports</span><span class="p">,</span>
        <span class="n">correlation_insights</span><span class="o">=</span><span class="n">correlation_insights</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.documents.pipeline.write_document_outputs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">write_document_outputs</span>


<a href="#library.documents.pipeline.write_document_outputs" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">write_document_outputs</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">date_tag</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Persist ETL artefacts to disk and return the generated paths.</p>


            <details class="quote">
              <summary>Source code in <code>library\documents\pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_document_outputs</span><span class="p">(</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">DocumentETLResult</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">date_tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DocumentConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Persist ETL artefacts to disk and return the generated paths.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover - filesystem permission issues</span>
        <span class="k">raise</span> <span class="n">DocumentIOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create output directory: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="n">documents_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;documents_</span><span class="si">{</span><span class="n">date_tag</span><span class="si">}</span><span class="s2">.csv&quot;</span>
    <span class="n">qc_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;documents_</span><span class="si">{</span><span class="n">date_tag</span><span class="si">}</span><span class="s2">_qc.csv&quot;</span>
    <span class="n">meta_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;documents_</span><span class="si">{</span><span class="n">date_tag</span><span class="si">}</span><span class="s2">_meta.yaml&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Нормализуем колонки с названиями журналов (если включено)</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">postprocess</span><span class="o">.</span><span class="n">journal_normalization</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="n">documents_normalized</span> <span class="o">=</span> <span class="n">normalize_journal_columns</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">documents_normalized</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">documents</span>

        <span class="c1"># Валидируем данные из различных источников</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">library.tools.data_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_all_fields</span>
        <span class="n">documents_validated</span> <span class="o">=</span> <span class="n">validate_all_fields</span><span class="p">(</span><span class="n">documents_normalized</span><span class="p">)</span>

        <span class="c1"># Добавляем колонку с литературными ссылками после валидации (если включено)</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">postprocess</span><span class="o">.</span><span class="n">citation_formatting</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="c1"># Получаем маппинг колонок из конфигурации, если он есть</span>
            <span class="n">column_mapping</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">postprocess</span><span class="o">.</span><span class="n">citation_formatting</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">documents_with_citations</span> <span class="o">=</span> <span class="n">add_citation_column</span><span class="p">(</span><span class="n">documents_validated</span><span class="p">,</span> <span class="n">column_mapping</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">documents_with_citations</span> <span class="o">=</span> <span class="n">documents_validated</span>

        <span class="c1"># Используем готовую функцию детерминистического сохранения</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">library.etl.load</span><span class="w"> </span><span class="kn">import</span> <span class="n">write_deterministic_csv</span>
            <span class="n">write_deterministic_csv</span><span class="p">(</span>
                <span class="n">documents_with_citations</span><span class="p">,</span>
                <span class="n">documents_path</span><span class="p">,</span>
                <span class="n">determinism</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">determinism</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># Используем fallback настройки</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback для случаев, когда конфигурация не передана</span>
            <span class="n">documents_with_citations</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">documents_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Сохраняем QC данные также с детерминистическим порядком</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">write_deterministic_csv</span><span class="p">(</span>
                <span class="n">result</span><span class="o">.</span><span class="n">qc</span><span class="p">,</span>
                <span class="n">qc_path</span><span class="p">,</span>
                <span class="n">determinism</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">determinism</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># Используем fallback настройки</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">qc_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Save metadata</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Add file checksums to metadata</span>
        <span class="n">result</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;file_checksums&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;csv&quot;</span><span class="p">:</span> <span class="n">_calculate_checksum</span><span class="p">(</span><span class="n">documents_path</span><span class="p">),</span>
            <span class="s2">&quot;qc&quot;</span><span class="p">:</span> <span class="n">_calculate_checksum</span><span class="p">(</span><span class="n">qc_path</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Update metadata file with checksums</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover - filesystem permission issues</span>
        <span class="k">raise</span> <span class="n">DocumentIOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write outputs: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;documents&quot;</span><span class="p">:</span> <span class="n">documents_path</span><span class="p">,</span> <span class="s2">&quot;qc&quot;</span><span class="p">:</span> <span class="n">qc_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="n">meta_path</span><span class="p">}</span>

    <span class="c1"># Сохраняем корреляционные отчеты если они есть</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">correlation_reports</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">correlation_dir</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;documents_correlation_report_</span><span class="si">{</span><span class="n">date_tag</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">correlation_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Сохраняем каждый тип корреляционного отчета</span>
            <span class="k">for</span> <span class="n">report_name</span><span class="p">,</span> <span class="n">report_df</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">correlation_reports</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">report_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">report_path</span> <span class="o">=</span> <span class="n">correlation_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_name</span><span class="si">}</span><span class="s2">.csv&quot;</span>
                    <span class="n">report_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">outputs</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;correlation_</span><span class="si">{</span><span class="n">report_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">report_path</span>

            <span class="c1"># Сохраняем инсайты как JSON</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">correlation_insights</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
                <span class="n">insights_path</span> <span class="o">=</span> <span class="n">correlation_dir</span> <span class="o">/</span> <span class="s2">&quot;correlation_insights.json&quot;</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">insights_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">correlation_insights</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;correlation_insights&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">insights_path</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Корреляционные отчеты сохранены в: </span><span class="si">{</span><span class="n">correlation_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ошибка при сохранении корреляционных отчетов: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Тип ошибки: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">outputs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="targets">Targets<a class="headerlink" href="#targets" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.target.pipeline" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.target.pipeline</span>


<a href="#library.target.pipeline" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Target ETL pipeline orchestration.</p>










  <div class="doc doc-children">







<h3 id="library.target.pipeline-classes">Classes<a href="#library.target.pipeline-classes" class="headerlink" title="Permanent link">&para;</a></h3>
<h3 id="library.target.pipeline-functions">Functions<a href="#library.target.pipeline-functions" class="headerlink" title="Permanent link">&para;</a></h3>



  </div>

    </div>

</div><h3 id="assays">Assays<a class="headerlink" href="#assays" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.assay.pipeline" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.assay.pipeline</span>


<a href="#library.assay.pipeline" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Assay ETL pipeline orchestration.</p>










  <div class="doc doc-children">







<h3 id="library.assay.pipeline-classes">Classes<a href="#library.assay.pipeline-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.assay.pipeline.AssayETLResult" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AssayETLResult</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#library.assay.pipeline.AssayETLResult" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">AssayETLResult</span><span class="p">(</span>
    <span class="n">assays</span><span class="p">,</span>
    <span class="n">qc</span><span class="p">,</span>
    <span class="n">meta</span><span class="p">,</span>
    <span class="n">correlation_analysis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">correlation_reports</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">correlation_insights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


        <p>Container for ETL artefacts.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.assay.pipeline.AssayHTTPError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AssayHTTPError</span>


<a href="#library.assay.pipeline.AssayHTTPError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            AssayPipelineError (library.assay.pipeline.AssayPipelineError)" href="#library.assay.pipeline.AssayPipelineError">AssayPipelineError</a></code></p>


        <p>Raised when upstream HTTP requests fail irrecoverably.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.assay.pipeline.AssayIOError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AssayIOError</span>


<a href="#library.assay.pipeline.AssayIOError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            AssayPipelineError (library.assay.pipeline.AssayPipelineError)" href="#library.assay.pipeline.AssayPipelineError">AssayPipelineError</a></code></p>


        <p>Raised when reading or writing files fails.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.assay.pipeline.AssayPipelineError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AssayPipelineError</span>


<a href="#library.assay.pipeline.AssayPipelineError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="RuntimeError">RuntimeError</span></code></p>


        <p>Base class for assay pipeline errors.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.assay.pipeline.AssayQCError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AssayQCError</span>


<a href="#library.assay.pipeline.AssayQCError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            AssayPipelineError (library.assay.pipeline.AssayPipelineError)" href="#library.assay.pipeline.AssayPipelineError">AssayPipelineError</a></code></p>


        <p>Raised when QC checks do not pass configured thresholds.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.assay.pipeline.AssayValidationError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AssayValidationError</span>


<a href="#library.assay.pipeline.AssayValidationError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            AssayPipelineError (library.assay.pipeline.AssayPipelineError)" href="#library.assay.pipeline.AssayPipelineError">AssayPipelineError</a></code></p>


        <p>Raised when the input data does not meet schema expectations.</p>









    </div>

</div>
<h3 id="library.assay.pipeline-functions">Functions<a href="#library.assay.pipeline-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.assay.pipeline.read_assay_input" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">read_assay_input</span>


<a href="#library.assay.pipeline.read_assay_input" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">read_assay_input</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load the input CSV containing assay identifiers.</p>


            <details class="quote">
              <summary>Source code in <code>library\assay\pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_assay_input</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the input CSV containing assay identifiers.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">AssayIOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input CSV not found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
    <span class="k">except</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">EmptyDataError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">AssayValidationError</span><span class="p">(</span><span class="s2">&quot;Input CSV is empty&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover - filesystem-level errors are rare</span>
        <span class="k">raise</span> <span class="n">AssayIOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read input CSV: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
    <span class="k">return</span> <span class="n">frame</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.assay.pipeline.run_assay_etl" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">run_assay_etl</span>


<a href="#library.assay.pipeline.run_assay_etl" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run_assay_etl</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">assay_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_chembl_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute the assay ETL pipeline returning enriched artefacts.</p>


            <details class="quote">
              <summary>Source code in <code>library\assay\pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_assay_etl</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">AssayConfig</span><span class="p">,</span> 
    <span class="n">assay_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_chembl_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssayETLResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the assay ETL pipeline returning enriched artefacts.&quot;&quot;&quot;</span>

    <span class="c1"># S01: Get ChEMBL status and release</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;S01: Getting ChEMBL status and release...&quot;</span><span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">_create_api_client</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">status_info</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_chembl_status</span><span class="p">()</span>
        <span class="n">chembl_release</span> <span class="o">=</span> <span class="n">status_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chembl_release&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chembl_release</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chembl_release</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ChEMBL release: </span><span class="si">{</span><span class="n">chembl_release</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get ChEMBL status: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">chembl_release</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="c1"># S02: Fetch assay core data</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;S02: Fetching assay core data...&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">assay_ids</span><span class="p">:</span>
        <span class="c1"># Create DataFrame from assay IDs</span>
        <span class="n">input_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;assay_chembl_id&quot;</span><span class="p">:</span> <span class="n">assay_ids</span><span class="p">})</span>
        <span class="n">input_frame</span> <span class="o">=</span> <span class="n">_normalise_columns</span><span class="p">(</span><span class="n">input_frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">input_frame</span> <span class="o">=</span> <span class="n">input_frame</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span><span class="p">)</span>

        <span class="c1"># Check for duplicates</span>
        <span class="n">duplicates</span> <span class="o">=</span> <span class="n">input_frame</span><span class="p">[</span><span class="s2">&quot;assay_chembl_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">duplicates</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">AssayQCError</span><span class="p">(</span><span class="s2">&quot;Duplicate assay_chembl_id values detected&quot;</span><span class="p">)</span>

        <span class="c1"># Log streaming batch params</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">total_ids</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">input_frame</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assay extraction: streaming batches enabled (batch_size=</span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">, limit=</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">, total_ids=</span><span class="si">{</span><span class="n">total_ids</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to log batch parameters: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Extract data</span>
        <span class="n">enriched_frame</span> <span class="o">=</span> <span class="n">_extract_assay_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">input_frame</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">target_chembl_id</span><span class="p">:</span>
        <span class="c1"># Extract by target</span>
        <span class="n">enriched_frame</span> <span class="o">=</span> <span class="n">_extract_assay_data_by_target</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">target_chembl_id</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">enriched_frame</span> <span class="o">=</span> <span class="n">enriched_frame</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">AssayValidationError</span><span class="p">(</span><span class="s2">&quot;Either assay_ids or target_chembl_id must be provided&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">enriched_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No assay data extracted&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">AssayETLResult</span><span class="p">(</span>
            <span class="n">assays</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span>
            <span class="n">qc</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;row_count&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]),</span>
            <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;chembl_release&quot;</span><span class="p">:</span> <span class="n">chembl_release</span><span class="p">,</span> <span class="s2">&quot;row_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="c1"># S03: Enrich with source data</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;S03: Enriching with source data...&quot;</span><span class="p">)</span>
    <span class="n">enriched_frame</span> <span class="o">=</span> <span class="n">_enrich_with_source_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">enriched_frame</span><span class="p">)</span>

    <span class="c1"># S04: Normalize fields</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;S04: Normalizing fields...&quot;</span><span class="p">)</span>
    <span class="n">enriched_frame</span> <span class="o">=</span> <span class="n">_normalize_assay_fields</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">)</span>

    <span class="c1"># Add chembl_release to all records</span>
    <span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;chembl_release&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chembl_release</span>

    <span class="c1"># Generate hashes for all records</span>
    <span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;hash_business_key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;assay_chembl_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;unknown&quot;</span>
    <span class="p">)</span>
    <span class="n">enriched_frame</span><span class="p">[</span><span class="s2">&quot;hash_row&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">enriched_frame</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="c1"># S05: Validate schema</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;S05: Validating schema...&quot;</span><span class="p">)</span>
    <span class="n">validated_frame</span> <span class="o">=</span> <span class="n">_validate_assay_schema</span><span class="p">(</span><span class="n">enriched_frame</span><span class="p">)</span>

    <span class="c1"># Calculate QC metrics</span>
    <span class="n">qc_metrics</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;row_count&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">validated_frame</span><span class="p">))},</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;unique_sources&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">validated_frame</span><span class="p">[</span><span class="s2">&quot;src_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">())},</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;assay_types&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">validated_frame</span><span class="p">[</span><span class="s2">&quot;assay_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()},</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;relationship_types&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">validated_frame</span><span class="p">[</span><span class="s2">&quot;relationship_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()},</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;confidence_scores&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">validated_frame</span><span class="p">[</span><span class="s2">&quot;confidence_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()},</span>
    <span class="p">]</span>

    <span class="n">qc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">qc_metrics</span><span class="p">)</span>
    <span class="c1"># Унифицируем базовые QC метрики</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">library.etl.qc_common</span><span class="w"> </span><span class="kn">import</span> <span class="n">ensure_common_qc</span>
        <span class="n">qc</span> <span class="o">=</span> <span class="n">ensure_common_qc</span><span class="p">(</span><span class="n">validated_frame</span><span class="p">,</span> <span class="n">qc</span><span class="p">,</span> <span class="n">module_name</span><span class="o">=</span><span class="s2">&quot;assay&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">logging</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_logging</span>
        <span class="n">_logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to normalize QC metrics for assay: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Create metadata</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;pipeline_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;chembl_release&quot;</span><span class="p">:</span> <span class="n">chembl_release</span><span class="p">,</span>
        <span class="s2">&quot;row_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">validated_frame</span><span class="p">),</span>
        <span class="s2">&quot;extraction_parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;total_assays&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">validated_frame</span><span class="p">),</span>
            <span class="s2">&quot;unique_sources&quot;</span><span class="p">:</span> <span class="n">validated_frame</span><span class="p">[</span><span class="s2">&quot;src_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">(),</span>
            <span class="s2">&quot;assay_types&quot;</span><span class="p">:</span> <span class="n">validated_frame</span><span class="p">[</span><span class="s2">&quot;assay_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s2">&quot;relationship_types&quot;</span><span class="p">:</span> <span class="n">validated_frame</span><span class="p">[</span><span class="s2">&quot;relationship_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># Perform correlation analysis if enabled in config</span>
    <span class="n">correlation_analysis</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">correlation_reports</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">correlation_insights</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">postprocess</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">validated_frame</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing correlation analysis...&quot;</span><span class="p">)</span>

            <span class="c1"># Подготавливаем данные для корреляционного анализа</span>
            <span class="n">analysis_df</span> <span class="o">=</span> <span class="n">prepare_data_for_correlation_analysis</span><span class="p">(</span>
                <span class="n">validated_frame</span><span class="p">,</span> 
                <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;assays&quot;</span><span class="p">,</span> 
                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
            <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Correlation analysis: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> numeric columns, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Columns for analysis: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">analysis_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">analysis_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Perform correlation analysis</span>
                <span class="n">correlation_analysis</span> <span class="o">=</span> <span class="n">build_enhanced_correlation_analysis</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">)</span>
                <span class="n">correlation_reports</span> <span class="o">=</span> <span class="n">build_enhanced_correlation_reports</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">)</span>
                <span class="n">correlation_insights</span> <span class="o">=</span> <span class="n">build_correlation_insights</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Correlation analysis completed. Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation_insights</span><span class="p">)</span><span class="si">}</span><span class="s2"> insights.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Not enough numeric columns for correlation analysis&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during correlation analysis: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Continue without correlation analysis</span>

    <span class="k">return</span> <span class="n">AssayETLResult</span><span class="p">(</span>
        <span class="n">assays</span><span class="o">=</span><span class="n">validated_frame</span><span class="p">,</span> 
        <span class="n">qc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
        <span class="n">correlation_analysis</span><span class="o">=</span><span class="n">correlation_analysis</span><span class="p">,</span>
        <span class="n">correlation_reports</span><span class="o">=</span><span class="n">correlation_reports</span><span class="p">,</span>
        <span class="n">correlation_insights</span><span class="o">=</span><span class="n">correlation_insights</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.assay.pipeline.write_assay_outputs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">write_assay_outputs</span>


<a href="#library.assay.pipeline.write_assay_outputs" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">write_assay_outputs</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">date_tag</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Persist ETL artefacts to disk and return the generated paths.</p>


            <details class="quote">
              <summary>Source code in <code>library\assay\pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_assay_outputs</span><span class="p">(</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">AssayETLResult</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">date_tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">AssayConfig</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Persist ETL artefacts to disk and return the generated paths.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover - filesystem permission issues</span>
        <span class="k">raise</span> <span class="n">AssayIOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create output directory: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="c1"># File paths</span>
    <span class="n">csv_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;assay_</span><span class="si">{</span><span class="n">date_tag</span><span class="si">}</span><span class="s2">.csv&quot;</span>    
    <span class="n">qc_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;assay_</span><span class="si">{</span><span class="n">date_tag</span><span class="si">}</span><span class="s2">_qc.csv&quot;</span>
    <span class="n">meta_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;assay_</span><span class="si">{</span><span class="n">date_tag</span><span class="si">}</span><span class="s2">_meta.yaml&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># S06: Persist data with deterministic serialization</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;S06: Persisting data...&quot;</span><span class="p">)</span>

        <span class="c1"># Save CSV with deterministic order</span>
        <span class="n">write_deterministic_csv</span><span class="p">(</span>
            <span class="n">result</span><span class="o">.</span><span class="n">assays</span><span class="p">,</span>
            <span class="n">csv_path</span><span class="p">,</span>
            <span class="n">determinism</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">determinism</span><span class="p">,</span>
            <span class="n">output</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>


        <span class="c1"># Save QC data (всегда создаём файл)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">qc</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">qc_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_pd</span>
            <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;row_count&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">assays</span><span class="p">))}])</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">qc_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Save metadata</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Save correlation reports if available</span>
        <span class="n">correlation_paths</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">correlation_reports</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">correlation_dir</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;assay_correlation_report_</span><span class="si">{</span><span class="n">date_tag</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">correlation_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">report_name</span><span class="p">,</span> <span class="n">report_df</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">correlation_reports</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">report_path</span> <span class="o">=</span> <span class="n">correlation_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_name</span><span class="si">}</span><span class="s2">.csv&quot;</span>
                    <span class="n">report_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">correlation_paths</span><span class="p">[</span><span class="n">report_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">report_path</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> correlation reports to </span><span class="si">{</span><span class="n">correlation_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save correlation reports: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Save correlation insights if available</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">correlation_insights</span><span class="p">:</span>
                <span class="n">insights_dir</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;assay_correlation_report_</span><span class="si">{</span><span class="n">date_tag</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">insights_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">insights_path</span> <span class="o">=</span> <span class="n">insights_dir</span> <span class="o">/</span> <span class="s2">&quot;correlation_insights.json&quot;</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">json</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_json</span>
                <span class="k">with</span> <span class="n">insights_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">_json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">correlation_insights</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">correlation_paths</span><span class="p">[</span><span class="s2">&quot;correlation_insights&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">insights_path</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to save correlation insights&quot;</span><span class="p">)</span>

        <span class="c1"># Add file checksums to metadata</span>
        <span class="n">result</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;file_checksums&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;csv&quot;</span><span class="p">:</span> <span class="n">_calculate_checksum</span><span class="p">(</span><span class="n">csv_path</span><span class="p">),</span>
            <span class="s2">&quot;qc&quot;</span><span class="p">:</span> <span class="n">_calculate_checksum</span><span class="p">(</span><span class="n">qc_path</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Update metadata file with checksums</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover - filesystem permission issues</span>
        <span class="k">raise</span> <span class="n">AssayIOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write outputs: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="n">result_paths</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;csv&quot;</span><span class="p">:</span> <span class="n">csv_path</span><span class="p">,</span> 
        <span class="s2">&quot;qc&quot;</span><span class="p">:</span> <span class="n">qc_path</span><span class="p">,</span>
        <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="n">meta_path</span>
    <span class="p">}</span>

    <span class="c1"># Add correlation report paths if available</span>
    <span class="k">if</span> <span class="n">correlation_paths</span><span class="p">:</span>
        <span class="n">result_paths</span><span class="p">[</span><span class="s2">&quot;correlation_reports&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">correlation_paths</span>

    <span class="k">return</span> <span class="n">result_paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="activities">Activities<a class="headerlink" href="#activities" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.activity.pipeline" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.activity.pipeline</span>


<a href="#library.activity.pipeline" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Activity data ETL pipeline.</p>










  <div class="doc doc-children">







<h3 id="library.activity.pipeline-classes">Classes<a href="#library.activity.pipeline-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.activity.pipeline.ActivityHTTPError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ActivityHTTPError</span>


<a href="#library.activity.pipeline.ActivityHTTPError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            ActivityPipelineError (library.activity.pipeline.ActivityPipelineError)" href="#library.activity.pipeline.ActivityPipelineError">ActivityPipelineError</a></code></p>


        <p>Raised when upstream HTTP requests fail irrecoverably.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.activity.pipeline.ActivityIOError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ActivityIOError</span>


<a href="#library.activity.pipeline.ActivityIOError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            ActivityPipelineError (library.activity.pipeline.ActivityPipelineError)" href="#library.activity.pipeline.ActivityPipelineError">ActivityPipelineError</a></code></p>


        <p>Raised when reading or writing files fails.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.activity.pipeline.ActivityPipeline" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ActivityPipeline</span>


<a href="#library.activity.pipeline.ActivityPipeline" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ActivityPipeline</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


        <p>ETL pipeline for activity data extraction and processing.</p>

        <p>Initialize the activity pipeline.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Activity configuration object</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="library.activity.config.ActivityConfig">ActivityConfig</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>








                  <details class="quote">
                    <summary>Source code in <code>library\activity\pipeline.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ActivityConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the activity pipeline.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Activity configuration object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">ActivityChEMBLClient</span><span class="p">(</span>
        <span class="n">config</span><span class="o">.</span><span class="n">to_api_client_config</span><span class="p">(),</span>
        <span class="n">cache_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get_cache_path</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">ActivityValidator</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span> <span class="o">=</span> <span class="n">ActivityNormalizer</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">quality_checker</span> <span class="o">=</span> <span class="n">ActivityQualityFilter</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">








<h5 id="library.activity.pipeline.ActivityPipeline-functions">Functions<a href="#library.activity.pipeline.ActivityPipeline-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="library.activity.pipeline.ActivityPipeline.run" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">run</span>


<a href="#library.activity.pipeline.ActivityPipeline.run" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run</span><span class="p">(</span><span class="n">input_csv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Run the complete activity ETL pipeline.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_csv</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional CSV file with filter IDs (assay_ids, molecule_ids, target_ids)</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pathlib.Path">Path</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Structured logger for tracking progress</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="structlog.BoundLogger">BoundLogger</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="library.activity.pipeline.ActivityETLResult">ActivityETLResult</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Dictionary containing processed data and metadata</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><span title="ValueError">ValueError</span></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If input validation fails</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><span title="IOError">IOError</span></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If file operations fail</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>library\activity\pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_csv</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">BoundLogger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActivityETLResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the complete activity ETL pipeline.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_csv: Optional CSV file with filter IDs (assay_ids, molecule_ids, target_ids)</span>
<span class="sd">        logger: Structured logger for tracking progress</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing processed data and metadata</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If input validation fails</span>
<span class="sd">        IOError: If file operations fail</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Получаем сконфигурированный логгер structlog (настройки задаются configure_logging)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">structlog</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_logger</span>  <span class="c1"># type: ignore</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="c1"># Фоллбэк: оборачиваем стандартный логгер</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">BoundLogger</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting activity ETL pipeline&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">))</span>

    <span class="c1"># Ensure directories exist</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ensure_directories</span><span class="p">()</span>

    <span class="c1"># Load filter IDs if provided</span>
    <span class="n">filter_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_filter_ids</span><span class="p">(</span><span class="n">input_csv</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1"># Extract data from ChEMBL</span>
    <span class="n">raw_activities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_activities</span><span class="p">(</span><span class="n">filter_ids</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">raw_activities</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No activities extracted&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ActivityETLResult</span><span class="p">(</span>
            <span class="n">activities</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span>
            <span class="n">meta</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;total_activities&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;extraction_timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span>
                <span class="s2">&quot;chembl_release&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">qc</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="c1"># raw_activities is already a DataFrame</span>
    <span class="n">activities_df</span> <span class="o">=</span> <span class="n">raw_activities</span>
    <span class="c1"># Backward-compat: ensure activity_chembl_id exists</span>
    <span class="k">if</span> <span class="s2">&quot;activity_chembl_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">activities_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s2">&quot;activity_id&quot;</span> <span class="ow">in</span> <span class="n">activities_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">activities_df</span> <span class="o">=</span> <span class="n">activities_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">activities_df</span><span class="p">[</span><span class="s2">&quot;activity_chembl_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">activities_df</span><span class="p">[</span><span class="s2">&quot;activity_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracted </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">activities_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> activities&quot;</span><span class="p">)</span>

    <span class="c1"># Validate data</span>
    <span class="n">validated_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_activities</span><span class="p">(</span><span class="n">activities_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1"># Normalize data</span>
    <span class="n">normalized_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_activities</span><span class="p">(</span><span class="n">validated_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="c1"># Add tracking fields similar to assay pipeline</span>
    <span class="n">normalized_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_tracking_fields</span><span class="p">(</span><span class="n">normalized_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1"># Add index column</span>
    <span class="n">normalized_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">normalized_df</span><span class="p">)))</span>

    <span class="c1"># Quality control</span>
    <span class="n">qc_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quality_control</span><span class="p">(</span><span class="n">normalized_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1"># Приводим QC к общему формату (row_count + missing_data всегда присутствуют)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">library.etl.qc_common</span><span class="w"> </span><span class="kn">import</span> <span class="n">ensure_common_qc</span>
        <span class="n">qc_results</span> <span class="o">=</span> <span class="n">ensure_common_qc</span><span class="p">(</span><span class="n">normalized_df</span><span class="p">,</span> <span class="n">qc_results</span><span class="p">,</span> <span class="n">module_name</span><span class="o">=</span><span class="s2">&quot;activity&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to normalize QC metrics for activity: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get metadata</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metadata</span><span class="p">(</span><span class="n">normalized_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1"># Опциональный корреляционный анализ (для единообразия)</span>
    <span class="n">correlation_analysis</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">correlation_reports</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">correlation_insights</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">enabled</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;postprocess&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;correlation&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">enabled</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">enabled</span><span class="p">,</span> <span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">enabled</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">normalized_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">normalized_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">library.etl.enhanced_correlation</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
                <span class="n">build_correlation_insights</span><span class="p">,</span>
                <span class="n">build_enhanced_correlation_analysis</span><span class="p">,</span>
                <span class="n">build_enhanced_correlation_reports</span><span class="p">,</span>
                <span class="n">prepare_data_for_correlation_analysis</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">analysis_df</span> <span class="o">=</span> <span class="n">prepare_data_for_correlation_analysis</span><span class="p">(</span><span class="n">normalized_df</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">analysis_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">correlation_analysis</span> <span class="o">=</span> <span class="n">build_enhanced_correlation_analysis</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
                <span class="n">correlation_reports</span> <span class="o">=</span> <span class="n">build_enhanced_correlation_reports</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
                <span class="n">correlation_insights</span> <span class="o">=</span> <span class="n">build_correlation_insights</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to build activity correlation analysis: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Activity ETL pipeline completed successfully&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ActivityETLResult</span><span class="p">(</span>
        <span class="n">activities</span><span class="o">=</span><span class="n">normalized_df</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
        <span class="n">qc</span><span class="o">=</span><span class="n">qc_results</span><span class="p">,</span>
        <span class="n">correlation_analysis</span><span class="o">=</span><span class="n">correlation_analysis</span><span class="p">,</span>
        <span class="n">correlation_reports</span><span class="o">=</span><span class="n">correlation_reports</span><span class="p">,</span>
        <span class="n">correlation_insights</span><span class="o">=</span><span class="n">correlation_insights</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.activity.pipeline.ActivityPipelineError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ActivityPipelineError</span>


<a href="#library.activity.pipeline.ActivityPipelineError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="RuntimeError">RuntimeError</span></code></p>


        <p>Base class for activity pipeline errors.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.activity.pipeline.ActivityQCError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ActivityQCError</span>


<a href="#library.activity.pipeline.ActivityQCError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            ActivityPipelineError (library.activity.pipeline.ActivityPipelineError)" href="#library.activity.pipeline.ActivityPipelineError">ActivityPipelineError</a></code></p>


        <p>Raised when QC checks do not pass configured thresholds.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.activity.pipeline.ActivityValidationError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ActivityValidationError</span>


<a href="#library.activity.pipeline.ActivityValidationError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            ActivityPipelineError (library.activity.pipeline.ActivityPipelineError)" href="#library.activity.pipeline.ActivityPipelineError">ActivityPipelineError</a></code></p>


        <p>Raised when validation fails for activity data.</p>









    </div>

</div>
<h3 id="library.activity.pipeline-functions">Functions<a href="#library.activity.pipeline-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.activity.pipeline.run_activity_etl" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">run_activity_etl</span>


<a href="#library.activity.pipeline.run_activity_etl" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run_activity_etl</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_csv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convenience function to run activity ETL pipeline.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Activity configuration</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="library.activity.config.ActivityConfig">ActivityConfig</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_csv</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional input CSV with filter IDs</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pathlib.Path">Path</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional structured logger</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="structlog.BoundLogger">BoundLogger</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="library.activity.pipeline.ActivityETLResult">ActivityETLResult</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Dictionary with processed data and metadata</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>library\activity\pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_activity_etl</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">ActivityConfig</span><span class="p">,</span>
    <span class="n">input_csv</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">BoundLogger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActivityETLResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience function to run activity ETL pipeline.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Activity configuration</span>
<span class="sd">        input_csv: Optional input CSV with filter IDs</span>
<span class="sd">        logger: Optional structured logger</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with processed data and metadata</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ActivityPipeline</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_csv</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="testitems">Testitems<a class="headerlink" href="#testitems" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.testitem.pipeline" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.testitem.pipeline</span>


<a href="#library.testitem.pipeline" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Main ETL pipeline orchestration for testitem data.</p>










  <div class="doc doc-children">







<h3 id="library.testitem.pipeline-classes">Classes<a href="#library.testitem.pipeline-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.testitem.pipeline.TestitemETLResult" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TestitemETLResult</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#library.testitem.pipeline.TestitemETLResult" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">TestitemETLResult</span><span class="p">(</span>
    <span class="n">testitems</span><span class="p">,</span>
    <span class="n">qc</span><span class="p">,</span>
    <span class="n">meta</span><span class="p">,</span>
    <span class="n">correlation_analysis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">correlation_reports</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">correlation_insights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


        <p>Container for ETL artefacts.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.testitem.pipeline.TestitemHTTPError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TestitemHTTPError</span>


<a href="#library.testitem.pipeline.TestitemHTTPError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            TestitemPipelineError (library.testitem.pipeline.TestitemPipelineError)" href="#library.testitem.pipeline.TestitemPipelineError">TestitemPipelineError</a></code></p>


        <p>Raised when upstream HTTP requests fail irrecoverably.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.testitem.pipeline.TestitemIOError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TestitemIOError</span>


<a href="#library.testitem.pipeline.TestitemIOError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            TestitemPipelineError (library.testitem.pipeline.TestitemPipelineError)" href="#library.testitem.pipeline.TestitemPipelineError">TestitemPipelineError</a></code></p>


        <p>Raised when reading or writing files fails.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.testitem.pipeline.TestitemPipelineError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TestitemPipelineError</span>


<a href="#library.testitem.pipeline.TestitemPipelineError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="RuntimeError">RuntimeError</span></code></p>


        <p>Base class for testitem pipeline errors.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.testitem.pipeline.TestitemQCError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TestitemQCError</span>


<a href="#library.testitem.pipeline.TestitemQCError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            TestitemPipelineError (library.testitem.pipeline.TestitemPipelineError)" href="#library.testitem.pipeline.TestitemPipelineError">TestitemPipelineError</a></code></p>


        <p>Raised when QC checks do not pass configured thresholds.</p>









    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.testitem.pipeline.TestitemValidationError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TestitemValidationError</span>


<a href="#library.testitem.pipeline.TestitemValidationError" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            TestitemPipelineError (library.testitem.pipeline.TestitemPipelineError)" href="#library.testitem.pipeline.TestitemPipelineError">TestitemPipelineError</a></code></p>


        <p>Raised when the input data does not meet schema expectations.</p>









    </div>

</div>
<h3 id="library.testitem.pipeline-functions">Functions<a href="#library.testitem.pipeline-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.testitem.pipeline.read_testitem_input" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">read_testitem_input</span>


<a href="#library.testitem.pipeline.read_testitem_input" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">read_testitem_input</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load the input CSV containing testitem identifiers.</p>


            <details class="quote">
              <summary>Source code in <code>library\testitem\pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_testitem_input</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the input CSV containing testitem identifiers.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">TestitemIOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input CSV not found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
    <span class="k">except</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">EmptyDataError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">TestitemValidationError</span><span class="p">(</span><span class="s2">&quot;Input CSV is empty&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover - filesystem-level errors are rare</span>
        <span class="k">raise</span> <span class="n">TestitemIOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read input CSV: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
    <span class="k">return</span> <span class="n">frame</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.testitem.pipeline.run_testitem_etl" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">run_testitem_etl</span>


<a href="#library.testitem.pipeline.run_testitem_etl" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run_testitem_etl</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute the testitem ETL pipeline returning enriched artefacts.</p>


            <details class="quote">
              <summary>Source code in <code>library\testitem\pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_testitem_etl</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">TestitemConfig</span><span class="p">,</span>
    <span class="n">input_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">input_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TestitemETLResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the testitem ETL pipeline returning enriched artefacts.&quot;&quot;&quot;</span>

    <span class="c1"># Load input data if not provided</span>
    <span class="k">if</span> <span class="n">input_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">input_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TestitemValidationError</span><span class="p">(</span><span class="s2">&quot;Either input_data or input_path must be provided&quot;</span><span class="p">)</span>
        <span class="n">input_data</span> <span class="o">=</span> <span class="n">read_testitem_input</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span>

    <span class="c1"># Normalize input columns</span>
    <span class="n">normalised</span> <span class="o">=</span> <span class="n">_normalise_columns</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>

    <span class="c1"># Apply limit if configured</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">normalised</span> <span class="o">=</span> <span class="n">normalised</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span><span class="p">)</span>

    <span class="c1"># Check for duplicates and drop them deterministically (keep first)</span>
    <span class="k">if</span> <span class="s2">&quot;molecule_chembl_id&quot;</span> <span class="ow">in</span> <span class="n">normalised</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">duplicates_mask</span> <span class="o">=</span> <span class="n">normalised</span><span class="p">[</span><span class="s2">&quot;molecule_chembl_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">duplicates_mask</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
            <span class="n">dup_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duplicates_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">dup_count</span><span class="si">}</span><span class="s2"> duplicate molecule_chembl_id values — keeping first occurrences and dropping the rest&quot;</span><span class="p">)</span>
            <span class="n">normalised</span> <span class="o">=</span> <span class="n">normalised</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">duplicates_mask</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">normalised</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No testitem data to process&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TestitemETLResult</span><span class="p">(</span>
            <span class="n">testitems</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span>
            <span class="n">qc</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;row_count&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]),</span>
            <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pipeline_version&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">pipeline_version</span><span class="p">,</span> <span class="s2">&quot;row_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="c1"># S01: Get ChEMBL status and release</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;S01: Getting ChEMBL status and release...&quot;</span><span class="p">)</span>
    <span class="n">chembl_client</span> <span class="o">=</span> <span class="n">_create_chembl_client</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">status_info</span> <span class="o">=</span> <span class="n">chembl_client</span><span class="o">.</span><span class="n">get_chembl_status</span><span class="p">()</span>
        <span class="n">chembl_release</span> <span class="o">=</span> <span class="n">status_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chembl_release&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chembl_release</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chembl_release</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ChEMBL release: </span><span class="si">{</span><span class="n">chembl_release</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get ChEMBL status: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">chembl_release</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="c1"># Create PubChem client if enabled</span>
    <span class="n">pubchem_client</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">enable_pubchem</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pubchem_client</span> <span class="o">=</span> <span class="n">_create_pubchem_client</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;PubChem client created successfully&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create PubChem client: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Continuing without PubChem enrichment&quot;</span><span class="p">)</span>

    <span class="c1"># S02-S10: Extract, normalize, validate data</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;S02-S10: Extracting, normalizing, and validating data...&quot;</span><span class="p">)</span>

    <span class="c1"># Extract data from APIs</span>
    <span class="n">extracted_frame</span> <span class="o">=</span> <span class="n">extract_batch_data</span><span class="p">(</span><span class="n">chembl_client</span><span class="p">,</span> <span class="n">pubchem_client</span><span class="p">,</span> <span class="n">normalised</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">extracted_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No data extracted from APIs&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TestitemETLResult</span><span class="p">(</span>
            <span class="n">testitems</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span>
            <span class="n">qc</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;row_count&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]),</span>
            <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pipeline_version&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">pipeline_version</span><span class="p">,</span> <span class="s2">&quot;row_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="c1"># Add chembl_release to all records</span>
    <span class="n">extracted_frame</span><span class="p">[</span><span class="s2">&quot;chembl_release&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chembl_release</span>

    <span class="c1"># Normalize data</span>
    <span class="n">normalized_frame</span> <span class="o">=</span> <span class="n">normalize_testitem_data</span><span class="p">(</span><span class="n">extracted_frame</span><span class="p">)</span>

    <span class="c1"># Validate data</span>
    <span class="n">validated_frame</span> <span class="o">=</span> <span class="n">validate_testitem_data</span><span class="p">(</span><span class="n">normalized_frame</span><span class="p">)</span>

    <span class="c1"># Calculate QC metrics</span>
    <span class="n">qc_metrics</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;row_count&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">validated_frame</span><span class="p">))},</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;chembl_release&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">chembl_release</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;pubchem_enabled&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">enable_pubchem</span><span class="p">},</span>
    <span class="p">]</span>

    <span class="c1"># Add source-specific metrics</span>
    <span class="k">if</span> <span class="s2">&quot;source_system&quot;</span> <span class="ow">in</span> <span class="n">validated_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">source_counts</span> <span class="o">=</span> <span class="n">validated_frame</span><span class="p">[</span><span class="s2">&quot;source_system&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">qc_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;source_counts&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">source_counts</span><span class="p">})</span>

    <span class="c1"># Add PubChem enrichment metrics</span>
    <span class="k">if</span> <span class="s2">&quot;pubchem_cid&quot;</span> <span class="ow">in</span> <span class="n">validated_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">pubchem_count</span> <span class="o">=</span> <span class="n">validated_frame</span><span class="p">[</span><span class="s2">&quot;pubchem_cid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">qc_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;pubchem_enriched_records&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">pubchem_count</span><span class="p">)})</span>

    <span class="c1"># Add error metrics</span>
    <span class="k">if</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">validated_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">error_count</span> <span class="o">=</span> <span class="n">validated_frame</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">qc_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;records_with_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">error_count</span><span class="p">)})</span>

    <span class="n">qc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">qc_metrics</span><span class="p">)</span>

    <span class="c1"># Create metadata</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;pipeline_version&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">pipeline_version</span><span class="p">,</span>
        <span class="s2">&quot;chembl_release&quot;</span><span class="p">:</span> <span class="n">chembl_release</span><span class="p">,</span>
        <span class="s2">&quot;row_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">validated_frame</span><span class="p">),</span>
        <span class="s2">&quot;extraction_parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;total_molecules&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">validated_frame</span><span class="p">),</span>
            <span class="s2">&quot;pubchem_enabled&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">enable_pubchem</span><span class="p">,</span>
            <span class="s2">&quot;allow_parent_missing&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">allow_parent_missing</span><span class="p">,</span>
            <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="p">,</span> <span class="s1">&#39;batch_size&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
            <span class="s2">&quot;retries&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="p">,</span> <span class="s1">&#39;retries&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="s2">&quot;timeout_sec&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">runtime</span><span class="p">,</span> <span class="s1">&#39;timeout_sec&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># Perform correlation analysis if enabled in config</span>
    <span class="n">correlation_analysis</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">correlation_reports</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">correlation_insights</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s1">&#39;postprocess&#39;</span><span class="p">)</span> <span class="ow">and</span> 
        <span class="nb">hasattr</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">postprocess</span><span class="p">,</span> <span class="s1">&#39;correlation&#39;</span><span class="p">)</span> <span class="ow">and</span> 
        <span class="n">config</span><span class="o">.</span><span class="n">postprocess</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">enabled</span> <span class="ow">and</span> 
        <span class="nb">len</span><span class="p">(</span><span class="n">validated_frame</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing correlation analysis...&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input data shape: </span><span class="si">{</span><span class="n">validated_frame</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input columns: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">validated_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Подготавливаем данные для корреляционного анализа</span>
            <span class="n">analysis_df</span> <span class="o">=</span> <span class="n">prepare_data_for_correlation_analysis</span><span class="p">(</span>
                <span class="n">validated_frame</span><span class="p">,</span> 
                <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;testitems&quot;</span><span class="p">,</span> 
                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
            <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prepared data shape: </span><span class="si">{</span><span class="n">analysis_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Correlation analysis: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> numeric columns, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Columns for analysis: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">analysis_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">analysis_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting enhanced correlation analysis...&quot;</span><span class="p">)</span>
                <span class="c1"># Perform correlation analysis</span>
                <span class="n">correlation_analysis</span> <span class="o">=</span> <span class="n">build_enhanced_correlation_analysis</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enhanced correlation analysis completed&quot;</span><span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Building correlation reports...&quot;</span><span class="p">)</span>
                <span class="n">correlation_reports</span> <span class="o">=</span> <span class="n">build_enhanced_correlation_reports</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation_reports</span><span class="p">)</span><span class="si">}</span><span class="s2"> correlation reports&quot;</span><span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Building correlation insights...&quot;</span><span class="p">)</span>
                <span class="n">correlation_insights</span> <span class="o">=</span> <span class="n">build_correlation_insights</span><span class="p">(</span><span class="n">analysis_df</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Correlation analysis completed. Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation_insights</span><span class="p">)</span><span class="si">}</span><span class="s2"> insights.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Not enough numeric columns for correlation analysis&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available columns: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">analysis_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during correlation analysis: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Traceback: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Continue without correlation analysis</span>

    <span class="k">return</span> <span class="n">TestitemETLResult</span><span class="p">(</span>
        <span class="n">testitems</span><span class="o">=</span><span class="n">validated_frame</span><span class="p">,</span> 
        <span class="n">qc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
        <span class="n">correlation_analysis</span><span class="o">=</span><span class="n">correlation_analysis</span><span class="p">,</span>
        <span class="n">correlation_reports</span><span class="o">=</span><span class="n">correlation_reports</span><span class="p">,</span>
        <span class="n">correlation_insights</span><span class="o">=</span><span class="n">correlation_insights</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.testitem.pipeline.write_testitem_outputs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">write_testitem_outputs</span>


<a href="#library.testitem.pipeline.write_testitem_outputs" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">write_testitem_outputs</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Persist ETL artefacts to disk and return the generated paths.</p>


            <details class="quote">
              <summary>Source code in <code>library\testitem\pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_testitem_outputs</span><span class="p">(</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">TestitemETLResult</span><span class="p">,</span> 
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> 
    <span class="n">config</span><span class="p">:</span> <span class="n">TestitemConfig</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Persist ETL artefacts to disk and return the generated paths.&quot;&quot;&quot;</span>

    <span class="c1"># Get basic output paths from persist function</span>
    <span class="n">result_paths</span> <span class="o">=</span> <span class="n">persist_testitem_data</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">testitems</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="c1"># Save correlation reports if available</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">correlation_reports</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
            <span class="n">date_tag</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">correlation_dir</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;testitem_correlation_report_</span><span class="si">{</span><span class="n">date_tag</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">correlation_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">correlation_paths</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">report_name</span><span class="p">,</span> <span class="n">report_df</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">correlation_reports</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">report_path</span> <span class="o">=</span> <span class="n">correlation_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_name</span><span class="si">}</span><span class="s2">.csv&quot;</span>
                <span class="n">report_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">correlation_paths</span><span class="p">[</span><span class="n">report_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">report_path</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> correlation reports to </span><span class="si">{</span><span class="n">correlation_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">result_paths</span><span class="p">[</span><span class="s2">&quot;correlation_reports&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">correlation_paths</span>

            <span class="c1"># Save correlation insights if available</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">correlation_insights</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
                <span class="n">insights_path</span> <span class="o">=</span> <span class="n">correlation_dir</span> <span class="o">/</span> <span class="s2">&quot;correlation_insights.json&quot;</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">insights_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">correlation_insights</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">result_paths</span><span class="p">[</span><span class="s2">&quot;correlation_insights&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">insights_path</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save correlation reports: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result_paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="_2">Клиенты<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="chembl">ChEMBL<a class="headerlink" href="#chembl" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.clients.chembl" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.clients.chembl</span>


<a href="#library.clients.chembl" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>HTTP client for ChEMBL API endpoints.</p>










  <div class="doc doc-children">







<h3 id="library.clients.chembl-classes">Classes<a href="#library.clients.chembl-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.clients.chembl.ChEMBLClient" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ChEMBLClient</span>


<a href="#library.clients.chembl.ChEMBLClient" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ChEMBLClient</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            library.clients.base.BaseApiClient" href="../api/clients/#library.clients.base.BaseApiClient">BaseApiClient</a></code></p>


        <p>HTTP client for ChEMBL document endpoints.</p>








                  <details class="quote">
                    <summary>Source code in <code>library\clients\chembl.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">758</span>
<span class="normal">759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">APIClientConfig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">








<h5 id="library.clients.chembl.ChEMBLClient-functions">Functions<a href="#library.clients.chembl.ChEMBLClient-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.ChEMBLClient.fetch_by_doc_id" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_by_doc_id</span>


<a href="#library.clients.chembl.ChEMBLClient.fetch_by_doc_id" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_by_doc_id</span><span class="p">(</span><span class="n">document_chembl_id</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch document data by ChEMBL document ID.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_by_doc_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document_chembl_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch document data by ChEMBL document ID.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;document/</span><span class="si">{</span><span class="n">document_chembl_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Extract relevant document fields</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;document_chembl_id&quot;</span><span class="p">:</span> <span class="n">document_chembl_id</span><span class="p">,</span>
            <span class="s2">&quot;document_pubmed_id&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pubmed_id&quot;</span><span class="p">),</span>
            <span class="s2">&quot;document_classification&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;doc_type&quot;</span><span class="p">),</span>
            <span class="s2">&quot;referenses_on_previous_experiments&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;refs&quot;</span><span class="p">),</span>
            <span class="s2">&quot;original_experimental_document&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;original_experimental_document&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_title&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_abstract&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;abstract&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_authors&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;authors&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_journal&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;journal&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_year&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_volume&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;volume&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_issue&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;issue&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_first_page&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_page&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_last_page&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_page&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_doi&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;doi&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_patent_id&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;patent_id&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_ridx&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ridx&quot;</span><span class="p">),</span>
            <span class="s2">&quot;chembl_teaser&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;teaser&quot;</span><span class="p">),</span>
            <span class="s2">&quot;source_system&quot;</span><span class="p">:</span> <span class="s2">&quot;ChEMBL&quot;</span><span class="p">,</span>
            <span class="s2">&quot;extracted_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;Z&quot;</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch document </span><span class="si">{</span><span class="n">document_chembl_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;document_chembl_id&quot;</span><span class="p">:</span> <span class="n">document_chembl_id</span><span class="p">,</span>
            <span class="s2">&quot;source_system&quot;</span><span class="p">:</span> <span class="s2">&quot;ChEMBL&quot;</span><span class="p">,</span>
            <span class="s2">&quot;extracted_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span>
            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.ChEMBLClient.fetch_documents_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_documents_batch</span>


<a href="#library.clients.chembl.ChEMBLClient.fetch_documents_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_documents_batch</span><span class="p">(</span><span class="n">document_chembl_ids</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch multiple documents in batch.</p>
<p>ChEMBL doesn't have a true batch endpoint for documents, so we use
parallel requests with controlled concurrency.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_documents_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> 
    <span class="n">document_chembl_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch multiple documents in batch.</span>

<span class="sd">    ChEMBL doesn&#39;t have a true batch endpoint for documents, so we use</span>
<span class="sd">    parallel requests with controlled concurrency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">document_chembl_ids</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Process in chunks to avoid overwhelming the API</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">document_chembl_ids</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">document_chembl_ids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>

        <span class="c1"># For each document in the chunk, make individual requests</span>
        <span class="c1"># This is still more efficient than the original sequential approach</span>
        <span class="k">for</span> <span class="n">doc_id</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_by_doc_id</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch document </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2"> in batch: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;document_chembl_id&quot;</span><span class="p">:</span> <span class="n">doc_id</span><span class="p">,</span>
                    <span class="s2">&quot;source_system&quot;</span><span class="p">:</span> <span class="s2">&quot;ChEMBL&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;extracted_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="p">}</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.clients.chembl.TestitemChEMBLClient" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TestitemChEMBLClient</span>


<a href="#library.clients.chembl.TestitemChEMBLClient" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">TestitemChEMBLClient</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            library.clients.base.BaseApiClient" href="../api/clients/#library.clients.base.BaseApiClient">BaseApiClient</a></code></p>


        <p>HTTP client for ChEMBL molecule endpoints.</p>








                  <details class="quote">
                    <summary>Source code in <code>library\clients\chembl.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">APIClientConfig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">








<h5 id="library.clients.chembl.TestitemChEMBLClient-functions">Functions<a href="#library.clients.chembl.TestitemChEMBLClient-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_atc_classification" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_atc_classification</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_atc_classification" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_atc_classification</span><span class="p">(</span><span class="n">molecule_chembl_id</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch ATC classification data.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_atc_classification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch ATC classification data.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;atc_classification?molecule_chembl_id=</span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">&amp;format=json&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_atc_classification</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch ATC classification for </span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_atc_classification_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_atc_classification_batch</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_atc_classification_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_atc_classification_batch</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch ATC classification data for multiple molecules using proper ChEMBL API.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_atc_classification_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch ATC classification data for multiple molecules using proper ChEMBL API.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> exceeds URL limit of 25, splitting into chunks&quot;</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">),</span> <span class="mi">25</span><span class="p">):</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">molecule_chembl_ids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">25</span><span class="p">]</span>
                <span class="n">chunk_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_atc_classification_batch</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">results</span>

        <span class="c1"># Use proper ChEMBL API endpoint</span>
        <span class="n">ids_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;atc_classification.json?molecule_chembl_id__in=</span><span class="si">{</span><span class="n">ids_str</span><span class="si">}</span><span class="s2">&amp;format=json&amp;limit=1000&quot;</span>

        <span class="c1"># Make request</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="c1"># Parse results</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">classifications</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;atc_classifications&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">for</span> <span class="n">classification</span> <span class="ow">in</span> <span class="n">classifications</span><span class="p">:</span>
            <span class="n">chembl_id</span> <span class="o">=</span> <span class="n">classification</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;molecule_chembl_id&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chembl_id</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_atc_classification</span><span class="p">({</span><span class="s2">&quot;atc_classifications&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">classification</span><span class="p">]})</span>

        <span class="c1"># Add empty records for missing molecules</span>
        <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chembl_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch ATC classification batch: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Fallback to individual requests</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_atc_classification</span><span class="p">(</span><span class="n">chembl_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_compound_synonym" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_compound_synonym</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_compound_synonym" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_compound_synonym</span><span class="p">(</span><span class="n">molecule_chembl_id</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch compound synonyms.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_compound_synonym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch compound synonyms.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;compound_synonym?molecule_chembl_id=</span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">&amp;format=json&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_compound_synonym</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch compound synonym for </span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_drug" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_drug</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_drug" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_drug</span><span class="p">(</span><span class="n">molecule_chembl_id</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch drug data.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_drug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch drug data.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;drug?molecule_chembl_id=</span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">&amp;format=json&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_drug</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch drug data for </span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_drug_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_drug_batch</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_drug_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_drug_batch</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch drug data for multiple molecules using proper ChEMBL API.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_drug_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch drug data for multiple molecules using proper ChEMBL API.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> exceeds URL limit of 25, splitting into chunks&quot;</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">),</span> <span class="mi">25</span><span class="p">):</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">molecule_chembl_ids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">25</span><span class="p">]</span>
                <span class="n">chunk_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_drug_batch</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">results</span>

        <span class="c1"># Use proper ChEMBL API endpoint</span>
        <span class="n">ids_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;drug.json?molecule_chembl_id__in=</span><span class="si">{</span><span class="n">ids_str</span><span class="si">}</span><span class="s2">&amp;format=json&amp;limit=1000&quot;</span>

        <span class="c1"># Make request</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="c1"># Parse results</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">drugs</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;drugs&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">for</span> <span class="n">drug</span> <span class="ow">in</span> <span class="n">drugs</span><span class="p">:</span>
            <span class="n">chembl_id</span> <span class="o">=</span> <span class="n">drug</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;molecule_chembl_id&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chembl_id</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_drug</span><span class="p">({</span><span class="s2">&quot;drugs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">drug</span><span class="p">]})</span>

        <span class="c1"># Add empty records for missing molecules</span>
        <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chembl_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch drug batch: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Fallback to individual requests</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_drug</span><span class="p">(</span><span class="n">chembl_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_drug_warning" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_drug_warning</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_drug_warning" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_drug_warning</span><span class="p">(</span><span class="n">molecule_chembl_id</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch drug warnings.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_drug_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch drug warnings.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;drug_warning?molecule_chembl_id=</span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">&amp;format=json&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_drug_warning</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch drug warning for </span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_drug_warning_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_drug_warning_batch</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_drug_warning_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_drug_warning_batch</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch drug warnings for multiple molecules using proper ChEMBL API.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_drug_warning_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch drug warnings for multiple molecules using proper ChEMBL API.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> exceeds URL limit of 25, splitting into chunks&quot;</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">),</span> <span class="mi">25</span><span class="p">):</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">molecule_chembl_ids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">25</span><span class="p">]</span>
                <span class="n">chunk_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_drug_warning_batch</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">results</span>

        <span class="c1"># Use proper ChEMBL API endpoint</span>
        <span class="n">ids_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;drug_warning.json?molecule_chembl_id__in=</span><span class="si">{</span><span class="n">ids_str</span><span class="si">}</span><span class="s2">&amp;format=json&amp;limit=1000&quot;</span>

        <span class="c1"># Make request</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="c1"># Parse results</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;drug_warnings&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">:</span>
            <span class="n">chembl_id</span> <span class="o">=</span> <span class="n">warning</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;molecule_chembl_id&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chembl_id</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_drug_warning</span><span class="p">({</span><span class="s2">&quot;drug_warnings&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">warning</span><span class="p">]})</span>

        <span class="c1"># Add empty records for missing molecules</span>
        <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chembl_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch drug warning batch: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Fallback to individual requests</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_drug_warning</span><span class="p">(</span><span class="n">chembl_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_mechanism" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_mechanism</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_mechanism" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_mechanism</span><span class="p">(</span><span class="n">molecule_chembl_id</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch mechanism data.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_mechanism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch mechanism data.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;mechanism?molecule_chembl_id=</span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">&amp;format=json&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_mechanism</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch mechanism for </span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_mechanism_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_mechanism_batch</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_mechanism_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_mechanism_batch</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch mechanism data for multiple molecules using proper ChEMBL API.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_mechanism_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch mechanism data for multiple molecules using proper ChEMBL API.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> exceeds URL limit of 25, splitting into chunks&quot;</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">),</span> <span class="mi">25</span><span class="p">):</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">molecule_chembl_ids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">25</span><span class="p">]</span>
                <span class="n">chunk_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_mechanism_batch</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">results</span>

        <span class="c1"># Use proper ChEMBL API endpoint</span>
        <span class="n">ids_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mechanism.json?molecule_chembl_id__in=</span><span class="si">{</span><span class="n">ids_str</span><span class="si">}</span><span class="s2">&amp;format=json&amp;limit=1000&quot;</span>

        <span class="c1"># Make request</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="c1"># Parse results</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">mechanisms</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mechanisms&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">for</span> <span class="n">mechanism</span> <span class="ow">in</span> <span class="n">mechanisms</span><span class="p">:</span>
            <span class="n">chembl_id</span> <span class="o">=</span> <span class="n">mechanism</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;molecule_chembl_id&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chembl_id</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_mechanism</span><span class="p">({</span><span class="s2">&quot;mechanisms&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">mechanism</span><span class="p">]})</span>

        <span class="c1"># Add empty records for missing molecules</span>
        <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chembl_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch mechanism batch: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Fallback to individual requests</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_mechanism</span><span class="p">(</span><span class="n">chembl_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_molecule" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_molecule</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecule" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_molecule</span><span class="p">(</span><span class="n">molecule_chembl_id</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch molecule data by ChEMBL ID using proper API endpoint.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch molecule data by ChEMBL ID using proper API endpoint.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;molecule.json?molecule_chembl_id=</span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">&amp;format=json&amp;limit=1&quot;</span><span class="p">)</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_molecule</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parsed</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parsed</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_molecule_record</span><span class="p">(</span><span class="n">molecule_chembl_id</span><span class="p">,</span> <span class="s2">&quot;No data found&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch molecule </span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_molecule_record</span><span class="p">(</span><span class="n">molecule_chembl_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_molecule_form" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_molecule_form</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecule_form" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_molecule_form</span><span class="p">(</span><span class="n">molecule_chembl_id</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch molecule form data.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_molecule_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch molecule form data.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;molecule_form?molecule_chembl_id=</span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">&amp;format=json&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_molecule_form</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch molecule form for </span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_molecule_properties" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_molecule_properties</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecule_properties" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_molecule_properties</span><span class="p">(</span><span class="n">molecule_chembl_id</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch molecule properties.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_molecule_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch molecule properties.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;molecule_properties?molecule_chembl_id=</span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">&amp;format=json&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_molecule_properties</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch molecule properties for </span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_molecule_properties_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_molecule_properties_batch</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecule_properties_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_molecule_properties_batch</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch molecule properties for multiple molecules in batch.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_molecule_properties_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch molecule properties for multiple molecules in batch.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># ChEMBL supports batch requests for properties</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> exceeds ChEMBL limit of 50, splitting into chunks&quot;</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">),</span> <span class="mi">50</span><span class="p">):</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">molecule_chembl_ids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">50</span><span class="p">]</span>
                <span class="n">chunk_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_molecule_properties_batch</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">results</span>

        <span class="c1"># Prepare batch request payload</span>
        <span class="n">batch_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;molecule_chembl_ids&quot;</span><span class="p">:</span> <span class="n">molecule_chembl_ids</span><span class="p">}</span>

        <span class="c1"># Make batch request</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;molecule_properties/batch&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">batch_payload</span><span class="p">)</span>

        <span class="c1"># Parse results</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;molecule_properties&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="n">chembl_id</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;molecule_chembl_id&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chembl_id</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_molecule_properties</span><span class="p">({</span><span class="s2">&quot;molecule_properties&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">prop</span><span class="p">]})</span>

        <span class="c1"># Add empty records for missing molecules</span>
        <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chembl_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch molecule properties batch: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Fallback to individual requests</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_molecule_properties</span><span class="p">(</span><span class="n">chembl_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_molecules_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_molecules_batch</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecules_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_molecules_batch</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch multiple molecules using proper ChEMBL API.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_molecules_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch multiple molecules using proper ChEMBL API.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># ChEMBL API URL length limit requires smaller batches</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> exceeds URL limit of 25, splitting into chunks&quot;</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">),</span> <span class="mi">25</span><span class="p">):</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">molecule_chembl_ids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">25</span><span class="p">]</span>
                <span class="n">chunk_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_molecules_batch</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk_results</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">results</span>

        <span class="c1"># Use proper ChEMBL API endpoint</span>
        <span class="n">ids_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;molecule.json?molecule_chembl_id__in=</span><span class="si">{</span><span class="n">ids_str</span><span class="si">}</span><span class="s2">&amp;format=json&amp;limit=1000&quot;</span>

        <span class="c1"># Make request</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="c1"># Parse results</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">molecules</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;molecules&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">:</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_molecule</span><span class="p">({</span><span class="s2">&quot;molecules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">molecule</span><span class="p">]})</span>
            <span class="k">if</span> <span class="n">parsed</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">parsed</span><span class="p">[</span><span class="s2">&quot;molecule_chembl_id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parsed</span>

        <span class="c1"># Add empty records for missing molecules</span>
        <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chembl_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_molecule_record</span><span class="p">(</span><span class="n">chembl_id</span><span class="p">,</span> <span class="s2">&quot;Not found in API response&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch molecules batch: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Fallback to individual requests</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">chembl_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_molecule</span><span class="p">(</span><span class="n">chembl_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_molecules_batch_streaming" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_molecules_batch_streaming</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_molecules_batch_streaming" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_molecules_batch_streaming</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Stream molecules in batches using proper ChEMBL API.</p>
<p>Yields tuples: (requested_ids, parsed_molecules).
Uses molecule.json endpoint with molecule_chembl_id__in filter.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_molecules_batch_streaming</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">molecule_chembl_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stream molecules in batches using proper ChEMBL API.</span>

<span class="sd">    Yields tuples: (requested_ids, parsed_molecules).</span>
<span class="sd">    Uses molecule.json endpoint with molecule_chembl_id__in filter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">molecule_chembl_ids</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># ChEMBL API URL length limit requires smaller batches</span>
    <span class="n">effective_batch_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_chembl_ids</span><span class="p">),</span> <span class="n">effective_batch_size</span><span class="p">):</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">molecule_chembl_ids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">effective_batch_size</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Use proper ChEMBL API endpoint</span>
            <span class="n">ids_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;molecule.json?molecule_chembl_id__in=</span><span class="si">{</span><span class="n">ids_str</span><span class="si">}</span><span class="s2">&amp;format=json&amp;limit=1000&quot;</span>

            <span class="c1"># Make request</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

            <span class="c1"># Parse results</span>
            <span class="n">parsed_molecules</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">molecules</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;molecules&quot;</span><span class="p">,</span> <span class="p">[])</span>

            <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">:</span>
                <span class="n">parsed_molecule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_molecule</span><span class="p">({</span><span class="s2">&quot;molecules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">molecule</span><span class="p">]})</span>
                <span class="k">if</span> <span class="n">parsed_molecule</span><span class="p">:</span>
                    <span class="n">parsed_molecules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parsed_molecule</span><span class="p">)</span>

            <span class="c1"># Add empty records for missing molecules</span>
            <span class="n">found_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">mol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;molecule_chembl_id&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">parsed_molecules</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">chembl_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found_ids</span><span class="p">:</span>
                    <span class="n">empty_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_molecule_record</span><span class="p">(</span><span class="n">chembl_id</span><span class="p">,</span> <span class="s2">&quot;Not found in API response&quot;</span><span class="p">)</span>
                    <span class="n">parsed_molecules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empty_record</span><span class="p">)</span>

            <span class="k">yield</span> <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">parsed_molecules</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch molecules batch </span><span class="si">{</span><span class="n">batch</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Yield empty records for failed batch</span>
            <span class="n">failed_molecules</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">chembl_id</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
                <span class="n">failed_molecules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_molecule_record</span><span class="p">(</span><span class="n">chembl_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">failed_molecules</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.fetch_xref_source" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_xref_source</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.fetch_xref_source" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_xref_source</span><span class="p">(</span><span class="n">molecule_chembl_id</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch cross-reference sources.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_xref_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule_chembl_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch cross-reference sources.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;xref_source?molecule_chembl_id=</span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">&amp;format=json&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_xref_source</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch xref source for </span><span class="si">{</span><span class="n">molecule_chembl_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.get_chembl_status" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_chembl_status</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.get_chembl_status" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_chembl_status</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get ChEMBL status and release information.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_chembl_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get ChEMBL status and release information.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;chembl_release&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chembl_release&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;Z&quot;</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get ChEMBL status: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;chembl_release&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;Z&quot;</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.chembl.TestitemChEMBLClient.resolve_molregno_to_chembl_id" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">resolve_molregno_to_chembl_id</span>


<a href="#library.clients.chembl.TestitemChEMBLClient.resolve_molregno_to_chembl_id" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">resolve_molregno_to_chembl_id</span><span class="p">(</span><span class="n">molregno</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Resolve molregno to molecule_chembl_id.</p>
<p>Returns the first matching ChEMBL ID or None if not found.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\chembl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resolve_molregno_to_chembl_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molregno</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Resolve molregno to molecule_chembl_id.</span>

<span class="sd">    Returns the first matching ChEMBL ID or None if not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">molregno_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">molregno</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;molecule?molregno=</span><span class="si">{</span><span class="n">molregno_str</span><span class="si">}</span><span class="s2">&amp;format=json&quot;</span><span class="p">)</span>
        <span class="n">molecules</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;molecules&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">molecules</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">chembl_id</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;molecule_chembl_id&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chembl_id</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to resolve molregno </span><span class="si">{</span><span class="n">molregno</span><span class="si">}</span><span class="s2"> to ChEMBL ID: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="crossref">Crossref<a class="headerlink" href="#crossref" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.clients.crossref" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.clients.crossref</span>


<a href="#library.clients.crossref" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Client for the Crossref API.</p>










  <div class="doc doc-children">







<h3 id="library.clients.crossref-classes">Classes<a href="#library.clients.crossref-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.clients.crossref.CrossrefClient" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">CrossrefClient</span>


<a href="#library.clients.crossref.CrossrefClient" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">CrossrefClient</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            library.clients.base.BaseApiClient" href="../api/clients/#library.clients.base.BaseApiClient">BaseApiClient</a></code></p>


        <p>HTTP client for Crossref works.</p>








                  <details class="quote">
                    <summary>Source code in <code>library\clients\crossref.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">APIClientConfig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">








<h5 id="library.clients.crossref.CrossrefClient-functions">Functions<a href="#library.clients.crossref.CrossrefClient-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="library.clients.crossref.CrossrefClient.fetch_by_doi" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_by_doi</span>


<a href="#library.clients.crossref.CrossrefClient.fetch_by_doi" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_by_doi</span><span class="p">(</span><span class="n">doi</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch Crossref work by DOI with fallback search.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\crossref.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_by_doi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doi</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch Crossref work by DOI with fallback search.&quot;&quot;&quot;</span>

    <span class="n">encoded</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="n">doi</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">encoded</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_work</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ApiClientError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="c1"># Try graceful degradation first</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degradation_manager</span><span class="o">.</span><span class="n">should_degrade</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Crossref API failed, using graceful degradation: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">degradation_manager</span><span class="o">.</span><span class="n">get_fallback_data</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="n">doi</span><span class="p">},</span>
                <span class="n">exc</span>
            <span class="p">)</span>

        <span class="c1"># If not degrading, try fallback search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fallback_to_search doi=</span><span class="si">{</span><span class="n">doi</span><span class="si">}</span><span class="s2"> error=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;query.bibliographic&quot;</span><span class="p">:</span> <span class="n">doi</span><span class="p">})</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_work</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">ApiClientError</span> <span class="k">as</span> <span class="n">fallback_exc</span><span class="p">:</span>
            <span class="c1"># If fallback also fails, use graceful degradation</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degradation_manager</span><span class="o">.</span><span class="n">should_degrade</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fallback_exc</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Crossref fallback also failed, using graceful degradation: </span><span class="si">{</span><span class="n">fallback_exc</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">degradation_manager</span><span class="o">.</span><span class="n">get_fallback_data</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="p">{</span><span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="n">doi</span><span class="p">},</span>
                    <span class="n">fallback_exc</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.crossref.CrossrefClient.fetch_by_dois_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_by_dois_batch</span>


<a href="#library.clients.crossref.CrossrefClient.fetch_by_dois_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_by_dois_batch</span><span class="p">(</span><span class="n">dois</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch multiple works by DOIs.</p>
<p>Crossref doesn't have a true batch endpoint, so we use
individual requests with controlled concurrency.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\crossref.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_by_dois_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> 
    <span class="n">dois</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch multiple works by DOIs.</span>

<span class="sd">    Crossref doesn&#39;t have a true batch endpoint, so we use</span>
<span class="sd">    individual requests with controlled concurrency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dois</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Process in chunks to avoid overwhelming the API</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dois</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">dois</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">doi</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_by_doi</span><span class="p">(</span><span class="n">doi</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">doi</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch DOI </span><span class="si">{</span><span class="n">doi</span><span class="si">}</span><span class="s2"> in batch: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">doi</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;crossref_doi&quot;</span><span class="p">:</span> <span class="n">doi</span><span class="p">,</span>
                    <span class="s2">&quot;crossref_error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;crossref&quot;</span>
                <span class="p">}</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.crossref.CrossrefClient.fetch_by_pmid" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_by_pmid</span>


<a href="#library.clients.crossref.CrossrefClient.fetch_by_pmid" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_by_pmid</span><span class="p">(</span><span class="n">pmid</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch Crossref work by PubMed identifier with fallback query.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\crossref.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_by_pmid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pmid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch Crossref work by PubMed identifier with fallback query.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;pmid:</span><span class="si">{</span><span class="n">pmid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>
    <span class="k">except</span> <span class="n">ApiClientError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="c1"># Try graceful degradation first</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degradation_manager</span><span class="o">.</span><span class="n">should_degrade</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Crossref PMID lookup failed, using graceful degradation: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">degradation_manager</span><span class="o">.</span><span class="n">get_fallback_data</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;pmid&quot;</span><span class="p">:</span> <span class="n">pmid</span><span class="p">},</span>
                <span class="n">exc</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pmid_lookup_failed pmid=</span><span class="si">{</span><span class="n">pmid</span><span class="si">}</span><span class="s2"> error=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">[]}}</span>

    <span class="n">items</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">if</span> <span class="n">items</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_work</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pmid_fallback_to_query pmid=</span><span class="si">{</span><span class="n">pmid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">pmid</span><span class="p">})</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ApiClientError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No Crossref work found for PMID </span><span class="si">{</span><span class="n">pmid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_work</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">ApiClientError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="c1"># If fallback also fails, use graceful degradation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degradation_manager</span><span class="o">.</span><span class="n">should_degrade</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Crossref PMID fallback also failed, using graceful degradation: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">degradation_manager</span><span class="o">.</span><span class="n">get_fallback_data</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;pmid&quot;</span><span class="p">:</span> <span class="n">pmid</span><span class="p">},</span>
                <span class="n">exc</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.crossref.CrossrefClient.fetch_by_pmids_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_by_pmids_batch</span>


<a href="#library.clients.crossref.CrossrefClient.fetch_by_pmids_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_by_pmids_batch</span><span class="p">(</span><span class="n">pmids</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch multiple works by PMIDs.</p>
<p>Crossref doesn't have a true batch endpoint, so we use
individual requests with controlled concurrency.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\crossref.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_by_pmids_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pmids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch multiple works by PMIDs.</span>

<span class="sd">    Crossref doesn&#39;t have a true batch endpoint, so we use</span>
<span class="sd">    individual requests with controlled concurrency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pmids</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Process in chunks to avoid overwhelming the API</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pmids</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">pmids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">pmid</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_by_pmid</span><span class="p">(</span><span class="n">pmid</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">pmid</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch PMID </span><span class="si">{</span><span class="n">pmid</span><span class="si">}</span><span class="s2"> in batch: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">pmid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;crossref_pmid&quot;</span><span class="p">:</span> <span class="n">pmid</span><span class="p">,</span>
                    <span class="s2">&quot;crossref_error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;crossref&quot;</span>
                <span class="p">}</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="openalex">OpenAlex<a class="headerlink" href="#openalex" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.clients.openalex" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.clients.openalex</span>


<a href="#library.clients.openalex" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Client for the OpenAlex API.</p>










  <div class="doc doc-children">







<h3 id="library.clients.openalex-classes">Classes<a href="#library.clients.openalex-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.clients.openalex.OpenAlexClient" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">OpenAlexClient</span>


<a href="#library.clients.openalex.OpenAlexClient" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">OpenAlexClient</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            library.clients.base.BaseApiClient" href="../api/clients/#library.clients.base.BaseApiClient">BaseApiClient</a></code></p>


        <p>HTTP client for OpenAlex works.</p>








                  <details class="quote">
                    <summary>Source code in <code>library\clients\openalex.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">APIClientConfig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">








<h5 id="library.clients.openalex.OpenAlexClient-functions">Functions<a href="#library.clients.openalex.OpenAlexClient-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="library.clients.openalex.OpenAlexClient.fetch_by_doi" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_by_doi</span>


<a href="#library.clients.openalex.OpenAlexClient.fetch_by_doi" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_by_doi</span><span class="p">(</span><span class="n">doi</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch a work by DOI with fallback to a filter query.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\openalex.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_by_doi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doi</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch a work by DOI with fallback to a filter query.&quot;&quot;&quot;</span>

    <span class="c1"># Use OpenAlex API format: https://api.openalex.org/works/https://doi.org/{doi}</span>
    <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.openalex.org/works/https://doi.org/</span><span class="si">{</span><span class="n">doi</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_work</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ApiClientError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="c1"># Специальная обработка для ошибок 429 от OpenAlex</span>
        <span class="k">if</span> <span class="n">exc</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;openalex_rate_limited&quot;</span><span class="p">,</span>
                <span class="n">doi</span><span class="o">=</span><span class="n">doi</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;OpenAlex API rate limit exceeded. Consider getting an API key.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_record</span><span class="p">(</span><span class="n">doi</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Rate limited: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;openalex_doi_fallback doi=</span><span class="si">{</span><span class="n">doi</span><span class="si">}</span><span class="s2"> error=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Fallback to OpenAlex search API</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;doi:</span><span class="si">{</span><span class="n">doi</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_work</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">ApiClientError</span> <span class="k">as</span> <span class="n">fallback_exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fallback_exc</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_record</span><span class="p">(</span><span class="n">doi</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Rate limited: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">fallback_exc</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.openalex.OpenAlexClient.fetch_by_dois_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_by_dois_batch</span>


<a href="#library.clients.openalex.OpenAlexClient.fetch_by_dois_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_by_dois_batch</span><span class="p">(</span><span class="n">dois</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch multiple works by DOIs using filter.</p>
<p>OpenAlex supports batch queries using filter with OR operator.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\openalex.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_by_dois_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dois</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch multiple works by DOIs using filter.</span>

<span class="sd">    OpenAlex supports batch queries using filter with OR operator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dois</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Process in chunks to avoid URL length limits</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dois</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">dois</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create filter string with OR operator</span>
            <span class="n">filter_parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;doi:</span><span class="si">{</span><span class="n">doi</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">doi</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">]</span>
            <span class="n">filter_str</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filter_parts</span><span class="p">)</span>

            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="n">filter_str</span><span class="p">})</span>
            <span class="n">works</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="p">[])</span>

            <span class="c1"># Map results back to DOIs</span>
            <span class="k">for</span> <span class="n">work</span> <span class="ow">in</span> <span class="n">works</span><span class="p">:</span>
                <span class="n">doi_value</span> <span class="o">=</span> <span class="n">work</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;doi&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">doi_value</span> <span class="ow">and</span> <span class="n">doi_value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;https://doi.org/&quot;</span><span class="p">):</span>
                    <span class="n">doi_value</span> <span class="o">=</span> <span class="n">doi_value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;https://doi.org/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">doi_value</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">doi_value</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_work</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>

            <span class="c1"># Add empty records for missing DOIs</span>
            <span class="k">for</span> <span class="n">doi</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">doi</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">doi</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_record</span><span class="p">(</span><span class="n">doi</span><span class="p">,</span> <span class="s2">&quot;Not found in batch response&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch DOIs batch </span><span class="si">{</span><span class="n">chunk</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Add empty records for failed batch</span>
            <span class="k">for</span> <span class="n">doi</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">doi</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_record</span><span class="p">(</span><span class="n">doi</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.openalex.OpenAlexClient.fetch_by_pmid" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_by_pmid</span>


<a href="#library.clients.openalex.OpenAlexClient.fetch_by_pmid" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_by_pmid</span><span class="p">(</span><span class="n">pmid</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch a work by PMID with fallback search.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\openalex.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_by_pmid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pmid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch a work by PMID with fallback search.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;pmid:</span><span class="si">{</span><span class="n">pmid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_work</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;openalex_pmid_fallback pmid=</span><span class="si">{</span><span class="n">pmid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;search&quot;</span><span class="p">:</span> <span class="n">pmid</span><span class="p">})</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ApiClientError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No OpenAlex work found for PMID </span><span class="si">{</span><span class="n">pmid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_work</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">ApiClientError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="c1"># Специальная обработка для ошибок 429 от OpenAlex</span>
        <span class="k">if</span> <span class="n">exc</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;openalex_rate_limited&quot;</span><span class="p">,</span>
                <span class="n">pmid</span><span class="o">=</span><span class="n">pmid</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;OpenAlex API rate limit exceeded. Consider getting an API key.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_record</span><span class="p">(</span><span class="n">pmid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Rate limited: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.openalex.OpenAlexClient.fetch_by_pmids_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_by_pmids_batch</span>


<a href="#library.clients.openalex.OpenAlexClient.fetch_by_pmids_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_by_pmids_batch</span><span class="p">(</span><span class="n">pmids</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch multiple works by PMIDs using filter.</p>
<p>OpenAlex supports batch queries using filter with OR operator.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\openalex.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_by_pmids_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pmids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch multiple works by PMIDs using filter.</span>

<span class="sd">    OpenAlex supports batch queries using filter with OR operator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pmids</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Process in chunks to avoid URL length limits</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pmids</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">pmids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create filter string with OR operator</span>
            <span class="n">filter_parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;pmid:</span><span class="si">{</span><span class="n">pmid</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">pmid</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">]</span>
            <span class="n">filter_str</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filter_parts</span><span class="p">)</span>

            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="n">filter_str</span><span class="p">})</span>
            <span class="n">works</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="p">[])</span>

            <span class="c1"># Map results back to PMIDs</span>
            <span class="k">for</span> <span class="n">work</span> <span class="ow">in</span> <span class="n">works</span><span class="p">:</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="n">work</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ids&quot;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">pmid_value</span> <span class="o">=</span> <span class="n">ids</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pmid&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pmid_value</span> <span class="ow">and</span> <span class="n">pmid_value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;https://pubmed.ncbi.nlm.nih.gov/&quot;</span><span class="p">):</span>
                    <span class="n">pmid_value</span> <span class="o">=</span> <span class="n">pmid_value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;https://pubmed.ncbi.nlm.nih.gov/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pmid_value</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">pmid_value</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_work</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>

            <span class="c1"># Add empty records for missing PMIDs</span>
            <span class="k">for</span> <span class="n">pmid</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pmid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">pmid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_record</span><span class="p">(</span><span class="n">pmid</span><span class="p">,</span> <span class="s2">&quot;Not found in batch response&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch PMIDs batch </span><span class="si">{</span><span class="n">chunk</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Add empty records for failed batch</span>
            <span class="k">for</span> <span class="n">pmid</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">pmid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_record</span><span class="p">(</span><span class="n">pmid</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="pubmed">PubMed<a class="headerlink" href="#pubmed" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.clients.pubmed" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.clients.pubmed</span>


<a href="#library.clients.pubmed" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Client for the PubMed API.</p>










  <div class="doc doc-children">







<h3 id="library.clients.pubmed-classes">Classes<a href="#library.clients.pubmed-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.clients.pubmed.PubMedClient" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">PubMedClient</span>


<a href="#library.clients.pubmed.PubMedClient" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">PubMedClient</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            library.clients.base.BaseApiClient" href="../api/clients/#library.clients.base.BaseApiClient">BaseApiClient</a></code></p>


        <p>HTTP client for PubMed E-utilities.</p>








                  <details class="quote">
                    <summary>Source code in <code>library\clients\pubmed.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">APIClientConfig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">headers</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;Accept&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json&quot;</span><span class="p">)</span>
    <span class="n">enhanced</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="n">headers</span><span class="p">})</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">enhanced</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="semantic-scholar">Semantic Scholar<a class="headerlink" href="#semantic-scholar" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.clients.semantic_scholar" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.clients.semantic_scholar</span>


<a href="#library.clients.semantic_scholar" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Client for the Semantic Scholar API.</p>










  <div class="doc doc-children">







<h3 id="library.clients.semantic_scholar-classes">Classes<a href="#library.clients.semantic_scholar-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.clients.semantic_scholar.SemanticScholarClient" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">SemanticScholarClient</span>


<a href="#library.clients.semantic_scholar.SemanticScholarClient" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">SemanticScholarClient</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            library.clients.base.BaseApiClient" href="../api/clients/#library.clients.base.BaseApiClient">BaseApiClient</a></code></p>


        <p>HTTP client for Semantic Scholar.</p>








                  <details class="quote">
                    <summary>Source code in <code>library\clients\semantic_scholar.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">APIClientConfig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">headers</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;Accept&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json&quot;</span><span class="p">)</span>
    <span class="n">enhanced</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="n">headers</span><span class="p">})</span>

    <span class="c1"># Создаем специальную fallback стратегию для Semantic Scholar</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">library.clients.fallback</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">FallbackConfig</span><span class="p">,</span>
        <span class="n">FallbackManager</span><span class="p">,</span>
        <span class="n">SemanticScholarFallbackStrategy</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fallback_config</span> <span class="o">=</span> <span class="n">FallbackConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Минимальное количество попыток для SemanticScholar</span>
        <span class="n">base_delay</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>  <span class="c1"># Базовая задержка 10 секунд</span>
        <span class="n">max_delay</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>  <span class="c1"># Максимальная задержка 30 секунд</span>
        <span class="n">backoff_multiplier</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>  <span class="c1"># Меньший множитель</span>
        <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">fallback_strategy</span> <span class="o">=</span> <span class="n">SemanticScholarFallbackStrategy</span><span class="p">(</span><span class="n">fallback_config</span><span class="p">)</span>
    <span class="n">fallback_manager</span> <span class="o">=</span> <span class="n">FallbackManager</span><span class="p">(</span><span class="n">fallback_strategy</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">enhanced</span><span class="p">,</span> <span class="n">fallback_manager</span><span class="o">=</span><span class="n">fallback_manager</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">








<h5 id="library.clients.semantic_scholar.SemanticScholarClient-functions">Functions<a href="#library.clients.semantic_scholar.SemanticScholarClient-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="library.clients.semantic_scholar.SemanticScholarClient.fetch_by_pmids_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_by_pmids_batch</span>


<a href="#library.clients.semantic_scholar.SemanticScholarClient.fetch_by_pmids_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_by_pmids_batch</span><span class="p">(</span><span class="n">pmids</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch multiple papers by PMIDs using batch endpoint.</p>
<p>Semantic Scholar supports POST /paper/batch with up to 500 IDs.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\semantic_scholar.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_by_pmids_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pmids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch multiple papers by PMIDs using batch endpoint.</span>

<span class="sd">    Semantic Scholar supports POST /paper/batch with up to 500 IDs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pmids</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Process in chunks to respect API limits</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pmids</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">pmids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Prepare batch request payload</span>
            <span class="n">identifiers</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;PMID:</span><span class="si">{</span><span class="n">pmid</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">pmid</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">]</span>
            <span class="n">batch_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="n">identifiers</span><span class="p">}</span>

            <span class="c1"># Make batch request</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;batch&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">batch_payload</span><span class="p">)</span>

            <span class="c1"># Parse batch results</span>
            <span class="n">papers</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="p">[])</span>

            <span class="k">for</span> <span class="n">paper</span> <span class="ow">in</span> <span class="n">papers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">paper</span><span class="p">:</span>  <span class="c1"># Skip None results</span>
                    <span class="n">parsed_paper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_paper</span><span class="p">(</span><span class="n">paper</span><span class="p">)</span>
                    <span class="n">pmid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_pmid</span><span class="p">(</span><span class="n">paper</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pmid</span><span class="p">:</span>
                        <span class="n">results</span><span class="p">[</span><span class="n">pmid</span><span class="p">]</span> <span class="o">=</span> <span class="n">parsed_paper</span>

            <span class="c1"># Add empty records for missing PMIDs</span>
            <span class="k">for</span> <span class="n">pmid</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pmid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">pmid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_record</span><span class="p">(</span><span class="n">pmid</span><span class="p">,</span> <span class="s2">&quot;Not found in batch response&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch PMIDs batch </span><span class="si">{</span><span class="n">chunk</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Add empty records for failed batch</span>
            <span class="k">for</span> <span class="n">pmid</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">pmid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_empty_record</span><span class="p">(</span><span class="n">pmid</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="pubchem">PubChem<a class="headerlink" href="#pubchem" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.clients.pubchem" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.clients.pubchem</span>


<a href="#library.clients.pubchem" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>HTTP client for PubChem API endpoints.</p>










  <div class="doc doc-children">







<h3 id="library.clients.pubchem-classes">Classes<a href="#library.clients.pubchem-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.clients.pubchem.PubChemClient" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">PubChemClient</span>


<a href="#library.clients.pubchem.PubChemClient" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">PubChemClient</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">cache_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            library.clients.base.BaseApiClient" href="../api/clients/#library.clients.base.BaseApiClient">BaseApiClient</a></code></p>


        <p>HTTP client for PubChem API.</p>








                  <details class="quote">
                    <summary>Source code in <code>library\clients\pubchem.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">APIClientConfig</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">cache_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># Optional simple file cache directory for GET requests</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">cache_dir</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create PubChem cache dir </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">








<h5 id="library.clients.pubchem.PubChemClient-functions">Functions<a href="#library.clients.pubchem.PubChemClient-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="library.clients.pubchem.PubChemClient.fetch_cids_by_inchikey" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_cids_by_inchikey</span>


<a href="#library.clients.pubchem.PubChemClient.fetch_cids_by_inchikey" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_cids_by_inchikey</span><span class="p">(</span><span class="n">inchikey</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch PubChem CIDs by InChIKey.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\pubchem.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_cids_by_inchikey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inchikey</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch PubChem CIDs by InChIKey.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">inchikey</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_with_cache</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;compound/inchikey/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">/cids/JSON&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_compound_cids</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch PubChem CIDs for InChIKey </span><span class="si">{</span><span class="n">inchikey</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.pubchem.PubChemClient.fetch_cids_by_smiles" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_cids_by_smiles</span>


<a href="#library.clients.pubchem.PubChemClient.fetch_cids_by_smiles" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_cids_by_smiles</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch PubChem CIDs by SMILES (URL-encoded).</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\pubchem.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_cids_by_smiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smiles</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch PubChem CIDs by SMILES (URL-encoded).&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">smiles</span><span class="p">),</span> <span class="n">safe</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_with_cache</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;compound/smiles/</span><span class="si">{</span><span class="n">encoded</span><span class="si">}</span><span class="s2">/cids/JSON&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_compound_cids</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch PubChem CIDs for SMILES: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.pubchem.PubChemClient.fetch_compound_by_name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_compound_by_name</span>


<a href="#library.clients.pubchem.PubChemClient.fetch_compound_by_name" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_compound_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch compound CIDs by name.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\pubchem.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_compound_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch compound CIDs by name.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">safe</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_with_cache</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;compound/name/</span><span class="si">{</span><span class="n">encoded</span><span class="si">}</span><span class="s2">/cids/JSON&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_compound_cids</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch PubChem CIDs for name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.pubchem.PubChemClient.fetch_compound_properties" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_compound_properties</span>


<a href="#library.clients.pubchem.PubChemClient.fetch_compound_properties" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_compound_properties</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch compound properties by PubChem CID.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\pubchem.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_compound_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch compound properties by PubChem CID.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_with_cache</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;compound/cid/</span><span class="si">{</span><span class="n">cid</span><span class="si">}</span><span class="s2">/property/MolecularFormula,MolecularWeight,CanonicalSMILES,IsomericSMILES,InChI,InChIKey/JSON&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_compound_properties</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch PubChem properties for CID </span><span class="si">{</span><span class="n">cid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.pubchem.PubChemClient.fetch_compound_synonyms" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_compound_synonyms</span>


<a href="#library.clients.pubchem.PubChemClient.fetch_compound_synonyms" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_compound_synonyms</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch compound synonyms by PubChem CID.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\pubchem.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_compound_synonyms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch compound synonyms by PubChem CID.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_with_cache</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;compound/cid/</span><span class="si">{</span><span class="n">cid</span><span class="si">}</span><span class="s2">/synonyms/JSON&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_compound_synonyms</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch PubChem synonyms for CID </span><span class="si">{</span><span class="n">cid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.pubchem.PubChemClient.fetch_compound_xrefs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_compound_xrefs</span>


<a href="#library.clients.pubchem.PubChemClient.fetch_compound_xrefs" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_compound_xrefs</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch compound cross-references by PubChem CID.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\pubchem.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_compound_xrefs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch compound cross-references by PubChem CID.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_with_cache</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;compound/cid/</span><span class="si">{</span><span class="n">cid</span><span class="si">}</span><span class="s2">/xrefs/RegistryID,RN/JSON&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_compound_xrefs</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch PubChem xrefs for CID </span><span class="si">{</span><span class="n">cid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.pubchem.PubChemClient.fetch_compounds_properties_batch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_compounds_properties_batch</span>


<a href="#library.clients.pubchem.PubChemClient.fetch_compounds_properties_batch" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_compounds_properties_batch</span><span class="p">(</span><span class="n">cids</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch properties for multiple CIDs.</p>
<p>PubChem supports comma-separated CID lists:
compound/cid/1,2,3/property/.../JSON</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\pubchem.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_compounds_properties_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">cids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch properties for multiple CIDs.</span>

<span class="sd">    PubChem supports comma-separated CID lists:</span>
<span class="sd">    compound/cid/1,2,3/property/.../JSON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cids</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Process in batches to avoid URL length limits</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cids</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">cids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>
        <span class="n">batch_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_with_cache</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;compound/cid/</span><span class="si">{</span><span class="n">batch_str</span><span class="si">}</span><span class="s2">/property/MolecularFormula,MolecularWeight,CanonicalSMILES,IsomericSMILES,InChI,InChIKey/JSON&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Parse batch results</span>
            <span class="k">if</span> <span class="s2">&quot;PropertyTable&quot;</span> <span class="ow">in</span> <span class="n">payload</span> <span class="ow">and</span> <span class="s2">&quot;Properties&quot;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;PropertyTable&quot;</span><span class="p">]:</span>
                <span class="n">properties_list</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;PropertyTable&quot;</span><span class="p">][</span><span class="s2">&quot;Properties&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">prop_data</span> <span class="ow">in</span> <span class="n">properties_list</span><span class="p">:</span>
                    <span class="n">cid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">prop_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;CID&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">cid</span><span class="p">:</span>
                        <span class="n">parsed_props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_compound_properties</span><span class="p">({</span><span class="s2">&quot;PropertyTable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Properties&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">prop_data</span><span class="p">]}})</span>
                        <span class="n">results</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="o">=</span> <span class="n">parsed_props</span>

            <span class="c1"># Add empty records for missing CIDs</span>
            <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch PubChem properties batch </span><span class="si">{</span><span class="n">batch</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Add empty records for failed batch</span>
            <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.clients.pubchem.PubChemClient.fetch_record_smiles" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_record_smiles</span>


<a href="#library.clients.pubchem.PubChemClient.fetch_record_smiles" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_record_smiles</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch SMILES from the generic record endpoint as a fallback.</p>
<p>Parses PC_Compounds.props looking for SMILES/Isomeric/Canonical entries.</p>


            <details class="quote">
              <summary>Source code in <code>library\clients\pubchem.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_record_smiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch SMILES from the generic record endpoint as a fallback.</span>

<span class="sd">    Parses PC_Compounds.props looking for SMILES/Isomeric/Canonical entries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_with_cache</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;compound/cid/</span><span class="si">{</span><span class="n">cid</span><span class="si">}</span><span class="s2">/JSON&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch PubChem record for CID </span><span class="si">{</span><span class="n">cid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">compounds</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PC_Compounds&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">compounds</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">compounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;props&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">canon</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">iso</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">props</span><span class="p">:</span>
            <span class="n">urn</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;urn&quot;</span><span class="p">,</span> <span class="p">{})</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">urn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">urn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">!=</span> <span class="s2">&quot;smiles&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="c1"># PubChem PC schema stores string values under &#39;sval&#39;</span>
            <span class="n">s_val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sval&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s_val</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;isomeric&quot;</span><span class="p">,</span> <span class="s2">&quot;isomeric smiles&quot;</span><span class="p">,</span> <span class="s2">&quot;isomeric_smiles&quot;</span><span class="p">}:</span>
                <span class="n">iso</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s_val</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;canonical&quot;</span><span class="p">,</span> <span class="s2">&quot;canonical smiles&quot;</span><span class="p">,</span> <span class="s2">&quot;canonical_smiles&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">}:</span>
                <span class="n">canon</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s_val</span><span class="p">)</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">canon</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;pubchem_canonical_smiles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">canon</span>
        <span class="k">if</span> <span class="n">iso</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;pubchem_isomeric_smiles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iso</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse record SMILES for CID </span><span class="si">{</span><span class="n">cid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="_3">Схемы валидации<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">Документы<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.schemas.document_input_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.schemas.document_input_schema</span>


<a href="#library.schemas.document_input_schema" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Pandera schemas for document input data.</p>










  <div class="doc doc-children">







<h3 id="library.schemas.document_input_schema-classes">Classes<a href="#library.schemas.document_input_schema-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.document_input_schema.DocumentInputSchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DocumentInputSchema</span>


<a href="#library.schemas.document_input_schema.DocumentInputSchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for input document data from ChEMBL CSV files.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="library.schemas.document_output_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.schemas.document_output_schema</span>


<a href="#library.schemas.document_output_schema" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Pandera schemas for document output data.</p>










  <div class="doc doc-children">







<h3 id="library.schemas.document_output_schema-classes">Classes<a href="#library.schemas.document_output_schema-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.document_output_schema.DocumentOutputSchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DocumentOutputSchema</span>


<a href="#library.schemas.document_output_schema.DocumentOutputSchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for enriched document data from multiple sources.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.document_output_schema.DocumentQCSchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DocumentQCSchema</span>


<a href="#library.schemas.document_output_schema.DocumentQCSchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for document QC metrics.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="_5">Активности<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.schemas.input_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.schemas.input_schema</span>


<a href="#library.schemas.input_schema" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Pandera schemas describing the raw API payload.</p>










  <div class="doc doc-children">







<h3 id="library.schemas.input_schema-classes">Classes<a href="#library.schemas.input_schema-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.input_schema.RawBioactivitySchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">RawBioactivitySchema</span>


<a href="#library.schemas.input_schema.RawBioactivitySchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for raw bioactivity records fetched from the API.</p>
<p>This schema validates raw data from external APIs before normalization.
Strict mode ensures no unexpected columns are present.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="library.schemas.output_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.schemas.output_schema</span>


<a href="#library.schemas.output_schema" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Pandera schema for normalized bioactivity tables.</p>










  <div class="doc doc-children">







<h3 id="library.schemas.output_schema-classes">Classes<a href="#library.schemas.output_schema-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.output_schema.NormalizedBioactivitySchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">NormalizedBioactivitySchema</span>


<a href="#library.schemas.output_schema.NormalizedBioactivitySchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for normalized bioactivity data ready for export.</p>
<p>This schema validates normalized data after ETL processing.
All data should be clean and consistent for downstream analysis.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="targets_1">Targets<a class="headerlink" href="#targets_1" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.schemas.target_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.schemas.target_schema</span>


<a href="#library.schemas.target_schema" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Pandera schemas for target data validation.</p>










  <div class="doc doc-children">







<h3 id="library.schemas.target_schema-classes">Classes<a href="#library.schemas.target_schema-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.target_schema.TargetInputSchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TargetInputSchema</span>


<a href="#library.schemas.target_schema.TargetInputSchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for input target data from CSV files.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.target_schema.TargetNormalizedSchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TargetNormalizedSchema</span>


<a href="#library.schemas.target_schema.TargetNormalizedSchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for normalized target data after enrichment.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="assays_1">Assays<a class="headerlink" href="#assays_1" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.schemas.assay_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.schemas.assay_schema</span>


<a href="#library.schemas.assay_schema" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Pandera schemas for assay data validation.</p>










  <div class="doc doc-children">







<h3 id="library.schemas.assay_schema-classes">Classes<a href="#library.schemas.assay_schema-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.assay_schema.AssayInputSchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AssayInputSchema</span>


<a href="#library.schemas.assay_schema.AssayInputSchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for input assay data from CSV files.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.assay_schema.AssayNormalizedSchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AssayNormalizedSchema</span>


<a href="#library.schemas.assay_schema.AssayNormalizedSchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for normalized assay data ready for export.</p>
<p>This schema validates normalized data after ETL processing.
All data should be clean and consistent for downstream analysis.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.assay_schema.AssayRawSchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AssayRawSchema</span>


<a href="#library.schemas.assay_schema.AssayRawSchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for raw assay records fetched from the ChEMBL API.</p>
<p>This schema validates raw data from ChEMBL API before normalization.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="testitems_1">Testitems<a class="headerlink" href="#testitems_1" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.schemas.testitem_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.schemas.testitem_schema</span>


<a href="#library.schemas.testitem_schema" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Pandera schemas for testitem data validation.</p>










  <div class="doc doc-children">







<h3 id="library.schemas.testitem_schema-classes">Classes<a href="#library.schemas.testitem_schema-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.testitem_schema.TestitemInputSchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TestitemInputSchema</span>


<a href="#library.schemas.testitem_schema.TestitemInputSchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for input testitem data from CSV files.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.testitem_schema.TestitemNormalizedSchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TestitemNormalizedSchema</span>


<a href="#library.schemas.testitem_schema.TestitemNormalizedSchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for normalized testitem data ready for export.</p>
<p>This schema validates normalized data after ETL processing.
All data should be clean and consistent for downstream analysis.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.schemas.testitem_schema.TestitemRawSchema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TestitemRawSchema</span>


<a href="#library.schemas.testitem_schema.TestitemRawSchema" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandera.DataFrameModel">DataFrameModel</span></code></p>


        <p>Schema for raw testitem records fetched from APIs.</p>
<p>This schema validates raw data from ChEMBL and PubChem APIs before normalization.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="etl">ETL утилиты<a class="headerlink" href="#etl" title="Permanent link">&para;</a></h2>
<h3 id="extract">Extract<a class="headerlink" href="#extract" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.etl.extract" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.etl.extract</span>


<a href="#library.etl.extract" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Extraction stage of the ETL pipeline.</p>










  <div class="doc doc-children">







<h3 id="library.etl.extract-classes">Classes<a href="#library.etl.extract-classes" class="headerlink" title="Permanent link">&para;</a></h3>
<h3 id="library.etl.extract-functions">Functions<a href="#library.etl.extract-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.etl.extract.fetch_bioactivity_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">fetch_bioactivity_data</span>


<a href="#library.etl.extract.fetch_bioactivity_data" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_bioactivity_data</span><span class="p">(</span><span class="n">client_config</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Retrieve and validate bioactivity data for a single source.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\extract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_bioactivity_data</span><span class="p">(</span>
    <span class="n">client_config</span><span class="p">:</span> <span class="n">APIClientConfig</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">BoundLogger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve and validate bioactivity data for a single source.&quot;&quot;&quot;</span>

    <span class="n">schema</span> <span class="o">=</span> <span class="n">RawBioactivitySchema</span><span class="o">.</span><span class="n">to_schema</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">BioactivityClient</span><span class="p">(</span><span class="n">client_config</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">fetch_records</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">records</span><span class="p">:</span>
        <span class="n">empty_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">validated</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">empty_df</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;extract_complete: </span><span class="si">{</span><span class="n">client_config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, 0 строк&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">validated</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
    <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;retrieved_at&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="s2">&quot;retrieved_at&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">validated</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;extract_complete: </span><span class="si">{</span><span class="n">client_config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">validated</span><span class="p">)</span><span class="si">}</span><span class="s2"> строк&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">validated</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="transform">Transform<a class="headerlink" href="#transform" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.etl.transform" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.etl.transform</span>


<a href="#library.etl.transform" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Transformation logic for the ETL pipeline.</p>










  <div class="doc doc-children">







<h3 id="library.etl.transform-classes">Classes<a href="#library.etl.transform-classes" class="headerlink" title="Permanent link">&para;</a></h3>
<h3 id="library.etl.transform-functions">Functions<a href="#library.etl.transform-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.etl.transform.normalize_bioactivity_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">normalize_bioactivity_data</span>


<a href="#library.etl.transform.normalize_bioactivity_data" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">normalize_bioactivity_data</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">determinism</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Normalize raw bioactivity data to a consistent schema using configuration.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\transform.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_bioactivity_data</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">transforms</span><span class="p">:</span> <span class="n">TransformSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">determinism</span><span class="p">:</span> <span class="n">DeterminismSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">BoundLogger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize raw bioactivity data to a consistent schema using configuration.&quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">library.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeterminismSettings</span> <span class="k">as</span> <span class="n">_DeterminismSettings</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">library.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">TransformSettings</span> <span class="k">as</span> <span class="n">_TransformSettings</span>

    <span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span> <span class="ow">or</span> <span class="n">_TransformSettings</span><span class="p">()</span>
    <span class="n">determinism</span> <span class="o">=</span> <span class="n">determinism</span> <span class="ow">or</span> <span class="n">_DeterminismSettings</span><span class="p">()</span>

    <span class="n">raw_schema</span> <span class="o">=</span> <span class="n">RawBioactivitySchema</span><span class="o">.</span><span class="n">to_schema</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">validated</span> <span class="o">=</span> <span class="n">raw_schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">SchemaErrors</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">failure_cases</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="s2">&quot;failure_cases&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">failure_cases</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;column&quot;</span> <span class="ow">in</span> <span class="n">failure_cases</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">failure_cases</span><span class="p">[</span><span class="s2">&quot;column&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;activity_units&quot;</span>
            <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">invalid</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">({</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">failure_cases</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s2">&quot;failure_case&quot;</span><span class="p">]})</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported activity units: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
        <span class="k">raise</span>
    <span class="k">if</span> <span class="n">validated</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">normalized_schema</span> <span class="o">=</span> <span class="n">NormalizedBioactivitySchema</span><span class="o">.</span><span class="n">to_schema</span><span class="p">()</span>
        <span class="n">empty</span> <span class="o">=</span> <span class="n">normalized_schema</span><span class="o">.</span><span class="n">empty_dataframe</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="k">return</span> <span class="n">normalized_schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">empty</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">normalized</span> <span class="o">=</span> <span class="n">validated</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">normalized</span><span class="p">[</span><span class="s2">&quot;retrieved_at&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">normalized</span><span class="p">[</span><span class="s2">&quot;retrieved_at&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Маппим колонки из ChEMBL API в стандартный формат</span>
    <span class="c1"># compound_id удален - используется только для документов</span>
    <span class="k">if</span> <span class="s2">&quot;canonical_smiles&quot;</span> <span class="ow">in</span> <span class="n">normalized</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;canonical_smiles&quot;</span><span class="p">:</span> <span class="s2">&quot;smiles&quot;</span><span class="p">})</span>
    <span class="k">if</span> <span class="s2">&quot;target_pref_name&quot;</span> <span class="ow">in</span> <span class="n">normalized</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;target_pref_name&quot;</span><span class="p">:</span> <span class="s2">&quot;target&quot;</span><span class="p">})</span>

    <span class="c1"># Преобразуем значения активности</span>
    <span class="n">normalized</span><span class="p">[</span><span class="s2">&quot;activity_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_convert_to_nanomolar</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="n">transforms</span><span class="o">.</span><span class="n">unit_conversion</span><span class="p">)</span>
    <span class="n">normalized</span><span class="p">[</span><span class="s2">&quot;activity_unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;nM&quot;</span>

    <span class="c1"># Удаляем старые колонки</span>
    <span class="n">columns_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;activity_units&quot;</span><span class="p">,</span> <span class="s2">&quot;standard_units&quot;</span><span class="p">,</span> <span class="s2">&quot;standard_value&quot;</span><span class="p">]</span>
    <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns_to_drop</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">normalized</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

    <span class="c1"># Сохраняем только колонки, указанные в column_order</span>
    <span class="n">desired_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">determinism</span><span class="o">.</span><span class="n">column_order</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">normalized</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="c1"># Исключаем лишние колонки - сохраняем только те, что указаны в конфигурации</span>
    <span class="k">if</span> <span class="n">desired_order</span><span class="p">:</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span><span class="p">[</span><span class="n">desired_order</span><span class="p">]</span>

    <span class="n">sort_by</span> <span class="o">=</span> <span class="n">determinism</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">by</span> <span class="ow">or</span> <span class="n">desired_order</span>
    <span class="n">sort_ascending</span> <span class="o">=</span> <span class="n">_resolve_ascending</span><span class="p">(</span><span class="n">sort_by</span><span class="p">,</span> <span class="n">determinism</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">ascending</span><span class="p">)</span>
    <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
        <span class="n">sort_by</span><span class="p">,</span>
        <span class="n">ascending</span><span class="o">=</span><span class="n">sort_ascending</span><span class="p">,</span>
        <span class="n">na_position</span><span class="o">=</span><span class="n">determinism</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">na_position</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">NormalizedBioactivitySchema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;transform_complete: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2"> строк&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="load">Load<a class="headerlink" href="#load" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.etl.load" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.etl.load</span>


<a href="#library.etl.load" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Loading stage utilities for the ETL pipeline.</p>










  <div class="doc doc-children">







<h3 id="library.etl.load-classes">Classes<a href="#library.etl.load-classes" class="headerlink" title="Permanent link">&para;</a></h3>
<h3 id="library.etl.load-functions">Functions<a href="#library.etl.load-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.etl.load.write_deterministic_csv" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">write_deterministic_csv</span>


<a href="#library.etl.load.write_deterministic_csv" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">write_deterministic_csv</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span>
    <span class="n">destination</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">determinism</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">postprocess</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Persist data to disk in a deterministic order using atomic writes.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\load.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_deterministic_csv</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">destination</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">BoundLogger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">determinism</span><span class="p">:</span> <span class="n">DeterminismSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output</span><span class="p">:</span> <span class="n">OutputSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">postprocess</span><span class="p">:</span> <span class="n">PostprocessSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Persist data to disk in a deterministic order using atomic writes.&quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">library.config</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">CsvFormatSettings</span> <span class="k">as</span> <span class="n">_CsvFormatSettings</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">library.config</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">DeterminismSettings</span> <span class="k">as</span> <span class="n">_DeterminismSettings</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">library.config</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">ParquetFormatSettings</span> <span class="k">as</span> <span class="n">_ParquetFormatSettings</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">library.io_.atomic_writes</span><span class="w"> </span><span class="kn">import</span> <span class="n">atomic_write_context</span>

    <span class="n">determinism</span> <span class="o">=</span> <span class="n">determinism</span> <span class="ow">or</span> <span class="n">_DeterminismSettings</span><span class="p">()</span>
    <span class="n">csv_settings</span><span class="p">:</span> <span class="n">CsvFormatSettings</span>
    <span class="n">parquet_settings</span><span class="p">:</span> <span class="n">ParquetFormatSettings</span>
    <span class="n">file_format</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span>

    <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">csv_settings</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">csv</span>
        <span class="n">parquet_settings</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">parquet</span>
        <span class="n">file_format</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">format</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover - fallback for direct usage</span>
        <span class="n">csv_settings</span> <span class="o">=</span> <span class="n">_CsvFormatSettings</span><span class="p">()</span>
        <span class="n">parquet_settings</span> <span class="o">=</span> <span class="n">_ParquetFormatSettings</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">df_to_write</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Добавляем столбец index с порядковыми номерами строк (начиная с 0)</span>
        <span class="c1"># Но только если это не QC отчет (который уже имеет структуру metric/value)</span>
        <span class="n">df_to_write</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_qc_report</span><span class="p">(</span><span class="n">df_to_write</span><span class="p">):</span>
            <span class="c1"># Проверяем, существует ли уже колонка index</span>
            <span class="k">if</span> <span class="s1">&#39;index&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df_to_write</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df_to_write</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_to_write</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;index_column_added: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_to_write</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> колонок, первые: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">df_to_write</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;index_column_exists: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_to_write</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> колонок, первые: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">df_to_write</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Применяем детерминистический порядок колонок после добавления index</span>
        <span class="n">df_to_write</span> <span class="o">=</span> <span class="n">_deterministic_order</span><span class="p">(</span><span class="n">df_to_write</span><span class="p">,</span> <span class="n">determinism</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;deterministic_order_applied: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_to_write</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> колонок, первые: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">df_to_write</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Нормализуем данные перед сохранением</span>
        <span class="n">df_to_write</span> <span class="o">=</span> <span class="n">_normalize_dataframe</span><span class="p">(</span><span class="n">df_to_write</span><span class="p">,</span> <span class="n">determinism</span><span class="o">=</span><span class="n">determinism</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="c1"># Очищаем старые backup файлы перед записью</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">library.io_.atomic_writes</span><span class="w"> </span><span class="kn">import</span> <span class="n">cleanup_backups</span>
    <span class="n">backup_count</span> <span class="o">=</span> <span class="n">cleanup_backups</span><span class="p">(</span><span class="n">destination</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">backup_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;cleaned_up_backups&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">backup_count</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>

    <span class="c1"># Use atomic writes for safe file operations</span>
    <span class="k">with</span> <span class="n">atomic_write_context</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_path</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;parquet&quot;</span><span class="p">:</span>
            <span class="n">df_to_write</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">temp_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">parquet_settings</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">_csv_options</span><span class="p">(</span><span class="n">csv_settings</span><span class="p">)</span>
            <span class="n">df_to_write</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">temp_path</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;load_complete: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_to_write</span><span class="p">)</span><span class="si">}</span><span class="s2"> строк&quot;</span><span class="p">)</span>

    <span class="c1"># Очищаем backup файлы после успешной записи</span>
    <span class="n">backup_count</span> <span class="o">=</span> <span class="n">cleanup_backups</span><span class="p">(</span><span class="n">destination</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">backup_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;cleaned_up_backups_after_write&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">backup_count</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>

    <span class="c1"># Автоматически генерируем и сохраняем QC и корреляционные таблицы</span>
    <span class="c1"># Но только для основных данных, не для самих QC отчетов и корреляций</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_report_file</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
        <span class="n">_auto_generate_qc_and_correlation_reports</span><span class="p">(</span>
            <span class="n">df_to_write</span><span class="p">,</span> 
            <span class="n">destination</span><span class="p">,</span> 
            <span class="n">output</span><span class="p">,</span> 
            <span class="n">postprocess</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">destination</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.etl.load.write_qc_artifacts" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">write_qc_artifacts</span>


<a href="#library.etl.load.write_qc_artifacts" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">write_qc_artifacts</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span>
    <span class="n">qc_path</span><span class="p">,</span>
    <span class="n">corr_path</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">validation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">postprocess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Write QC and correlation reports according to configuration.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\load.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_qc_artifacts</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">qc_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">corr_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">output</span><span class="p">:</span> <span class="n">OutputSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">validation</span><span class="p">:</span> <span class="n">QCValidationSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">postprocess</span><span class="p">:</span> <span class="n">PostprocessSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">BoundLogger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write QC and correlation reports according to configuration.&quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">library.config</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">CsvFormatSettings</span> <span class="k">as</span> <span class="n">_CsvFormatSettings</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">library.config</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">ParquetFormatSettings</span> <span class="k">as</span> <span class="n">_ParquetFormatSettings</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">library.config</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">PostprocessSettings</span> <span class="k">as</span> <span class="n">_PostprocessSettings</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">library.config</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">QCValidationSettings</span> <span class="k">as</span> <span class="n">_QCValidationSettings</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">csv_settings</span><span class="p">:</span> <span class="n">CsvFormatSettings</span>
    <span class="n">parquet_settings</span><span class="p">:</span> <span class="n">ParquetFormatSettings</span>
    <span class="n">file_format</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span>

    <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">csv_settings</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">csv</span>
        <span class="n">parquet_settings</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">parquet</span>
        <span class="n">file_format</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">format</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover - fallback for direct usage</span>
        <span class="n">csv_settings</span> <span class="o">=</span> <span class="n">_CsvFormatSettings</span><span class="p">()</span>
        <span class="n">parquet_settings</span> <span class="o">=</span> <span class="n">_ParquetFormatSettings</span><span class="p">()</span>

    <span class="n">validation</span> <span class="o">=</span> <span class="n">validation</span> <span class="ow">or</span> <span class="n">_QCValidationSettings</span><span class="p">()</span>
    <span class="n">postprocess</span> <span class="o">=</span> <span class="n">postprocess</span> <span class="ow">or</span> <span class="n">_PostprocessSettings</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">postprocess</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Базовая QC отчетность</span>
    <span class="n">qc_report</span> <span class="o">=</span> <span class="n">build_qc_report</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">qc_report</span> <span class="o">=</span> <span class="n">_apply_qc_thresholds</span><span class="p">(</span><span class="n">qc_report</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">validation</span><span class="p">)</span>
    <span class="n">qc_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;parquet&quot;</span><span class="p">:</span>
        <span class="n">qc_report</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">qc_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">parquet_settings</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">qc_report</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">qc_path</span><span class="p">,</span> <span class="o">**</span><span class="n">_csv_options</span><span class="p">(</span><span class="n">csv_settings</span><span class="p">))</span>

    <span class="c1"># Расширенная QC отчетность</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">postprocess</span><span class="o">.</span><span class="n">qc</span><span class="p">,</span> <span class="s1">&#39;enhanced&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">postprocess</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">enhanced</span><span class="p">:</span>
        <span class="n">enhanced_qc_path</span> <span class="o">=</span> <span class="n">qc_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">qc_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_enhanced.csv&quot;</span>
        <span class="n">detailed_qc_path</span> <span class="o">=</span> <span class="n">qc_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">qc_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_detailed&quot;</span>

        <span class="c1"># Создаем расширенный отчет</span>
        <span class="n">enhanced_report</span> <span class="o">=</span> <span class="n">build_enhanced_qc_report</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;parquet&quot;</span><span class="p">:</span>
            <span class="n">enhanced_report</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">enhanced_qc_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.parquet&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">parquet_settings</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">enhanced_report</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">enhanced_qc_path</span><span class="p">,</span> <span class="o">**</span><span class="n">_csv_options</span><span class="p">(</span><span class="n">csv_settings</span><span class="p">))</span>

        <span class="c1"># Создаем детальные отчеты</span>
        <span class="n">detailed_reports</span> <span class="o">=</span> <span class="n">build_enhanced_qc_detailed_reports</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">detailed_qc_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">report_name</span><span class="p">,</span> <span class="n">report_df</span> <span class="ow">in</span> <span class="n">detailed_reports</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">report_path</span> <span class="o">=</span> <span class="n">detailed_qc_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_name</span><span class="si">}</span><span class="s2">.csv&quot;</span>
            <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;parquet&quot;</span><span class="p">:</span>
                <span class="n">report_df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">report_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.parquet&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">parquet_settings</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">report_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="o">**</span><span class="n">_csv_options</span><span class="p">(</span><span class="n">csv_settings</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">postprocess</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Базовая корреляционная матрица</span>
    <span class="n">correlation</span> <span class="o">=</span> <span class="n">build_correlation_matrix</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">corr_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;parquet&quot;</span><span class="p">:</span>
        <span class="n">correlation</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">corr_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">parquet_settings</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">correlation</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">corr_path</span><span class="p">,</span> <span class="o">**</span><span class="n">_csv_options</span><span class="p">(</span><span class="n">csv_settings</span><span class="p">))</span>

    <span class="c1"># Расширенный корреляционный анализ</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">postprocess</span><span class="o">.</span><span class="n">correlation</span><span class="p">,</span> <span class="s1">&#39;enhanced&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">postprocess</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">enhanced</span><span class="p">:</span>
        <span class="n">enhanced_corr_path</span> <span class="o">=</span> <span class="n">corr_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">corr_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_enhanced&quot;</span>
        <span class="n">detailed_corr_path</span> <span class="o">=</span> <span class="n">corr_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">corr_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_detailed&quot;</span>

        <span class="c1"># Создаем расширенные корреляционные отчеты</span>
        <span class="n">enhanced_corr_reports</span> <span class="o">=</span> <span class="n">build_enhanced_correlation_reports_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">enhanced_corr_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">report_name</span><span class="p">,</span> <span class="n">report_df</span> <span class="ow">in</span> <span class="n">enhanced_corr_reports</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">report_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">report_path</span> <span class="o">=</span> <span class="n">enhanced_corr_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_name</span><span class="si">}</span><span class="s2">.csv&quot;</span>
                <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;parquet&quot;</span><span class="p">:</span>
                    <span class="n">report_df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">report_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.parquet&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">parquet_settings</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">report_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="o">**</span><span class="n">_csv_options</span><span class="p">(</span><span class="n">csv_settings</span><span class="p">))</span>

        <span class="c1"># Создаем детальные корреляционные отчеты</span>
        <span class="n">detailed_corr_analysis</span> <span class="o">=</span> <span class="n">build_enhanced_correlation_analysis_report</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">detailed_corr_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Сохраняем анализ в JSON формате для сложных структур</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
        <span class="n">analysis_path</span> <span class="o">=</span> <span class="n">detailed_corr_path</span> <span class="o">/</span> <span class="s2">&quot;correlation_analysis.json&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">analysis_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># Преобразуем numpy типы в JSON-совместимые</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">convert_numpy</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">obj</span>

            <span class="n">json_analysis</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">detailed_corr_analysis</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">convert_numpy</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_analysis</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Создаем отчет с инсайтами</span>
        <span class="n">insights</span> <span class="o">=</span> <span class="n">build_correlation_insights_report</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">insights</span><span class="p">:</span>
            <span class="n">insights_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">insights</span><span class="p">)</span>
            <span class="n">insights_path</span> <span class="o">=</span> <span class="n">detailed_corr_path</span> <span class="o">/</span> <span class="s2">&quot;correlation_insights.csv&quot;</span>
            <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;parquet&quot;</span><span class="p">:</span>
                <span class="n">insights_df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">insights_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.parquet&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">parquet_settings</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">insights_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">insights_path</span><span class="p">,</span> <span class="o">**</span><span class="n">_csv_options</span><span class="p">(</span><span class="n">csv_settings</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="qc">QC<a class="headerlink" href="#qc" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.etl.qc" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.etl.qc</span>


<a href="#library.etl.qc" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Quality control utilities.</p>










  <div class="doc doc-children">








<h3 id="library.etl.qc-functions">Functions<a href="#library.etl.qc-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.etl.qc.build_correlation_insights_report" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">build_correlation_insights_report</span>


<a href="#library.etl.qc.build_correlation_insights_report" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build_correlation_insights_report</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate correlation insights and recommendations.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_correlation_insights_report</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">BoundLogger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate correlation insights and recommendations.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">build_correlation_insights</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.etl.qc.build_correlation_matrix" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">build_correlation_matrix</span>


<a href="#library.etl.qc.build_correlation_matrix" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build_correlation_matrix</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute correlation matrix for numeric columns.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_correlation_matrix</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute correlation matrix for numeric columns.&quot;&quot;&quot;</span>

    <span class="n">numeric</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">numeric</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">numeric</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">numeric</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
        <span class="c1"># Заменяем NaN и inf на 0</span>
        <span class="k">return</span> <span class="n">corr_matrix</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">MemoryError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Логируем конкретные ошибки для отладки</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ошибка при вычислении корреляционной матрицы: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.etl.qc.build_enhanced_correlation_analysis_report" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">build_enhanced_correlation_analysis_report</span>


<a href="#library.etl.qc.build_enhanced_correlation_analysis_report" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build_enhanced_correlation_analysis_report</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate enhanced correlation analysis with multiple correlation types.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_enhanced_correlation_analysis_report</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">BoundLogger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate enhanced correlation analysis with multiple correlation types.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">build_enhanced_correlation_analysis</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.etl.qc.build_enhanced_correlation_reports_df" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">build_enhanced_correlation_reports_df</span>


<a href="#library.etl.qc.build_enhanced_correlation_reports_df" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build_enhanced_correlation_reports_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate enhanced correlation reports as DataFrames.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_enhanced_correlation_reports_df</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">BoundLogger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate enhanced correlation reports as DataFrames.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">build_enhanced_correlation_reports</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.etl.qc.build_enhanced_qc_detailed_reports" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">build_enhanced_qc_detailed_reports</span>


<a href="#library.etl.qc.build_enhanced_qc_detailed_reports" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build_enhanced_qc_detailed_reports</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate detailed QC reports including summary, top values, and pattern coverage.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_enhanced_qc_detailed_reports</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">BoundLogger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate detailed QC reports including summary, top values, and pattern coverage.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">build_enhanced_qc_detailed</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.etl.qc.build_enhanced_qc_report" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">build_enhanced_qc_report</span>


<a href="#library.etl.qc.build_enhanced_qc_report" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build_enhanced_qc_report</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate an enhanced QC report with detailed quality metrics.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_enhanced_qc_report</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">BoundLogger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate an enhanced QC report with detailed quality metrics.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">build_enhanced_qc_summary</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.etl.qc.build_qc_report" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">build_qc_report</span>


<a href="#library.etl.qc.build_qc_report" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build_qc_report</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a QC report with basic completeness metrics.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_qc_report</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a QC report with basic completeness metrics.&quot;&quot;&quot;</span>

    <span class="c1"># Определяем тип данных по наличию ключевых колонок</span>
    <span class="k">if</span> <span class="s2">&quot;document_chembl_id&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># Это данные документов</span>
        <span class="n">key_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;document_chembl_id&quot;</span><span class="p">,</span> <span class="s2">&quot;doi&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">]</span>
        <span class="n">available_key_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">key_columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;row_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
            <span class="s2">&quot;missing_document_chembl_id&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;document_chembl_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> 
                <span class="k">if</span> <span class="s2">&quot;document_chembl_id&quot;</span> <span class="ow">in</span> <span class="n">df</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">),</span>
            <span class="s2">&quot;missing_doi&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;doi&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="k">if</span> <span class="s2">&quot;doi&quot;</span> <span class="ow">in</span> <span class="n">df</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">),</span>
            <span class="s2">&quot;missing_title&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="k">if</span> <span class="s2">&quot;title&quot;</span> <span class="ow">in</span> <span class="n">df</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">),</span>
            <span class="s2">&quot;duplicates&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">available_key_columns</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> 
                <span class="k">if</span> <span class="n">available_key_columns</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">),</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Общие метрики для неизвестного типа данных</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;row_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
            <span class="s2">&quot;total_columns&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
            <span class="s2">&quot;duplicates&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">[{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="library.etl.enhanced_qc" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.etl.enhanced_qc</span>


<a href="#library.etl.enhanced_qc" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Расширенная система оценки качества данных с детальными метриками.</p>










  <div class="doc doc-children">







<h3 id="library.etl.enhanced_qc-classes">Classes<a href="#library.etl.enhanced_qc-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.etl.enhanced_qc.EnhancedTableQualityProfiler" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">EnhancedTableQualityProfiler</span>


<a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">EnhancedTableQualityProfiler</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


        <p>Расширенный профайлер качества данных с детальными метриками.</p>

        <p>Инициализация профайлера качества данных.</p>








                  <details class="quote">
                    <summary>Source code in <code>library\etl\enhanced_qc.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BoundLogger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Инициализация профайлера качества данных.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_patterns</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;doi&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;10\.\d{4,9}/[-._;()/:A-Z0-9]+&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="s1">&#39;issn&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b\d</span><span class="si">{4}</span><span class="s1">-\d</span><span class="si">{3}</span><span class="s1">[\dxX]\b&#39;</span><span class="p">),</span>
        <span class="s1">&#39;isbn&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b(?:ISBN[- ]?(?:13|10)?:? )?(?:97[89][- ]?)?\d{1,5}[- ]?\d{1,7}[- ]?\d{1,6}[- ]?\d\b&#39;</span><span class="p">),</span>
        <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;https?://[^\s&lt;&gt;&quot;</span><span class="si">{}</span><span class="s1">|</span><span class="se">\\</span><span class="s1">^`\[\]]+&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b&#39;</span><span class="p">),</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">








<h5 id="library.etl.enhanced_qc.EnhancedTableQualityProfiler-functions">Functions<a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="library.etl.enhanced_qc.EnhancedTableQualityProfiler.consume" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">consume</span>


<a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler.consume" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">consume</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Анализ DataFrame и генерация расширенных метрик качества.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\enhanced_qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Анализ DataFrame и генерация расширенных метрик качества.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Начинаем анализ качества данных: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> строк, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> колонок&quot;</span><span class="p">)</span>

    <span class="n">quality_report</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;table_summary&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_table_summary</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
        <span class="s1">&#39;column_analysis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_columns</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
        <span class="s1">&#39;data_patterns&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_patterns</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
        <span class="s1">&#39;statistical_summary&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_statistics</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
        <span class="s1">&#39;data_roles&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_data_roles</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Анализ качества данных завершен&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">quality_report</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.etl.enhanced_qc.EnhancedTableQualityProfiler.generate_detailed_report" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">generate_detailed_report</span>


<a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler.generate_detailed_report" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">generate_detailed_report</span><span class="p">(</span><span class="n">quality_report</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Генерация детального отчета с отдельными таблицами.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\enhanced_qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_detailed_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quality_report</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Генерация детального отчета с отдельными таблицами.&quot;&quot;&quot;</span>
    <span class="n">reports</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Сводная таблица по колонкам</span>
    <span class="n">reports</span><span class="p">[</span><span class="s1">&#39;column_summary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_summary_report</span><span class="p">(</span><span class="n">quality_report</span><span class="p">)</span>

    <span class="c1"># Таблица с топ значениями</span>
    <span class="n">top_values_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">analysis</span> <span class="ow">in</span> <span class="n">quality_report</span><span class="p">[</span><span class="s1">&#39;column_analysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">top_values</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;top_values&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">top_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">top_values_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;column&#39;</span><span class="p">:</span> <span class="n">col</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
                <span class="s1">&#39;percentage&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">count</span> <span class="o">/</span> <span class="n">quality_report</span><span class="p">[</span><span class="s1">&#39;table_summary&#39;</span><span class="p">][</span><span class="s1">&#39;total_rows&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
            <span class="p">})</span>

    <span class="k">if</span> <span class="n">top_values_data</span><span class="p">:</span>
        <span class="n">reports</span><span class="p">[</span><span class="s1">&#39;top_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">top_values_data</span><span class="p">)</span>

    <span class="c1"># Таблица с паттернами</span>
    <span class="n">pattern_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">patterns</span> <span class="ow">in</span> <span class="n">quality_report</span><span class="p">[</span><span class="s1">&#39;data_patterns&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">coverage</span> <span class="ow">in</span> <span class="n">patterns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">pattern_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;column&#39;</span><span class="p">:</span> <span class="n">col</span><span class="p">,</span>
                <span class="s1">&#39;pattern&#39;</span><span class="p">:</span> <span class="n">pattern</span><span class="p">,</span>
                <span class="s1">&#39;coverage_pct&#39;</span><span class="p">:</span> <span class="n">coverage</span>
            <span class="p">})</span>

    <span class="k">if</span> <span class="n">pattern_data</span><span class="p">:</span>
        <span class="n">reports</span><span class="p">[</span><span class="s1">&#39;pattern_coverage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pattern_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">reports</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.etl.enhanced_qc.EnhancedTableQualityProfiler.generate_summary_report" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">generate_summary_report</span>


<a href="#library.etl.enhanced_qc.EnhancedTableQualityProfiler.generate_summary_report" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">generate_summary_report</span><span class="p">(</span><span class="n">quality_report</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Генерация сводного отчета по качеству данных.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\enhanced_qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_summary_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quality_report</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Генерация сводного отчета по качеству данных.&quot;&quot;&quot;</span>
    <span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">analysis</span> <span class="ow">in</span> <span class="n">quality_report</span><span class="p">[</span><span class="s1">&#39;column_analysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;column&#39;</span><span class="p">:</span> <span class="n">col</span><span class="p">,</span>
            <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dtype&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">),</span>
            <span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="n">quality_report</span><span class="p">[</span><span class="s1">&#39;data_roles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">),</span>
            <span class="s1">&#39;non_null&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;non_null&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;non_empty&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;non_empty&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;empty_pct&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;empty_pct&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;unique_cnt&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unique_cnt&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;unique_pct_of_non_empty&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unique_pct_of_non_empty&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;pattern_cov_doi&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pattern_cov_doi&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;pattern_cov_issn&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pattern_cov_issn&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;pattern_cov_isbn&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pattern_cov_isbn&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;pattern_cov_url&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pattern_cov_url&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;pattern_cov_email&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pattern_cov_email&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;bool_like_cov&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bool_like_cov&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;numeric_cov&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;numeric_cov&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;numeric_min&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;numeric_min&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;numeric_p50&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;numeric_p50&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;numeric_p95&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;numeric_p95&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;numeric_max&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;numeric_max&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;numeric_mean&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;numeric_mean&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;numeric_std&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;numeric_std&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;date_cov&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date_cov&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="s1">&#39;date_min&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date_min&#39;</span><span class="p">),</span>
            <span class="s1">&#39;date_p50&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date_p50&#39;</span><span class="p">),</span>
            <span class="s1">&#39;date_max&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date_max&#39;</span><span class="p">),</span>
            <span class="s1">&#39;text_len_min&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text_len_min&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;text_len_p50&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text_len_p50&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;text_len_p95&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text_len_p95&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;text_len_max&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text_len_max&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;top_values&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;top_values&#39;</span><span class="p">,</span> <span class="p">{})),</span>
        <span class="p">}</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h3 id="library.etl.enhanced_qc-functions">Functions<a href="#library.etl.enhanced_qc-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.etl.enhanced_qc.build_enhanced_qc_detailed" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">build_enhanced_qc_detailed</span>


<a href="#library.etl.enhanced_qc.build_enhanced_qc_detailed" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build_enhanced_qc_detailed</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Создание детального отчета о качестве данных.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\enhanced_qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_enhanced_qc_detailed</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BoundLogger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Создание детального отчета о качестве данных.&quot;&quot;&quot;</span>
    <span class="n">profiler</span> <span class="o">=</span> <span class="n">EnhancedTableQualityProfiler</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">quality_report</span> <span class="o">=</span> <span class="n">profiler</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">profiler</span><span class="o">.</span><span class="n">generate_detailed_report</span><span class="p">(</span><span class="n">quality_report</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.etl.enhanced_qc.build_enhanced_qc_report" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">build_enhanced_qc_report</span>


<a href="#library.etl.enhanced_qc.build_enhanced_qc_report" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build_enhanced_qc_report</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Создание расширенного отчета о качестве данных.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\enhanced_qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_enhanced_qc_report</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BoundLogger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Создание расширенного отчета о качестве данных.&quot;&quot;&quot;</span>
    <span class="n">profiler</span> <span class="o">=</span> <span class="n">EnhancedTableQualityProfiler</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">profiler</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.etl.enhanced_qc.build_enhanced_qc_summary" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">build_enhanced_qc_summary</span>


<a href="#library.etl.enhanced_qc.build_enhanced_qc_summary" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build_enhanced_qc_summary</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Создание сводного отчета о качестве данных.</p>


            <details class="quote">
              <summary>Source code in <code>library\etl\enhanced_qc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_enhanced_qc_summary</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BoundLogger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Создание сводного отчета о качестве данных.&quot;&quot;&quot;</span>
    <span class="n">profiler</span> <span class="o">=</span> <span class="n">EnhancedTableQualityProfiler</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">quality_report</span> <span class="o">=</span> <span class="n">profiler</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">profiler</span><span class="o">.</span><span class="n">generate_summary_report</span><span class="p">(</span><span class="n">quality_report</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="_6">Конфигурация<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="library.config" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.config</span>


<a href="#library.config" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Configuration management for the bioactivity ETL pipeline.</p>










  <div class="doc doc-children">







<h3 id="library.config-classes">Classes<a href="#library.config-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.config.APIClientConfig" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">APIClientConfig</span>


<a href="#library.config.APIClientConfig" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Configuration for a single HTTP API client.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.Config" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">Config</span>


<a href="#library.config.Config" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Top-level configuration for the ETL pipeline.</p>











  <div class="doc doc-children">








<h5 id="library.config.Config-functions">Functions<a href="#library.config.Config-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="library.config.Config.load" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">load</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#library.config.Config.load" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_prefix</span><span class="o">=</span><span class="s1">&#39;BIOACTIVITY__&#39;</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load configuration from a YAML file applying layered overrides.</p>


            <details class="quote">
              <summary>Source code in <code>library\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">overrides</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">env_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BIOACTIVITY__&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Config</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load configuration from a YAML file applying layered overrides.&quot;&quot;&quot;</span>

    <span class="n">base_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config file not found: </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">config_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">base_data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="n">env_overrides</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_load_env_overrides</span><span class="p">(</span><span class="n">env_prefix</span><span class="p">)</span>
    <span class="n">cli_overrides</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_normalize_overrides</span><span class="p">(</span><span class="n">overrides</span> <span class="ow">or</span> <span class="p">{})</span>

    <span class="n">merged</span> <span class="o">=</span> <span class="n">_merge_dicts</span><span class="p">(</span><span class="n">base_data</span><span class="p">,</span> <span class="n">env_overrides</span><span class="p">)</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="n">_merge_dicts</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">cli_overrides</span><span class="p">)</span>

    <span class="c1"># Validate against JSON Schema before processing</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">_validate_with_schema</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span>

    <span class="c1"># Process secrets</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_process_secrets</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="library.config.Config.parse_cli_overrides" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">parse_cli_overrides</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#library.config.Config.parse_cli_overrides" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">parse_cli_overrides</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Parse CLI override arguments into a dictionary.</p>


            <details class="quote">
              <summary>Source code in <code>library\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_cli_overrides</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse CLI override arguments into a dictionary.&quot;&quot;&quot;</span>
    <span class="n">assignments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Overrides must be in KEY=VALUE format&quot;</span><span class="p">)</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Override key must not be empty&quot;</span><span class="p">)</span>
        <span class="n">assignments</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">assignments</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.ConsoleLoggingSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ConsoleLoggingSettings</span>


<a href="#library.config.ConsoleLoggingSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Console logging configuration.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.CorrelationSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">CorrelationSettings</span>


<a href="#library.config.CorrelationSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Configuration for correlation matrix generation.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.CsvFormatSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">CsvFormatSettings</span>


<a href="#library.config.CsvFormatSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Formatting options for CSV outputs.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.DeterminismSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DeterminismSettings</span>


<a href="#library.config.DeterminismSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Deterministic ordering configuration.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.FileLoggingSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">FileLoggingSettings</span>


<a href="#library.config.FileLoggingSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>File logging configuration.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.HTTPGlobalSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">HTTPGlobalSettings</span>


<a href="#library.config.HTTPGlobalSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Defaults applied to all HTTP clients.</p>











  <div class="doc doc-children">





<h5 id="library.config.HTTPGlobalSettings-attributes">Attributes<a href="#library.config.HTTPGlobalSettings-attributes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="library.config.HTTPGlobalSettings.timeout" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">timeout</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#library.config.HTTPGlobalSettings.timeout" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">timeout</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Backward-compatible alias used by existing clients.</p>

    </div>

</div>






  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.HTTPSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">HTTPSettings</span>


<a href="#library.config.HTTPSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Container for HTTP configuration sections.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.HTTPSourceSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">HTTPSourceSettings</span>


<a href="#library.config.HTTPSourceSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Per-source HTTP configuration overriding the global defaults.</p>











  <div class="doc doc-children">





<h5 id="library.config.HTTPSourceSettings-attributes">Attributes<a href="#library.config.HTTPSourceSettings-attributes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="library.config.HTTPSourceSettings.timeout" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">timeout</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#library.config.HTTPSourceSettings.timeout" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">timeout</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Backward-compatible alias for legacy configuration.</p>

    </div>

</div>






  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.IOSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">IOSettings</span>


<a href="#library.config.IOSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>I/O configuration namespace.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.InputSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">InputSettings</span>


<a href="#library.config.InputSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Locations of auxiliary input artefacts.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.LoggingSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">LoggingSettings</span>


<a href="#library.config.LoggingSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Structured logging configuration.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.OutputSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">OutputSettings</span>


<a href="#library.config.OutputSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Paths and formatting for ETL outputs.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.PaginationSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">PaginationSettings</span>


<a href="#library.config.PaginationSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Pagination configuration for a data source.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.ParquetFormatSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ParquetFormatSettings</span>


<a href="#library.config.ParquetFormatSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Formatting options for Parquet outputs.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.PostprocessSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">PostprocessSettings</span>


<a href="#library.config.PostprocessSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Post-processing configuration.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.QCStepSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">QCStepSettings</span>


<a href="#library.config.QCStepSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Configuration for QC generation.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.QCValidationSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">QCValidationSettings</span>


<a href="#library.config.QCValidationSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Thresholds for QC validation.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.RateLimitSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">RateLimitSettings</span>


<a href="#library.config.RateLimitSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Rate limiting configuration for API clients.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.RetrySettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">RetrySettings</span>


<a href="#library.config.RetrySettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Retry configuration for HTTP clients.</p>











  <div class="doc doc-children">





<h5 id="library.config.RetrySettings-attributes">Attributes<a href="#library.config.RetrySettings-attributes" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="library.config.RetrySettings.max_tries" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">max_tries</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#library.config.RetrySettings.max_tries" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">max_tries</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Backward-compatible accessor for legacy code paths.</p>

    </div>

</div>






  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.RuntimeSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">RuntimeSettings</span>


<a href="#library.config.RuntimeSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Execution-related toggles exposed to the CLI.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.SortSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">SortSettings</span>


<a href="#library.config.SortSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Sorting configuration for deterministic outputs.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.SourceSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">SourceSettings</span>


<a href="#library.config.SourceSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Configuration for an individual data source.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.TransformSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TransformSettings</span>


<a href="#library.config.TransformSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Transformation configuration for normalization.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.config.ValidationSettings" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ValidationSettings</span>


<a href="#library.config.ValidationSettings" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Data validation configuration.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>
<h3 id="library.config-functions">Functions<a href="#library.config-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.config.ensure_output_directories_exist" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">ensure_output_directories_exist</span>


<a href="#library.config.ensure_output_directories_exist" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ensure_output_directories_exist</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create necessary directories for output files in configuration.</p>
<p>Creates parent directories for all output paths specified in the configuration
to ensure they exist before writing files.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Configuration object containing output paths.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>&#39;Config&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>library\config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ensure_output_directories_exist</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="s2">&quot;Config&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create necessary directories for output files in configuration.</span>

<span class="sd">    Creates parent directories for all output paths specified in the configuration</span>
<span class="sd">    to ensure they exist before writing files.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Configuration object containing output paths.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_settings</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">output</span>

    <span class="c1"># Создаем родительские директории для всех выходных путей</span>
    <span class="n">output_settings</span><span class="o">.</span><span class="n">data_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">output_settings</span><span class="o">.</span><span class="n">qc_report_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">output_settings</span><span class="o">.</span><span class="n">correlation_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="cli">CLI<a class="headerlink" href="#cli" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="library.cli" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.cli</span>


<a href="#library.cli" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Command line interface for running the bioactivity ETL pipeline.</p>










  <div class="doc doc-children">







<h3 id="library.cli-classes">Classes<a href="#library.cli-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.cli.ExitCode" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ExitCode</span>


<a href="#library.cli.ExitCode" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="int">int</span></code></p>


        <p>Enumerated exit codes for the document CLI.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.cli.TestitemExitCode" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TestitemExitCode</span>


<a href="#library.cli.TestitemExitCode" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="int">int</span></code></p>


        <p>Enumerated exit codes for the testitem CLI.</p>











  <div class="doc doc-children">












  </div>

    </div>

</div>
<h3 id="library.cli-functions">Functions<a href="#library.cli-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.cli.get_activity_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">get_activity_data</span>


<a href="#library.cli.get_activity_data" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_activity_data</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">CONFIG_OPTION</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--input&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;CSV containing filter IDs (assay_ids, molecule_ids, target_ids)&quot;</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--output-dir&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output directory&quot;</span><span class="p">),</span>
    <span class="n">date_tag</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--date-tag&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;YYYYMMDD date tag&quot;</span><span class="p">),</span>
    <span class="n">timeout_sec</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--timeout-sec&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;HTTP timeout in seconds&quot;</span>
    <span class="p">),</span>
    <span class="n">retries</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--retries&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Total retry attempts&quot;</span><span class="p">),</span>
    <span class="n">limit</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--limit&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Limit number of activities&quot;</span><span class="p">),</span>
    <span class="n">dry_run</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not write outputs&quot;</span><span class="p">),</span>
    <span class="n">log_level</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level&quot;</span><span class="p">),</span>
    <span class="n">log_file</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--log-file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to log file&quot;</span><span class="p">),</span>
    <span class="n">log_format</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-format&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Console format (text/json)&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract and enrich activity data from ChEMBL.</p>


            <details class="quote">
              <summary>Source code in <code>library\cli\__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;get-activity-data&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_activity_data</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">CONFIG_OPTION</span><span class="p">,</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--input&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;CSV containing filter IDs (assay_ids, molecule_ids, target_ids)&quot;</span><span class="p">,</span> <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">),</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--output-dir&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output directory&quot;</span><span class="p">),</span>
    <span class="n">date_tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--date-tag&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;YYYYMMDD date tag&quot;</span><span class="p">),</span>
    <span class="n">timeout_sec</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--timeout-sec&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;HTTP timeout in seconds&quot;</span><span class="p">),</span>
    <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--retries&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Total retry attempts&quot;</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--limit&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Limit number of activities&quot;</span><span class="p">),</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not write outputs&quot;</span><span class="p">),</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level&quot;</span><span class="p">),</span>
    <span class="n">log_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--log-file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to log file&quot;</span><span class="p">),</span>
    <span class="n">log_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-format&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Console format (text/json)&quot;</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract and enrich activity data from ChEMBL.&quot;&quot;&quot;</span>

    <span class="n">run_id</span> <span class="o">=</span> <span class="n">generate_run_id</span><span class="p">()</span>
    <span class="n">set_run_context</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;activity_processing&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Load configuration</span>
        <span class="n">activity_config</span> <span class="o">=</span> <span class="n">ActivityConfig</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="c1"># Override configuration with CLI arguments</span>
        <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># aligned with new ActivityConfig fields</span>
            <span class="n">activity_config</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">output_dir</span>
        <span class="k">if</span> <span class="n">date_tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Add date tag to output directory</span>
            <span class="n">activity_config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">date_tag</span> <span class="o">=</span> <span class="n">date_tag</span>
        <span class="k">if</span> <span class="n">timeout_sec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">activity_config</span><span class="o">.</span><span class="n">timeout_sec</span> <span class="o">=</span> <span class="n">timeout_sec</span>
        <span class="k">if</span> <span class="n">retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">activity_config</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">retries</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">activity_config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="n">activity_config</span><span class="o">.</span><span class="n">dry_run</span> <span class="o">=</span> <span class="n">dry_run</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">configure_logging</span><span class="p">(</span>
        <span class="n">level</span><span class="o">=</span><span class="n">log_level</span><span class="p">,</span>
        <span class="n">file_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">console_format</span><span class="o">=</span><span class="n">log_format</span><span class="p">,</span>
        <span class="n">log_file</span><span class="o">=</span><span class="n">log_file</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;activity_processing&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Activity processing started&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>

        <span class="n">register_shutdown_handler</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Activity processing shutdown&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">ShutdownContext</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;activity_etl&quot;</span><span class="p">):</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">run_activity_etl</span><span class="p">(</span><span class="n">activity_config</span><span class="p">,</span> <span class="n">input_csv</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Activity processing completed&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">records</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">activities</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Activity processing failed&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="k">if</span> <span class="n">activity_config</span><span class="o">.</span><span class="n">dry_run</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dry run completed; no artefacts written.&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;Dry run completed; no artefacts written.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>

        <span class="c1"># Write outputs</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">library.activity.writer</span><span class="w"> </span><span class="kn">import</span> <span class="n">write_activity_outputs</span>
            <span class="k">with</span> <span class="n">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;write_outputs&quot;</span><span class="p">):</span>
                <span class="n">output_paths</span> <span class="o">=</span> <span class="n">write_activity_outputs</span><span class="p">(</span>
                    <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
                    <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span> <span class="ow">or</span> <span class="n">activity_config</span><span class="o">.</span><span class="n">get_output_path</span><span class="p">(),</span>
                    <span class="n">date_tag</span><span class="o">=</span><span class="n">date_tag</span> <span class="ow">or</span> <span class="p">(</span><span class="n">activity_config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">date_tag</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">config</span><span class="o">=</span><span class="n">activity_config</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">output_paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Outputs written successfully&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to write outputs&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write outputs: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">IO_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.cli.get_document_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">get_document_data</span>


<a href="#library.cli.get_document_data" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_document_data</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to the YAML configuration file.&quot;</span><span class="p">,</span>
        <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">documents_csv</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--documents-csv&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;CSV containing document identifiers to enrich.&quot;</span><span class="p">,</span>
        <span class="n">file_okay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--output-dir&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Destination directory for generated artefacts.&quot;</span><span class="p">,</span>
        <span class="n">file_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">dir_okay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">date_tag</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--date-tag&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Date tag (YYYYMMDD) embedded in output filenames.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">timeout_sec</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--timeout-sec&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;HTTP timeout in seconds applied to all sources.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">retries</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--retries&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Total retry attempts for HTTP requests.&quot;</span>
    <span class="p">),</span>
    <span class="n">workers</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--workers&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of worker threads for HTTP fetching.&quot;</span>
    <span class="p">),</span>
    <span class="n">limit</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--limit&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Limit the number of documents processed.&quot;</span>
    <span class="p">),</span>
    <span class="n">sources</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="p">[],</span>
        <span class="s2">&quot;--source&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable only the listed sources (repeat for multiple).&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">all_sources</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;--all&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable all available sources (chembl, crossref, openalex, pubmed, semantic_scholar).&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">dry_run</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--dry-run/--no-dry-run&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Execute without writing artefacts to disk.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">log_level</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">log_file</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--log-file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to log file&quot;</span><span class="p">),</span>
    <span class="n">log_format</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-format&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Console format (text or json)&quot;</span>
    <span class="p">),</span>
    <span class="n">no_file_log</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--no-file-log&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable file logging&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Collect and enrich document metadata from configured sources.</p>


            <details class="quote">
              <summary>Source code in <code>library\cli\__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;get-document-data&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_document_data</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to the YAML configuration file.&quot;</span><span class="p">,</span>
        <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">documents_csv</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--documents-csv&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;CSV containing document identifiers to enrich.&quot;</span><span class="p">,</span>
        <span class="n">file_okay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--output-dir&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Destination directory for generated artefacts.&quot;</span><span class="p">,</span>
        <span class="n">file_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">dir_okay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">date_tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--date-tag&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Date tag (YYYYMMDD) embedded in output filenames.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">timeout_sec</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--timeout-sec&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;HTTP timeout in seconds applied to all sources.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--retries&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Total retry attempts for HTTP requests.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--workers&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of worker threads for HTTP fetching.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--limit&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Limit the number of documents processed.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">sources</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="p">[],</span>
        <span class="s2">&quot;--source&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable only the listed sources (repeat for multiple).&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">all_sources</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;--all&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable all available sources (chembl, crossref, openalex, pubmed, semantic_scholar).&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--dry-run/--no-dry-run&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Execute without writing artefacts to disk.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)&quot;</span><span class="p">),</span>
    <span class="n">log_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--log-file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to log file&quot;</span><span class="p">),</span>
    <span class="n">log_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-format&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Console format (text or json)&quot;</span><span class="p">),</span>
    <span class="n">no_file_log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--no-file-log&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable file logging&quot;</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect and enrich document metadata from configured sources.&quot;&quot;&quot;</span>

    <span class="c1"># Generate unique run ID for this execution</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">generate_run_id</span><span class="p">()</span>
    <span class="n">set_run_context</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;document_processing&quot;</span><span class="p">)</span>

    <span class="c1"># Validate that --all and --source are not used together</span>
    <span class="k">if</span> <span class="n">all_sources</span> <span class="ow">and</span> <span class="n">sources</span><span class="p">:</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;Error: Cannot use --all and --source together. Use either --all or --source.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">normalised_sources</span> <span class="o">=</span> <span class="n">_normalise_sources</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">DocumentValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="n">overrides</span> <span class="o">=</span> <span class="n">_build_cli_overrides</span><span class="p">(</span>
        <span class="n">documents_csv</span><span class="o">=</span><span class="n">documents_csv</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
        <span class="n">date_tag</span><span class="o">=</span><span class="n">date_tag</span><span class="p">,</span>
        <span class="n">timeout_sec</span><span class="o">=</span><span class="n">timeout_sec</span><span class="p">,</span>
        <span class="n">retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
        <span class="n">workers</span><span class="o">=</span><span class="n">workers</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="n">sources</span><span class="o">=</span><span class="n">normalised_sources</span><span class="p">,</span>
        <span class="n">all_sources</span><span class="o">=</span><span class="n">all_sources</span><span class="p">,</span>
        <span class="n">dry_run</span><span class="o">=</span><span class="n">dry_run</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">config_model</span> <span class="o">=</span> <span class="n">load_document_config</span><span class="p">(</span>
            <span class="n">config</span><span class="p">,</span>
            <span class="n">overrides</span><span class="o">=</span><span class="n">overrides</span><span class="p">,</span>
            <span class="n">env_prefix</span><span class="o">=</span><span class="n">DEFAULT_ENV_PREFIX</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">ConfigLoadError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="c1"># Configure logging with CLI parameters</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">configure_logging</span><span class="p">(</span>
        <span class="n">level</span><span class="o">=</span><span class="n">log_level</span><span class="p">,</span>
        <span class="n">file_enabled</span><span class="o">=</span><span class="ow">not</span> <span class="n">no_file_log</span><span class="p">,</span>
        <span class="n">console_format</span><span class="o">=</span><span class="n">log_format</span><span class="p">,</span>
        <span class="n">log_file</span><span class="o">=</span><span class="n">log_file</span><span class="p">,</span>
        <span class="n">logging_config</span><span class="o">=</span><span class="n">config_model</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config_model</span><span class="p">,</span> <span class="s1">&#39;logging&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;document_processing&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Document processing started&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">config_model</span><span class="o">.</span><span class="n">enabled_sources</span><span class="p">():</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;At least one document source must be enabled&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">input_frame</span> <span class="o">=</span> <span class="n">read_document_input</span><span class="p">(</span><span class="n">config_model</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">documents_csv</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">DocumentValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
        <span class="k">except</span> <span class="n">DocumentIOError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">IO_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="c1"># Setup graceful shutdown for document processing</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_handler</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Document processing shutdown requested, cleaning up...&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
            <span class="c1"># Add any cleanup logic here</span>

        <span class="n">register_shutdown_handler</span><span class="p">(</span><span class="n">cleanup_handler</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">ShutdownContext</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;document_etl&quot;</span><span class="p">):</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">run_document_etl</span><span class="p">(</span><span class="n">config_model</span><span class="p">,</span> <span class="n">input_frame</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Document processing completed&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">records</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">documents</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">DocumentValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Document validation failed&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
        <span class="k">except</span> <span class="n">DocumentHTTPError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Document HTTP error&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">HTTP_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
        <span class="k">except</span> <span class="n">DocumentQCError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Document QC error&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">QC_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="k">if</span> <span class="n">config_model</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">dry_run</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dry run completed; no artefacts written.&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;Dry run completed; no artefacts written.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;write_outputs&quot;</span><span class="p">):</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">write_document_outputs</span><span class="p">(</span>
                    <span class="n">result</span><span class="p">,</span>
                    <span class="n">config_model</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span>
                    <span class="n">config_model</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">date_tag</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">config_model</span><span class="p">,</span>  <span class="c1"># Передаем конфигурацию для применения determinism.column_order</span>
                <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Outputs written successfully&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="k">except</span> <span class="n">DocumentIOError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Document IO error&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">IO_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.cli.get_target_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">get_target_data</span>


<a href="#library.cli.get_target_data" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_target_data</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">CONFIG_OPTION</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="s2">&quot;--input&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;CSV containing target_chembl_id column&quot;</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--output-dir&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output directory&quot;</span><span class="p">),</span>
    <span class="n">date_tag</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--date-tag&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;YYYYMMDD date tag&quot;</span><span class="p">),</span>
    <span class="n">timeout_sec</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--timeout-sec&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;HTTP timeout in seconds&quot;</span>
    <span class="p">),</span>
    <span class="n">retries</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--retries&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Total retry attempts&quot;</span><span class="p">),</span>
    <span class="n">limit</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--limit&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Limit number of targets&quot;</span><span class="p">),</span>
    <span class="n">dev_mode</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--dev-mode&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Allow incomplete sources (dev/test only)&quot;</span>
    <span class="p">),</span>
    <span class="n">dry_run</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not write outputs&quot;</span><span class="p">),</span>
    <span class="n">log_level</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level&quot;</span><span class="p">),</span>
    <span class="n">log_file</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--log-file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to log file&quot;</span><span class="p">),</span>
    <span class="n">log_format</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-format&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Console format (text/json)&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract and enrich target data from ChEMBL/UniProt/IUPHAR.</p>


            <details class="quote">
              <summary>Source code in <code>library\cli\__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;get-target-data&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_target_data</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">CONFIG_OPTION</span><span class="p">,</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span> <span class="s2">&quot;--input&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;CSV containing target_chembl_id column&quot;</span><span class="p">,</span> <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">),</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--output-dir&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output directory&quot;</span><span class="p">),</span>
    <span class="n">date_tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--date-tag&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;YYYYMMDD date tag&quot;</span><span class="p">),</span>
    <span class="n">timeout_sec</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--timeout-sec&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;HTTP timeout in seconds&quot;</span><span class="p">),</span>
    <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--retries&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Total retry attempts&quot;</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--limit&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Limit number of targets&quot;</span><span class="p">),</span>
    <span class="n">dev_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--dev-mode&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Allow incomplete sources (dev/test only)&quot;</span><span class="p">),</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not write outputs&quot;</span><span class="p">),</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level&quot;</span><span class="p">),</span>
    <span class="n">log_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--log-file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to log file&quot;</span><span class="p">),</span>
    <span class="n">log_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-format&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Console format (text/json)&quot;</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract and enrich target data from ChEMBL/UniProt/IUPHAR.&quot;&quot;&quot;</span>

    <span class="n">run_id</span> <span class="o">=</span> <span class="n">generate_run_id</span><span class="p">()</span>
    <span class="n">set_run_context</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;target_processing&quot;</span><span class="p">)</span>

    <span class="n">overrides</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_assign_path</span><span class="p">(</span><span class="n">overrides</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;io&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;dir&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_dir</span><span class="p">))</span>
    <span class="c1"># Устанавливаем date_tag: из аргументов или автоматически генерируем</span>
    <span class="n">_assign_path</span><span class="p">(</span><span class="n">overrides</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;runtime&quot;</span><span class="p">,</span> <span class="s2">&quot;date_tag&quot;</span><span class="p">],</span> <span class="n">date_tag</span> <span class="ow">or</span> <span class="n">_generate_date_tag</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">timeout_sec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_assign_path</span><span class="p">(</span><span class="n">overrides</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="s2">&quot;timeout_sec&quot;</span><span class="p">],</span> <span class="n">timeout_sec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_assign_path</span><span class="p">(</span><span class="n">overrides</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="s2">&quot;retries&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span><span class="p">],</span> <span class="n">retries</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_assign_path</span><span class="p">(</span><span class="n">overrides</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;runtime&quot;</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">],</span> <span class="n">limit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dev_mode</span><span class="p">:</span>
        <span class="n">_assign_path</span><span class="p">(</span><span class="n">overrides</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;runtime&quot;</span><span class="p">,</span> <span class="s2">&quot;dev_mode&quot;</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">_assign_path</span><span class="p">(</span><span class="n">overrides</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;runtime&quot;</span><span class="p">,</span> <span class="s2">&quot;allow_incomplete_sources&quot;</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
        <span class="n">_assign_path</span><span class="p">(</span><span class="n">overrides</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;runtime&quot;</span><span class="p">,</span> <span class="s2">&quot;dry_run&quot;</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="n">load_target_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">overrides</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">configure_logging</span><span class="p">(</span>
        <span class="n">level</span><span class="o">=</span><span class="n">log_level</span><span class="p">,</span>
        <span class="n">file_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">console_format</span><span class="o">=</span><span class="n">log_format</span><span class="p">,</span>
        <span class="n">log_file</span><span class="o">=</span><span class="n">log_file</span><span class="p">,</span>
        <span class="n">logging_config</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="s2">&quot;logging&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;target_processing&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Target processing started&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">input_frame</span> <span class="o">=</span> <span class="n">read_target_input</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">TargetValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
        <span class="k">except</span> <span class="n">TargetIOError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">IO_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="n">register_shutdown_handler</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Target processing shutdown&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">ShutdownContext</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;target_etl&quot;</span><span class="p">):</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">run_target_etl</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">input_frame</span><span class="o">=</span><span class="n">input_frame</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">TargetValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Target validation failed&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
        <span class="k">except</span> <span class="n">TargetHTTPError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Target HTTP error&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">HTTP_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
        <span class="k">except</span> <span class="n">TargetQCError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Target QC error&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">QC_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">dry_run</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dry run completed; no artefacts written.&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;Dry run completed; no artefacts written.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">ExitCode</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="n">write_target_outputs</span><span class="p">(</span>
            <span class="n">result</span><span class="p">,</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">date_tag</span><span class="p">,</span>
            <span class="n">cfg</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.cli.health" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">health</span>


<a href="#library.cli.health" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">health</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">CONFIG_OPTION</span><span class="p">,</span>
    <span class="n">timeout</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="mf">10.0</span><span class="p">,</span> <span class="s2">&quot;--timeout&quot;</span><span class="p">,</span> <span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Timeout for health checks in seconds&quot;</span>
    <span class="p">),</span>
    <span class="n">json_output</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--json&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output results in JSON format&quot;</span>
    <span class="p">),</span>
    <span class="n">log_level</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">log_file</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--log-file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to log file&quot;</span><span class="p">),</span>
    <span class="n">no_file_log</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--no-file-log&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable file logging&quot;</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check health status of all configured API clients.</p>


            <details class="quote">
              <summary>Source code in <code>library\cli\__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">health</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">CONFIG_OPTION</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="s2">&quot;--timeout&quot;</span><span class="p">,</span> <span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Timeout for health checks in seconds&quot;</span><span class="p">),</span>
    <span class="n">json_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--json&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output results in JSON format&quot;</span><span class="p">),</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)&quot;</span><span class="p">),</span>
    <span class="n">log_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--log-file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to log file&quot;</span><span class="p">),</span>
    <span class="n">no_file_log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--no-file-log&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable file logging&quot;</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check health status of all configured API clients.&quot;&quot;&quot;</span>

    <span class="c1"># Generate unique run ID for health check</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">generate_run_id</span><span class="p">()</span>
    <span class="n">set_run_context</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;health_check&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Load configuration</span>
        <span class="n">config_model</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="c1"># Configure logging</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">configure_logging</span><span class="p">(</span>
            <span class="n">level</span><span class="o">=</span><span class="n">log_level</span><span class="p">,</span>
            <span class="n">file_enabled</span><span class="o">=</span><span class="ow">not</span> <span class="n">no_file_log</span><span class="p">,</span>
            <span class="n">log_file</span><span class="o">=</span><span class="n">log_file</span><span class="p">,</span>
            <span class="n">logging_config</span><span class="o">=</span><span class="n">config_model</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config_model</span><span class="p">,</span> <span class="s1">&#39;logging&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="n">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;health_check&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Health check started&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>

            <span class="c1"># Create health checker from API configurations</span>
            <span class="c1"># Get clients from config_model.clients (list of APIClientConfig)</span>
            <span class="c1"># and filter by enabled sources</span>
            <span class="n">api_configs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">enabled_sources</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">config_model</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">enabled</span><span class="p">}</span>

            <span class="k">for</span> <span class="n">client_config</span> <span class="ow">in</span> <span class="n">config_model</span><span class="o">.</span><span class="n">clients</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">client_config</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">enabled_sources</span><span class="p">:</span>
                    <span class="n">api_configs</span><span class="p">[</span><span class="n">client_config</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">client_config</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">api_configs</span><span class="p">:</span>
                <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;No enabled API clients found for health checking&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">health_checker</span> <span class="o">=</span> <span class="n">create_health_checker_from_config</span><span class="p">(</span><span class="n">api_configs</span><span class="p">)</span>

            <span class="c1"># Perform health checks</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;Checking API health...&quot;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;api_health_checks&quot;</span><span class="p">):</span>
                <span class="n">statuses</span> <span class="o">=</span> <span class="n">health_checker</span><span class="o">.</span><span class="n">check_all</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>

            <span class="c1"># Log results</span>
            <span class="n">healthy_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">statuses</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">is_healthy</span><span class="p">)</span>
            <span class="n">unhealthy_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span> <span class="o">-</span> <span class="n">healthy_count</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Health check completed&quot;</span><span class="p">,</span>
                <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span>
                <span class="n">total_apis</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">statuses</span><span class="p">),</span>
                <span class="n">healthy</span><span class="o">=</span><span class="n">healthy_count</span><span class="p">,</span>
                <span class="n">unhealthy</span><span class="o">=</span><span class="n">unhealthy_count</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">json_output</span><span class="p">:</span>
                <span class="c1"># Output JSON format</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
                <span class="n">summary</span> <span class="o">=</span> <span class="n">health_checker</span><span class="o">.</span><span class="n">get_health_summary</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>
                <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;apis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">is_healthy</span><span class="p">,</span>
                        <span class="s2">&quot;response_time_ms&quot;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">response_time_ms</span><span class="p">,</span>
                        <span class="s2">&quot;circuit_state&quot;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">circuit_state</span><span class="p">,</span>
                        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">error_message</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">statuses</span>
                <span class="p">]</span>
                <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Output formatted table</span>
                <span class="n">health_checker</span><span class="o">.</span><span class="n">print_health_report</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>

            <span class="c1"># Exit with error code if any APIs are unhealthy</span>
            <span class="k">if</span> <span class="n">unhealthy_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Health check failed&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Health check failed: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.cli.install_completion" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">install_completion</span>


<a href="#library.cli.install_completion" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">install_completion</span><span class="p">(</span>
    <span class="n">shell</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Argument</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Shell type (bash, zsh, fish, powershell)&quot;</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Install shell completion for the CLI.</p>


            <details class="quote">
              <summary>Source code in <code>library\cli\__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">install_completion</span><span class="p">(</span>
    <span class="n">shell</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Argument</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Shell type (bash, zsh, fish, powershell)&quot;</span><span class="p">)</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Install shell completion for the CLI.&quot;&quot;&quot;</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

    <span class="c1"># Get the current executable path</span>
    <span class="n">executable</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span>

    <span class="c1"># Get the script name</span>
    <span class="n">script_name</span> <span class="o">=</span> <span class="s2">&quot;bioactivity-data-acquisition&quot;</span>

    <span class="c1"># Validate shell parameter</span>
    <span class="n">allowed_shells</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;zsh&quot;</span><span class="p">,</span> <span class="s2">&quot;fish&quot;</span><span class="p">,</span> <span class="s2">&quot;powershell&quot;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">shell</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_shells</span><span class="p">:</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Unsupported shell: </span><span class="si">{</span><span class="n">shell</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Supported shells: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">allowed_shells</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Generate completion script</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span>
            <span class="n">executable</span><span class="p">,</span> <span class="s2">&quot;-m&quot;</span><span class="p">,</span> <span class="s2">&quot;typer&quot;</span><span class="p">,</span> <span class="s2">&quot;library.cli:app&quot;</span><span class="p">,</span> 
            <span class="sa">f</span><span class="s2">&quot;--name=</span><span class="si">{</span><span class="n">script_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> 
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">shell</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--output-file&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span>
        <span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">completion_script</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>

        <span class="k">if</span> <span class="n">shell</span> <span class="o">==</span> <span class="s2">&quot;bash&quot;</span><span class="p">:</span>
            <span class="n">completion_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;.local&quot;</span> <span class="o">/</span> <span class="s2">&quot;share&quot;</span> <span class="o">/</span> <span class="s2">&quot;bash-completion&quot;</span> <span class="o">/</span> <span class="s2">&quot;completions&quot;</span>
            <span class="n">completion_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">completion_path</span> <span class="o">=</span> <span class="n">completion_dir</span> <span class="o">/</span> <span class="n">script_name</span>

            <span class="k">with</span> <span class="n">completion_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">completion_script</span><span class="p">)</span>

            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Bash completion installed to </span><span class="si">{</span><span class="n">completion_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Run &#39;source </span><span class="si">{</span><span class="n">completion_path</span><span class="si">}</span><span class="s2">&#39; or restart your shell to activate.&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">shell</span> <span class="o">==</span> <span class="s2">&quot;zsh&quot;</span><span class="p">:</span>
            <span class="n">completion_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;.zsh&quot;</span> <span class="o">/</span> <span class="s2">&quot;completions&quot;</span>
            <span class="n">completion_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">completion_path</span> <span class="o">=</span> <span class="n">completion_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">script_name</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">with</span> <span class="n">completion_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">completion_script</span><span class="p">)</span>

            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Zsh completion installed to </span><span class="si">{</span><span class="n">completion_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;Add the following to your ~/.zshrc:&quot;</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;  fpath=(~/.zsh/completions $fpath)&quot;</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;  autoload -U compinit &amp;&amp; compinit&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">shell</span> <span class="o">==</span> <span class="s2">&quot;fish&quot;</span><span class="p">:</span>
            <span class="n">completion_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;.config&quot;</span> <span class="o">/</span> <span class="s2">&quot;fish&quot;</span> <span class="o">/</span> <span class="s2">&quot;completions&quot;</span>
            <span class="n">completion_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">completion_path</span> <span class="o">=</span> <span class="n">completion_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_name</span><span class="si">}</span><span class="s2">.fish&quot;</span>

            <span class="k">with</span> <span class="n">completion_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">completion_script</span><span class="p">)</span>

            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Fish completion installed to </span><span class="si">{</span><span class="n">completion_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;Restart your shell to activate.&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">shell</span> <span class="o">==</span> <span class="s2">&quot;powershell&quot;</span><span class="p">:</span>
            <span class="n">completion_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;Documents&quot;</span> <span class="o">/</span> <span class="s2">&quot;PowerShell&quot;</span> <span class="o">/</span> <span class="s2">&quot;Modules&quot;</span>
            <span class="n">completion_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">completion_path</span> <span class="o">=</span> <span class="n">completion_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_name</span><span class="si">}</span><span class="s2">.ps1&quot;</span>

            <span class="k">with</span> <span class="n">completion_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">completion_script</span><span class="p">)</span>

            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ PowerShell completion installed to </span><span class="si">{</span><span class="n">completion_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;Add the following to your PowerShell profile:&quot;</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  . </span><span class="si">{</span><span class="n">completion_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Failed to generate completion script: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error output: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Failed to install completion: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.cli.main" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">main</span>


<a href="#library.cli.main" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">main</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Entrypoint for <code>python -m library.cli</code>.</p>


            <details class="quote">
              <summary>Source code in <code>library\cli\__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entrypoint for ``python -m library.cli``.&quot;&quot;&quot;</span>
    <span class="c1"># Автоматически установить API ключи</span>
    <span class="n">_setup_api_keys_automatically</span><span class="p">()</span>

    <span class="c1"># Initialize telemetry</span>
    <span class="n">setup_telemetry</span><span class="p">(</span>
        <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;bioactivity-etl&quot;</span><span class="p">,</span>
        <span class="n">enable_requests_instrumentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">app</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.cli.pipeline" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">pipeline</span>


<a href="#library.cli.pipeline" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">pipeline</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">CONFIG_OPTION</span><span class="p">,</span>
    <span class="n">overrides</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="p">[],</span>
        <span class="s2">&quot;--set&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Override configuration values using dotted paths (KEY=VALUE)&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">log_level</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">log_file</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--log-file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to log file&quot;</span><span class="p">),</span>
    <span class="n">log_format</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-format&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Console format (text or json)&quot;</span>
    <span class="p">),</span>
    <span class="n">no_file_log</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--no-file-log&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable file logging&quot;</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute the ETL pipeline using a configuration file.</p>


            <details class="quote">
              <summary>Source code in <code>library\cli\__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">pipeline</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">CONFIG_OPTION</span><span class="p">,</span>
    <span class="n">overrides</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">([],</span> <span class="s2">&quot;--set&quot;</span><span class="p">,</span> <span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Override configuration values using dotted paths (KEY=VALUE)&quot;</span><span class="p">),</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)&quot;</span><span class="p">),</span>
    <span class="n">log_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--log-file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to log file&quot;</span><span class="p">),</span>
    <span class="n">log_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;--log-format&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Console format (text or json)&quot;</span><span class="p">),</span>
    <span class="n">no_file_log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--no-file-log&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable file logging&quot;</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the ETL pipeline using a configuration file.&quot;&quot;&quot;</span>

    <span class="c1"># Generate unique run ID for this execution</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">generate_run_id</span><span class="p">()</span>
    <span class="n">set_run_context</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;cli_startup&quot;</span><span class="p">)</span>

    <span class="n">override_dict</span> <span class="o">=</span> <span class="n">_parse_override_args</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
    <span class="n">config_model</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">override_dict</span><span class="p">)</span>

    <span class="c1"># Создаем необходимые директории после загрузки конфигурации</span>
    <span class="n">ensure_output_directories_exist</span><span class="p">(</span><span class="n">config_model</span><span class="p">)</span>

    <span class="c1"># Configure logging with CLI parameters</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">configure_logging</span><span class="p">(</span>
        <span class="n">level</span><span class="o">=</span><span class="n">log_level</span><span class="p">,</span>
        <span class="n">file_enabled</span><span class="o">=</span><span class="ow">not</span> <span class="n">no_file_log</span><span class="p">,</span>
        <span class="n">console_format</span><span class="o">=</span><span class="n">log_format</span><span class="p">,</span>
        <span class="n">log_file</span><span class="o">=</span><span class="n">log_file</span><span class="p">,</span>
        <span class="n">logging_config</span><span class="o">=</span><span class="n">config_model</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config_model</span><span class="p">,</span> <span class="s1">&#39;logging&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;pipeline&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pipeline started&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>

        <span class="c1"># Setup graceful shutdown</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_handler</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pipeline shutdown requested, cleaning up...&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
            <span class="c1"># Add any cleanup logic here</span>

        <span class="n">register_shutdown_handler</span><span class="p">(</span><span class="n">cleanup_handler</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">ShutdownContext</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">):</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">run_pipeline</span><span class="p">(</span><span class="n">config_model</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pipeline completed successfully&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">),</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
                <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline completed. Output written to </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Pipeline failed&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline failed: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.cli.testitem_info" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">testitem_info</span>


<a href="#library.cli.testitem_info" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">testitem_info</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Display information about the testitem ETL pipeline.</p>


            <details class="quote">
              <summary>Source code in <code>library\cli\__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;testitem-info&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">testitem_info</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display information about the testitem ETL pipeline.&quot;&quot;&quot;</span>

    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold blue]Testitem ETL Pipeline[/bold blue]&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold]Description:[/bold]&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  ETL pipeline for extracting and normalizing molecular data&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  from ChEMBL and PubChem APIs.&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold]Features:[/bold]&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • ChEMBL molecule data extraction&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • PubChem enrichment (optional)&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • Deterministic data processing&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • Comprehensive validation&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • Quality control metrics&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • Structured logging&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold]Input Requirements:[/bold]&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • CSV file with molecule identifiers&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • At least one of: molecule_chembl_id, molregno&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • Optional: parent_chembl_id, parent_molregno, pubchem_cid&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold]Output:[/bold]&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • CSV file with normalized molecular data&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • Metadata YAML file&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • Quality control artifacts&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  • Structured logs&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold]Usage:[/bold]&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  python -m library.cli testitem-run --config config.yaml --input data.csv --output results/&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.cli.testitem_run" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">testitem_run</span>


<a href="#library.cli.testitem_run" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">testitem_run</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
        <span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">file_okay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">readable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to testitem configuration YAML file&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="nb">input</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="s2">&quot;--input&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
        <span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">file_okay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">readable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to input CSV file with molecule identifiers&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">output</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--output&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output directory for results (defaults to config io.output.dir)&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">cache_dir</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--cache-dir&quot;</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Directory for ChEMBL HTTP cache&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">pubchem_cache_dir</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--pubchem-cache-dir&quot;</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Directory for PubChem HTTP cache&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">timeout</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--timeout&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;HTTP timeout in seconds&quot;</span><span class="p">),</span>
    <span class="n">retries</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--retries&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of HTTP retries&quot;</span><span class="p">),</span>
    <span class="n">limit</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--limit&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Limit number of records to process&quot;</span>
    <span class="p">),</span>
    <span class="n">disable_pubchem</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--disable-pubchem&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable PubChem enrichment&quot;</span>
    <span class="p">),</span>
    <span class="n">dry_run</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run in dry-run mode (no actual processing)&quot;</span>
    <span class="p">),</span>
    <span class="n">verbose</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable verbose logging&quot;</span>
    <span class="p">),</span>
    <span class="n">date_tag</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--date-tag&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Date tag (YYYYMMDD) embedded in output filenames&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Run the testitem ETL pipeline.</p>


            <details class="quote">
              <summary>Source code in <code>library\cli\__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;testitem-run&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">testitem_run</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
        <span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">file_okay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">readable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to testitem configuration YAML file&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="s2">&quot;--input&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
        <span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">file_okay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">readable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to input CSV file with molecule identifiers&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">output</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--output&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output directory for results (defaults to config io.output.dir)&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">cache_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--cache-dir&quot;</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Directory for ChEMBL HTTP cache&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">pubchem_cache_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--pubchem-cache-dir&quot;</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Directory for PubChem HTTP cache&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--timeout&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;HTTP timeout in seconds&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--retries&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of HTTP retries&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--limit&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Limit number of records to process&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">disable_pubchem</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;--disable-pubchem&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable PubChem enrichment&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run in dry-run mode (no actual processing)&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable verbose logging&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">date_tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;--date-tag&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Date tag (YYYYMMDD) embedded in output filenames&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the testitem ETL pipeline.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Load configuration</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[blue]Loading configuration from: </span><span class="si">{</span><span class="n">config</span><span class="si">}</span><span class="s2">[/blue]&quot;</span><span class="p">)</span>
        <span class="n">testitem_config</span> <span class="o">=</span> <span class="n">TestitemConfig</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="c1"># Override configuration with CLI arguments</span>
        <span class="k">if</span> <span class="n">cache_dir</span><span class="p">:</span>
            <span class="n">testitem_config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pubchem_cache_dir</span><span class="p">:</span>
            <span class="n">testitem_config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">pubchem_cache_dir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pubchem_cache_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="n">testitem_config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">timeout_sec</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="k">if</span> <span class="n">retries</span><span class="p">:</span>
            <span class="n">testitem_config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">retries</span> <span class="o">=</span> <span class="n">retries</span>
        <span class="k">if</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">testitem_config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="k">if</span> <span class="n">disable_pubchem</span><span class="p">:</span>
            <span class="n">testitem_config</span><span class="o">.</span><span class="n">enable_pubchem</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="n">testitem_config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">dry_run</span> <span class="o">=</span> <span class="n">dry_run</span>
        <span class="k">if</span> <span class="n">date_tag</span><span class="p">:</span>
            <span class="n">testitem_config</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">date_tag</span> <span class="o">=</span> <span class="n">date_tag</span>

        <span class="c1"># Set default output directory if not provided</span>
        <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Try to get from config, fallback to default</span>
            <span class="n">config_output</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">testitem_config</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">,</span> <span class="s1">&#39;data/output/testitem&#39;</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">config_output</span><span class="p">)</span>

        <span class="c1"># Configure logging</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[green]Configuration loaded successfully[/green]&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Pipeline version: </span><span class="si">{</span><span class="n">testitem_config</span><span class="o">.</span><span class="n">pipeline_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  PubChem enabled: </span><span class="si">{</span><span class="n">testitem_config</span><span class="o">.</span><span class="n">enable_pubchem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Allow parent missing: </span><span class="si">{</span><span class="n">testitem_config</span><span class="o">.</span><span class="n">allow_parent_missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Batch size: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">testitem_config</span><span class="o">.</span><span class="n">runtime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;batch_size&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Retries: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">testitem_config</span><span class="o">.</span><span class="n">runtime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;retries&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Timeout: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">testitem_config</span><span class="o">.</span><span class="n">runtime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;timeout_sec&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Output directory: </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[yellow]Running in dry-run mode - no actual processing will occur[/yellow]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Run ETL pipeline</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[blue]Starting testitem ETL pipeline...[/blue]&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Input file: </span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Output directory: </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">run_testitem_etl</span><span class="p">(</span><span class="n">testitem_config</span><span class="p">,</span> <span class="n">input_path</span><span class="o">=</span><span class="nb">input</span><span class="p">)</span>

        <span class="c1"># Display results summary</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[green]ETL pipeline completed successfully![/green]&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">testitems</span><span class="p">)</span><span class="si">}</span><span class="s2"> molecules&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ChEMBL release: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;chembl_release&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Display QC metrics</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[blue]Quality Control Metrics:[/blue]&quot;</span><span class="p">)</span>
            <span class="n">qc_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">show_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header_style</span><span class="o">=</span><span class="s2">&quot;bold magenta&quot;</span><span class="p">)</span>
            <span class="n">qc_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Metric&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
            <span class="n">qc_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">qc</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">metric</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)[:</span><span class="mi">100</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">qc_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">qc_table</span><span class="p">)</span>

        <span class="c1"># Write outputs</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[blue]Writing outputs to: </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">[/blue]&quot;</span><span class="p">)</span>
        <span class="n">output_paths</span> <span class="o">=</span> <span class="n">write_testitem_outputs</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">testitem_config</span><span class="p">)</span>

        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[green]Outputs written successfully:[/green]&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">artifact_type</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">output_paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">artifact_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[green]Testitem ETL pipeline completed successfully![/green]&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">TestitemValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]Validation Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/red]&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">TestitemExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">except</span> <span class="n">TestitemHTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]HTTP Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/red]&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">TestitemExitCode</span><span class="o">.</span><span class="n">HTTP_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">except</span> <span class="n">TestitemQCError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]QC Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/red]&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">TestitemExitCode</span><span class="o">.</span><span class="n">QC_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">except</span> <span class="n">TestitemIOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]I/O Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/red]&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">TestitemExitCode</span><span class="o">.</span><span class="n">IO_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]Unexpected Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/red]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.cli.testitem_validate_config" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">testitem_validate_config</span>


<a href="#library.cli.testitem_validate_config" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">testitem_validate_config</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
        <span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">file_okay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">readable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to testitem configuration YAML file&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate testitem configuration file.</p>


            <details class="quote">
              <summary>Source code in <code>library\cli\__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;testitem-validate-config&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">testitem_validate_config</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
        <span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">file_okay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">readable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">resolve_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to testitem configuration YAML file&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate testitem configuration file.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[blue]Validating configuration: </span><span class="si">{</span><span class="n">config</span><span class="si">}</span><span class="s2">[/blue]&quot;</span><span class="p">)</span>
        <span class="n">testitem_config</span> <span class="o">=</span> <span class="n">TestitemConfig</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[green]Configuration is valid![/green]&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Pipeline version: </span><span class="si">{</span><span class="n">testitem_config</span><span class="o">.</span><span class="n">pipeline_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  PubChem enabled: </span><span class="si">{</span><span class="n">testitem_config</span><span class="o">.</span><span class="n">enable_pubchem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Allow parent missing: </span><span class="si">{</span><span class="n">testitem_config</span><span class="o">.</span><span class="n">allow_parent_missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Display source configurations</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[blue]Source Configurations:[/blue]&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">source_name</span><span class="p">,</span> <span class="n">source_config</span> <span class="ow">in</span> <span class="n">testitem_config</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">source_name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Base URL: </span><span class="si">{</span><span class="n">source_config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Timeout: </span><span class="si">{</span><span class="n">source_config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">timeout_sec</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Retries: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">source_config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">retries</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;total&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]Configuration validation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/red]&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">typer</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">TestitemExitCode</span><span class="o">.</span><span class="n">VALIDATION_ERROR</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.cli.version" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">version</span>


<a href="#library.cli.version" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">version</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Print the package version.</p>


            <details class="quote">
              <summary>Source code in <code>library\cli\__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">version</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print the package version.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">importlib.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
        <span class="n">package_version</span> <span class="o">=</span> <span class="n">version</span><span class="p">(</span><span class="s2">&quot;bioactivity-data-acquisition&quot;</span><span class="p">)</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bioactivity-data-acquisition </span><span class="si">{</span><span class="n">package_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># Fallback to hardcoded version if importlib.metadata fails</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;bioactivity-data-acquisition 0.1.0&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="_7">Утилиты<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<h3 id="_8">Логирование<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.logging_setup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.logging_setup</span>


<a href="#library.logging_setup" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Unified logging configuration for the bioactivity ETL pipeline.</p>










  <div class="doc doc-children">







<h3 id="library.logging_setup-classes">Classes<a href="#library.logging_setup-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.logging_setup.AddContextFilter" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AddContextFilter</span>


<a href="#library.logging_setup.AddContextFilter" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="logging.Filter">Filter</span></code></p>


        <p>Filter to add context variables to log records.</p>











  <div class="doc doc-children">








<h5 id="library.logging_setup.AddContextFilter-functions">Functions<a href="#library.logging_setup.AddContextFilter-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="library.logging_setup.AddContextFilter.filter" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">filter</span>


<a href="#library.logging_setup.AddContextFilter.filter" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">filter</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add context variables to log record.</p>


            <details class="quote">
              <summary>Source code in <code>library\logging_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">LogRecord</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add context variables to log record.&quot;&quot;&quot;</span>
    <span class="n">record</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="n">run_id_var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span>
    <span class="n">record</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="n">stage_var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="c1"># Add trace_id from OpenTelemetry if available</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">library.telemetry</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_current_trace_id</span>  <span class="c1"># type: ignore[import-untyped]</span>
        <span class="n">record</span><span class="o">.</span><span class="n">trace_id</span> <span class="o">=</span> <span class="n">get_current_trace_id</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">record</span><span class="o">.</span><span class="n">trace_id</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="library.logging_setup.RedactSecretsFilter" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">RedactSecretsFilter</span>


<a href="#library.logging_setup.RedactSecretsFilter" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">RedactSecretsFilter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="logging.Filter">Filter</span></code></p>


        <p>Filter to redact sensitive information from log records.</p>








                  <details class="quote">
                    <summary>Source code in <code>library\logging_setup.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sensitive_patterns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)(token|api_key|password|secret|key)\s*=\s*([^\s,}]+)&#39;</span><span class="p">),</span> <span class="sa">r</span><span class="s1">&#39;\1=[REDACTED]&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)(authorization|bearer)\s*:\s*([^\s,}]+)&#39;</span><span class="p">),</span> <span class="sa">r</span><span class="s1">&#39;\1: [REDACTED]&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)(password|pwd)\s*=\s*([^\s,}]+)&#39;</span><span class="p">),</span> <span class="sa">r</span><span class="s1">&#39;\1=[REDACTED]&#39;</span><span class="p">),</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">








<h5 id="library.logging_setup.RedactSecretsFilter-functions">Functions<a href="#library.logging_setup.RedactSecretsFilter-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="library.logging_setup.RedactSecretsFilter.filter" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">filter</span>


<a href="#library.logging_setup.RedactSecretsFilter.filter" class="headerlink" title="Permanent link">&para;</a></h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">filter</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Filter and redact sensitive information from log record.</p>


            <details class="quote">
              <summary>Source code in <code>library\logging_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">LogRecord</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter and redact sensitive information from log record.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;getMessage&#39;</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitive_patterns</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">replacement</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="n">record</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">message</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h3 id="library.logging_setup-functions">Functions<a href="#library.logging_setup-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.logging_setup.bind_stage" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">bind_stage</span>


<a href="#library.logging_setup.bind_stage" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">stage</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Context manager to temporarily bind stage context.</p>


            <details class="quote">
              <summary>Source code in <code>library\logging_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bind_stage</span><span class="p">(</span><span class="n">logger</span><span class="p">:</span> <span class="n">BoundLogger</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager to temporarily bind stage context.&quot;&quot;&quot;</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">stage_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">logger</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">stage</span><span class="o">=</span><span class="n">stage</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">stage_var</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.logging_setup.cleanup_old_logs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">cleanup_old_logs</span>


<a href="#library.logging_setup.cleanup_old_logs" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">cleanup_old_logs</span><span class="p">(</span><span class="n">older_than_days</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">logs_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Clean up log files older than specified days.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>older_than_days</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Remove logs older than this many days</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="int">int</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>14</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logs_dir</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Directory to clean (defaults to logs/)</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pathlib.Path">Path</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>library\logging_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cleanup_old_logs</span><span class="p">(</span><span class="n">older_than_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span> <span class="n">logs_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clean up log files older than specified days.</span>

<span class="sd">    Args:</span>
<span class="sd">        older_than_days: Remove logs older than this many days</span>
<span class="sd">        logs_dir: Directory to clean (defaults to logs/)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="k">if</span> <span class="n">logs_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logs_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;logs&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">logs_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span>

    <span class="n">cutoff_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="n">older_than_days</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">log_file</span> <span class="ow">in</span> <span class="n">logs_dir</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.log*&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">log_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span> <span class="o">&lt;</span> <span class="n">cutoff_time</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">log_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed old log file: </span><span class="si">{</span><span class="n">log_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to remove </span><span class="si">{</span><span class="n">log_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.logging_setup.configure_logging" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">configure_logging</span>


<a href="#library.logging_setup.configure_logging" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">configure_logging</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
    <span class="n">config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">file_enabled</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">console_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">log_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">logging_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Configure structured logging with file and console handlers.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>level</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;INFO&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to logging configuration YAML file</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pathlib.Path">Path</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_enabled</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to enable file logging</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>console_format</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Console format (text or json)</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>log_file</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Custom log file path</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pathlib.Path">Path</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="structlog.stdlib.BoundLogger">BoundLogger</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Configured structlog logger</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>library\logging_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">configure_logging</span><span class="p">(</span>
    <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
    <span class="n">config_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">file_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">console_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">log_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logging_config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoundLogger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure structured logging with file and console handlers.</span>

<span class="sd">    Args:</span>
<span class="sd">        level: Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)</span>
<span class="sd">        config_path: Path to logging configuration YAML file</span>
<span class="sd">        file_enabled: Whether to enable file logging</span>
<span class="sd">        console_format: Console format (text or json)</span>
<span class="sd">        log_file: Custom log file path</span>

<span class="sd">    Returns:</span>
<span class="sd">        Configured structlog logger</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_LOGGING_CONFIGURED</span>

    <span class="k">if</span> <span class="n">_LOGGING_CONFIGURED</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>

    <span class="c1"># Use logging config from parameters or defaults</span>
    <span class="k">if</span> <span class="n">logging_config</span><span class="p">:</span>
        <span class="n">file_enabled</span> <span class="o">=</span> <span class="n">file_enabled</span> <span class="k">if</span> <span class="n">file_enabled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">logging_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">console_format</span> <span class="o">=</span> <span class="n">console_format</span> <span class="k">if</span> <span class="n">console_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">logging_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;console&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">log_file</span> <span class="ow">or</span> <span class="n">Path</span><span class="p">(</span><span class="n">logging_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;logs/app.log&quot;</span><span class="p">))</span>

    <span class="c1"># Set defaults if not provided</span>
    <span class="k">if</span> <span class="n">file_enabled</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">file_enabled</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">console_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">console_format</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
    <span class="k">if</span> <span class="n">log_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;logs/app.log&quot;</span><span class="p">)</span>

    <span class="c1"># Create logs directory if file logging is enabled</span>
    <span class="k">if</span> <span class="n">file_enabled</span><span class="p">:</span>
        <span class="n">logs_dir</span> <span class="o">=</span> <span class="n">log_file</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">logs_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Load configuration from YAML if provided</span>
    <span class="k">if</span> <span class="n">config_path</span> <span class="ow">and</span> <span class="n">config_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">with</span> <span class="n">config_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># Override configuration based on parameters</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_enabled</span><span class="p">:</span>
            <span class="c1"># Remove file handlers</span>
            <span class="k">for</span> <span class="n">logger_config</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loggers&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;handlers&quot;</span> <span class="ow">in</span> <span class="n">logger_config</span><span class="p">:</span>
                    <span class="n">logger_config</span><span class="p">[</span><span class="s2">&quot;handlers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">logger_config</span><span class="p">[</span><span class="s2">&quot;handlers&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">h</span> <span class="o">!=</span> <span class="s2">&quot;file&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;root&quot;</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="s2">&quot;handlers&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">]:</span>
                <span class="n">config</span><span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">][</span><span class="s2">&quot;handlers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">][</span><span class="s2">&quot;handlers&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">h</span> <span class="o">!=</span> <span class="s2">&quot;file&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">log_file</span><span class="p">:</span>
            <span class="c1"># Update file handler path</span>
            <span class="k">if</span> <span class="s2">&quot;handlers&quot;</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="s2">&quot;file&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;handlers&quot;</span><span class="p">]:</span>
                <span class="n">config</span><span class="p">[</span><span class="s2">&quot;handlers&quot;</span><span class="p">][</span><span class="s2">&quot;file&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>

        <span class="c1"># Apply configuration</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Fallback to programmatic configuration</span>
        <span class="n">_configure_programmatic_logging</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">file_enabled</span><span class="p">,</span> <span class="n">console_format</span><span class="p">,</span> <span class="n">log_file</span><span class="p">)</span>

    <span class="c1"># Configure structlog</span>
    <span class="n">structlog</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
        <span class="n">processors</span><span class="o">=</span><span class="p">[</span>
            <span class="n">structlog</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">TimeStamper</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;iso&quot;</span><span class="p">),</span>
            <span class="n">_add_context_processor</span><span class="p">,</span>
            <span class="n">_redact_secrets_processor</span><span class="p">,</span>
            <span class="n">structlog</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">add_log_level</span><span class="p">,</span>
            <span class="n">structlog</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">StackInfoRenderer</span><span class="p">(),</span>
            <span class="n">structlog</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">format_exc_info</span><span class="p">,</span>
            <span class="n">structlog</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">JSONRenderer</span><span class="p">()</span> <span class="k">if</span> <span class="n">console_format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span> <span class="k">else</span> <span class="n">structlog</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">ConsoleRenderer</span><span class="p">(),</span>
        <span class="p">],</span>
        <span class="n">logger_factory</span><span class="o">=</span><span class="n">structlog</span><span class="o">.</span><span class="n">stdlib</span><span class="o">.</span><span class="n">LoggerFactory</span><span class="p">(),</span>
        <span class="n">wrapper_class</span><span class="o">=</span><span class="n">structlog</span><span class="o">.</span><span class="n">stdlib</span><span class="o">.</span><span class="n">BoundLogger</span><span class="p">,</span>
        <span class="n">cache_logger_on_first_use</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">_LOGGING_CONFIGURED</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.logging_setup.generate_run_id" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">generate_run_id</span>


<a href="#library.logging_setup.generate_run_id" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">generate_run_id</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a unique run ID for the current pipeline execution.</p>


            <details class="quote">
              <summary>Source code in <code>library\logging_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_run_id</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a unique run ID for the current pipeline execution.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">8</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.logging_setup.get_logger" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">get_logger</span>


<a href="#library.logging_setup.get_logger" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_logger</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">initial_values</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get a configured structlog logger with optional initial values.</p>


            <details class="quote">
              <summary>Source code in <code>library\logging_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_logger</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">initial_values</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoundLogger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a configured structlog logger with optional initial values.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_LOGGING_CONFIGURED</span><span class="p">:</span>
        <span class="n">configure_logging</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">**</span><span class="n">initial_values</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.logging_setup.get_run_context" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">get_run_context</span>


<a href="#library.logging_setup.get_run_context" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_run_context</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get current context variables.</p>


            <details class="quote">
              <summary>Source code in <code>library\logging_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_run_context</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get current context variables.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;run_id&quot;</span><span class="p">:</span> <span class="n">run_id_var</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
        <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="n">stage_var</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.logging_setup.set_run_context" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">set_run_context</span>


<a href="#library.logging_setup.set_run_context" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_run_context</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set context variables for structured logging.</p>


            <details class="quote">
              <summary>Source code in <code>library\logging_setup.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_run_context</span><span class="p">(</span><span class="n">run_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set context variables for structured logging.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">run_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">run_id_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">run_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stage_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="_9">Телеметрия<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<h2 id="library.telemetry" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">library.telemetry</span>


<a href="#library.telemetry" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>OpenTelemetry configuration and utilities for tracing.</p>










  <div class="doc doc-children">







<h3 id="library.telemetry-classes">Classes<a href="#library.telemetry-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="library.telemetry.TraceContextManager" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TraceContextManager</span>


<a href="#library.telemetry.TraceContextManager" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">TraceContextManager</span><span class="p">(</span><span class="n">operation_name</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


        <p>Context manager for managing trace context across operations.</p>








                  <details class="quote">
                    <summary>Source code in <code>library\telemetry.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">operation_name</span> <span class="o">=</span> <span class="n">operation_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>
<h3 id="library.telemetry-functions">Functions<a href="#library.telemetry-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="library.telemetry.add_span_attribute" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">add_span_attribute</span>


<a href="#library.telemetry.add_span_attribute" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_span_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add attribute to current span.</p>


            <details class="quote">
              <summary>Source code in <code>library\telemetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_span_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add attribute to current span.&quot;&quot;&quot;</span>
    <span class="n">span</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">span</span> <span class="ow">and</span> <span class="n">span</span><span class="o">.</span><span class="n">is_recording</span><span class="p">():</span>
        <span class="n">span</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.telemetry.add_span_event" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">add_span_event</span>


<a href="#library.telemetry.add_span_event" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_span_event</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add event to current span.</p>


            <details class="quote">
              <summary>Source code in <code>library\telemetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_span_event</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add event to current span.&quot;&quot;&quot;</span>
    <span class="n">span</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">span</span> <span class="ow">and</span> <span class="n">span</span><span class="o">.</span><span class="n">is_recording</span><span class="p">():</span>
        <span class="n">span</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attributes</span> <span class="ow">or</span> <span class="p">{})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.telemetry.get_current_span_id" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">get_current_span_id</span>


<a href="#library.telemetry.get_current_span_id" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_current_span_id</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get current span ID for logging correlation.</p>


            <details class="quote">
              <summary>Source code in <code>library\telemetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_current_span_id</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get current span ID for logging correlation.&quot;&quot;&quot;</span>
    <span class="n">span</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">span</span> <span class="ow">and</span> <span class="n">span</span><span class="o">.</span><span class="n">is_recording</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">get_span_context</span><span class="p">()</span><span class="o">.</span><span class="n">span_id</span><span class="p">,</span> <span class="s2">&quot;016x&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.telemetry.get_current_trace_id" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">get_current_trace_id</span>


<a href="#library.telemetry.get_current_trace_id" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_current_trace_id</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get current trace ID for logging correlation.</p>


            <details class="quote">
              <summary>Source code in <code>library\telemetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_current_trace_id</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get current trace ID for logging correlation.&quot;&quot;&quot;</span>
    <span class="n">span</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">span</span> <span class="ow">and</span> <span class="n">span</span><span class="o">.</span><span class="n">is_recording</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">get_span_context</span><span class="p">()</span><span class="o">.</span><span class="n">trace_id</span><span class="p">,</span> <span class="s2">&quot;032x&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.telemetry.instrument_api_client" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">instrument_api_client</span>


<a href="#library.telemetry.instrument_api_client" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">instrument_api_client</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Decorator for instrumenting API client methods.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Name of the API client (e.g., "chembl", "crossref")</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>library\telemetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">instrument_api_client</span><span class="p">(</span><span class="n">client_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator for instrumenting API client methods.</span>

<span class="sd">    Args:</span>
<span class="sd">        client_name: Name of the API client (e.g., &quot;chembl&quot;, &quot;crossref&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">traced_operation</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;api.</span><span class="si">{</span><span class="n">client_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client_name</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.telemetry.instrument_etl_stage" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">instrument_etl_stage</span>


<a href="#library.telemetry.instrument_etl_stage" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">instrument_etl_stage</span><span class="p">(</span><span class="n">stage_name</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Decorator for instrumenting ETL stages.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stage_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Name of the ETL stage (e.g., "extract", "transform", "load")</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>library\telemetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">instrument_etl_stage</span><span class="p">(</span><span class="n">stage_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator for instrumenting ETL stages.</span>

<span class="sd">    Args:</span>
<span class="sd">        stage_name: Name of the ETL stage (e.g., &quot;extract&quot;, &quot;transform&quot;, &quot;load&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">traced_operation</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;etl.</span><span class="si">{</span><span class="n">stage_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="n">stage_name</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.telemetry.setup_telemetry" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">setup_telemetry</span>


<a href="#library.telemetry.setup_telemetry" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">setup_telemetry</span><span class="p">(</span>
    <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;bioactivity-etl&quot;</span><span class="p">,</span>
    <span class="n">jaeger_endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">enable_requests_instrumentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Setup OpenTelemetry tracing.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>service_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Name of the service for tracing</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;bioactivity-etl&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>jaeger_endpoint</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Jaeger collector endpoint (e.g., "http://localhost:14268/api/traces")</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>enable_requests_instrumentation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to instrument requests library</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>library\telemetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_telemetry</span><span class="p">(</span>
    <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bioactivity-etl&quot;</span><span class="p">,</span>
    <span class="n">jaeger_endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">enable_requests_instrumentation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup OpenTelemetry tracing.</span>

<span class="sd">    Args:</span>
<span class="sd">        service_name: Name of the service for tracing</span>
<span class="sd">        jaeger_endpoint: Jaeger collector endpoint (e.g., &quot;http://localhost:14268/api/traces&quot;)</span>
<span class="sd">        enable_requests_instrumentation: Whether to instrument requests library</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get configuration from environment variables</span>
    <span class="n">jaeger_endpoint</span> <span class="o">=</span> <span class="n">jaeger_endpoint</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;JAEGER_ENDPOINT&quot;</span><span class="p">)</span>

    <span class="c1"># Get package version</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">importlib.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
        <span class="n">package_version</span> <span class="o">=</span> <span class="n">version</span><span class="p">(</span><span class="s2">&quot;bioactivity-data-acquisition&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">package_version</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span>

    <span class="c1"># Create resource with service name</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">Resource</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
        <span class="s2">&quot;service.name&quot;</span><span class="p">:</span> <span class="n">service_name</span><span class="p">,</span>
        <span class="s2">&quot;service.version&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SERVICE_VERSION&quot;</span><span class="p">,</span> <span class="n">package_version</span><span class="p">),</span>
        <span class="s2">&quot;deployment.environment&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;ENVIRONMENT&quot;</span><span class="p">,</span> <span class="s2">&quot;development&quot;</span><span class="p">),</span>
    <span class="p">})</span>

    <span class="c1"># Set up tracer provider</span>
    <span class="n">tracer_provider</span> <span class="o">=</span> <span class="n">TracerProvider</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">)</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">set_tracer_provider</span><span class="p">(</span><span class="n">tracer_provider</span><span class="p">)</span>

    <span class="c1"># Add Jaeger exporter if endpoint is provided</span>
    <span class="k">if</span> <span class="n">jaeger_endpoint</span><span class="p">:</span>
        <span class="n">jaeger_exporter</span> <span class="o">=</span> <span class="n">JaegerExporter</span><span class="p">(</span>
            <span class="n">agent_host_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;JAEGER_AGENT_HOST&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">),</span>
            <span class="n">agent_port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;JAEGER_AGENT_PORT&quot;</span><span class="p">,</span> <span class="s2">&quot;6831&quot;</span><span class="p">)),</span>
        <span class="p">)</span>

        <span class="n">span_processor</span> <span class="o">=</span> <span class="n">BatchSpanProcessor</span><span class="p">(</span><span class="n">jaeger_exporter</span><span class="p">)</span>
        <span class="n">tracer_provider</span><span class="o">.</span><span class="n">add_span_processor</span><span class="p">(</span><span class="n">span_processor</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;OpenTelemetry configured with Jaeger&quot;</span><span class="p">,</span>
            <span class="n">jaeger_endpoint</span><span class="o">=</span><span class="n">jaeger_endpoint</span><span class="p">,</span>
            <span class="n">service_name</span><span class="o">=</span><span class="n">service_name</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;OpenTelemetry configured without exporter&quot;</span><span class="p">,</span>
            <span class="n">service_name</span><span class="o">=</span><span class="n">service_name</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Instrument requests library if enabled</span>
    <span class="k">if</span> <span class="n">enable_requests_instrumentation</span><span class="p">:</span>
        <span class="n">RequestsInstrumentor</span><span class="p">()</span><span class="o">.</span><span class="n">instrument</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;HTTP requests instrumentation enabled&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="library.telemetry.traced_operation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">traced_operation</span>


<a href="#library.telemetry.traced_operation" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">traced_operation</span><span class="p">(</span><span class="n">operation_name</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Context manager for tracing operations.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>operation_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Name of the operation to trace</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**attributes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional attributes to add to the span</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Any">Any</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>with traced_operation("etl.extract", source="chembl", batch_id=123):
    # ETL operation code
    pass</p>
</details>

            <details class="quote">
              <summary>Source code in <code>library\telemetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">traced_operation</span><span class="p">(</span><span class="n">operation_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager for tracing operations.</span>

<span class="sd">    Args:</span>
<span class="sd">        operation_name: Name of the operation to trace</span>
<span class="sd">        **attributes: Additional attributes to add to the span</span>

<span class="sd">    Example:</span>
<span class="sd">        with traced_operation(&quot;etl.extract&quot;, source=&quot;chembl&quot;, batch_id=123):</span>
<span class="sd">            # ETL operation code</span>
<span class="sd">            pass</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_tracer</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="n">operation_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">span</span><span class="p">:</span>
        <span class="c1"># Add attributes to span</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">span</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">span</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Record exception in span</span>
            <span class="n">span</span><span class="o">.</span><span class="n">record_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">span</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">Status</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="_10">Примеры использования<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<h3 id="_11">Базовое использование<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">from library.cli import app
from library.config import Config
from library.documents.pipeline import DocumentsPipeline

# Загрузка конфигурации
config = Config.from_file(&quot;configs/config_documents_full.yaml&quot;)

# Создание пайплайна
pipeline = DocumentsPipeline(config)

# Запуск пайплайна
result = pipeline.run()
</code></pre>
<h3 id="_12">Работа с клиентами<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">from library.clients.chembl import ChEMBLClient
from library.clients.crossref import CrossrefClient

# Создание клиентов
chembl_client = ChEMBLClient()
crossref_client = CrossrefClient()

# Извлечение данных
chembl_data = chembl_client.get_documents(limit=100)
crossref_data = crossref_client.search_works(query=&quot;chembl&quot;)
</code></pre>
<h3 id="_13">Валидация данных<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">from library.schemas.document_input_schema import DocumentInputSchema
from library.validation.invariants import validate_document_data_quality

# Валидация схемы
validated_df = DocumentInputSchema.validate(df)

# Проверка инвариантов
quality_results = validate_document_data_quality(validated_df)
</code></pre>
<h3 id="_14">Конфигурация<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">from library.config import Config

# Загрузка конфигурации
config = Config.from_file(&quot;configs/config.yaml&quot;)

# Доступ к настройкам
timeout = config.http.timeout_sec
sources = config.sources
</code></pre>
<h2 id="_15">Типы данных<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h2>
<h3 id="_16">Основные типы<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">from typing import Dict, List, Optional, Union
from datetime import datetime
import pandas as pd

# Основные типы данных
DocumentData = pd.DataFrame
TargetData = pd.DataFrame
AssayData = pd.DataFrame
ActivityData = pd.DataFrame
TestitemData = pd.DataFrame

# Конфигурационные типы
ConfigDict = Dict[str, Any]
SourceConfig = Dict[str, Any]
HttpConfig = Dict[str, Any]
</code></pre>
<h3 id="_17">Перечисления<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">from enum import Enum

class PipelineStatus(Enum):
    &quot;&quot;&quot;Статус пайплайна.&quot;&quot;&quot;
    PENDING = &quot;pending&quot;
    RUNNING = &quot;running&quot;
    COMPLETED = &quot;completed&quot;
    FAILED = &quot;failed&quot;

class DataSource(Enum):
    &quot;&quot;&quot;Источник данных.&quot;&quot;&quot;
    CHEMBL = &quot;chembl&quot;
    CROSSREF = &quot;crossref&quot;
    OPENALEX = &quot;openalex&quot;
    PUBMED = &quot;pubmed&quot;
    SEMANTIC_SCHOLAR = &quot;semantic_scholar&quot;
    PUBCHEM = &quot;pubchem&quot;
    UNIPROT = &quot;uniprot&quot;
    IUPHAR = &quot;iuphar&quot;

class ValidationLevel(Enum):
    &quot;&quot;&quot;Уровень валидации.&quot;&quot;&quot;
    STRICT = &quot;strict&quot;
    MODERATE = &quot;moderate&quot;
    LENIENT = &quot;lenient&quot;
</code></pre>
<h2 id="_18">Исключения<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h2>
<h3 id="_19">Основные исключения<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">class BioactivityDataError(Exception):
    &quot;&quot;&quot;Базовое исключение для ошибок биоактивностных данных.&quot;&quot;&quot;
    pass

class ValidationError(BioactivityDataError):
    &quot;&quot;&quot;Ошибка валидации данных.&quot;&quot;&quot;
    pass

class ConfigurationError(BioactivityDataError):
    &quot;&quot;&quot;Ошибка конфигурации.&quot;&quot;&quot;
    pass

class APIClientError(BioactivityDataError):
    &quot;&quot;&quot;Ошибка API клиента.&quot;&quot;&quot;
    pass

class PipelineError(BioactivityDataError):
    &quot;&quot;&quot;Ошибка пайплайна.&quot;&quot;&quot;
    pass
</code></pre>
<h3 id="_20">Обработка исключений<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">from library.exceptions import ValidationError, ConfigurationError, APIClientError

try:
    # Выполнение операции
    result = pipeline.run()
except ValidationError as e:
    logger.error(f&quot;Ошибка валидации: {e}&quot;)
    # Обработка ошибки валидации
except ConfigurationError as e:
    logger.error(f&quot;Ошибка конфигурации: {e}&quot;)
    # Обработка ошибки конфигурации
except APIClientError as e:
    logger.error(f&quot;Ошибка API клиента: {e}&quot;)
    # Обработка ошибки API
except Exception as e:
    logger.error(f&quot;Неожиданная ошибка: {e}&quot;)
    # Обработка неожиданной ошибки
</code></pre>
<h2 id="_21">Константы<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h2>
<h3 id="api">API константы<a class="headerlink" href="#api" title="Permanent link">&para;</a></h3>
<pre><code class="language-python"># ChEMBL API
CHEMBL_BASE_URL = &quot;https://www.ebi.ac.uk/chembl/api/data&quot;
CHEMBL_TIMEOUT = 60.0
CHEMBL_MAX_RETRIES = 5

# Crossref API
CROSSREF_BASE_URL = &quot;https://api.crossref.org/works&quot;
CROSSREF_TIMEOUT = 30.0
CROSSREF_MAX_RETRIES = 3

# OpenAlex API
OPENALEX_BASE_URL = &quot;https://api.openalex.org/works&quot;
OPENALEX_TIMEOUT = 30.0
OPENALEX_MAX_RETRIES = 3

# PubMed API
PUBMED_BASE_URL = &quot;https://eutils.ncbi.nlm.nih.gov/entrez/eutils/&quot;
PUBMED_TIMEOUT = 60.0
PUBMED_MAX_RETRIES = 10

# Semantic Scholar API
SEMANTIC_SCHOLAR_BASE_URL = &quot;https://api.semanticscholar.org/graph/v1/paper&quot;
SEMANTIC_SCHOLAR_TIMEOUT = 60.0
SEMANTIC_SCHOLAR_MAX_RETRIES = 15

# PubChem API
PUBCHEM_BASE_URL = &quot;https://pubchem.ncbi.nlm.nih.gov/rest/pug&quot;
PUBCHEM_TIMEOUT = 45.0
PUBCHEM_MAX_RETRIES = 8

# UniProt API
UNIPROT_BASE_URL = &quot;https://rest.uniprot.org&quot;
UNIPROT_TIMEOUT = 45.0
UNIPROT_MAX_RETRIES = 5
</code></pre>
<h3 id="_22">Константы валидации<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<pre><code class="language-python"># Пороговые значения качества
MIN_FILL_RATE = 0.8
MAX_DUPLICATE_RATE = 0.01
MIN_RECORDS_COUNT = 100

# Форматы данных
CHEMBL_ID_PATTERN = r&quot;^CHEMBL\d+$&quot;
DOI_PATTERN = r&quot;^10\.\d+/[^\s]+$&quot;
UNIPROT_ID_PATTERN = r&quot;^[OPQ][0-9][A-Z0-9]{3}[0-9]|[A-NR-Z][0-9]([A-Z][A-Z0-9]{2}[0-9]){1,2}$&quot;

# Единицы измерения
VALID_UNITS = [&quot;nM&quot;, &quot;uM&quot;, &quot;mM&quot;, &quot;M&quot;, &quot;ng/ml&quot;, &quot;ug/ml&quot;, &quot;mg/ml&quot;, &quot;g/ml&quot;]

# Типы активностей
VALID_ACTIVITY_TYPES = [&quot;IC50&quot;, &quot;EC50&quot;, &quot;Ki&quot;, &quot;Kd&quot;, &quot;AC50&quot;, &quot;Potency&quot;]

# Типы ассев
VALID_ASSAY_TYPES = [&quot;B&quot;, &quot;F&quot;, &quot;P&quot;, &quot;U&quot;]
</code></pre>
<h2 id="_23">Утилиты<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h2>
<h3 id="_24">Функции работы с данными<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">def normalize_chembl_id(chembl_id: str) -&gt; str:
    &quot;&quot;&quot;Нормализация ChEMBL ID.&quot;&quot;&quot;
    if not chembl_id:
        return &quot;&quot;
    return chembl_id.upper().strip()

def validate_doi(doi: str) -&gt; bool:
    &quot;&quot;&quot;Валидация DOI.&quot;&quot;&quot;
    import re
    return bool(re.match(DOI_PATTERN, doi))

def calculate_fill_rate(df: pd.DataFrame) -&gt; float:
    &quot;&quot;&quot;Расчёт fill rate для DataFrame.&quot;&quot;&quot;
    return df.notna().mean().mean()

def detect_duplicates(df: pd.DataFrame, columns: List[str]) -&gt; pd.DataFrame:
    &quot;&quot;&quot;Обнаружение дубликатов по указанным колонкам.&quot;&quot;&quot;
    return df[df.duplicated(subset=columns, keep=False)]
</code></pre>
<h3 id="_25">Функции работы с файлами<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">def ensure_directory(path: str) -&gt; None:
    &quot;&quot;&quot;Создание директории если не существует.&quot;&quot;&quot;
    Path(path).mkdir(parents=True, exist_ok=True)

def get_timestamp() -&gt; str:
    &quot;&quot;&quot;Получение временной метки в формате YYYYMMDD.&quot;&quot;&quot;
    return datetime.now().strftime(&quot;%Y%m%d&quot;)

def calculate_file_hash(file_path: str) -&gt; str:
    &quot;&quot;&quot;Расчёт SHA256 хеша файла.&quot;&quot;&quot;
    import hashlib
    with open(file_path, 'rb') as f:
        return hashlib.sha256(f.read()).hexdigest()
</code></pre>
<h3 id="_26">Функции логирования<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">def setup_logging(level: str = &quot;INFO&quot;) -&gt; None:
    &quot;&quot;&quot;Настройка логирования.&quot;&quot;&quot;
    logging.basicConfig(
        level=getattr(logging, level.upper()),
        format='%(asctime)s [%(levelname)s] %(name)s: %(message)s',
        handlers=[
            logging.StreamHandler(),
            logging.FileHandler('logs/app.log')
        ]
    )

def log_validation_results(results: Dict[str, Any]) -&gt; None:
    &quot;&quot;&quot;Логирование результатов валидации.&quot;&quot;&quot;
    logger = logging.getLogger(__name__)
    for key, value in results.items():
        logger.info(f&quot;{key}: {value}&quot;)
</code></pre>
<h2 id="api_1">Расширение API<a class="headerlink" href="#api_1" title="Permanent link">&para;</a></h2>
<h3 id="_27">Создание нового клиента<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">from library.clients.base import BaseApiClient

class NewApiClient(BaseApiClient):
    &quot;&quot;&quot;Новый API клиент.&quot;&quot;&quot;

    def __init__(self, base_url: str, timeout: float = 30.0):
        super().__init__(base_url, timeout)

    def get_data(self, endpoint: str, params: Dict[str, Any] = None) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;Получение данных из API.&quot;&quot;&quot;
        return self._make_request(endpoint, params)
</code></pre>
<h3 id="_28">Создание новой схемы валидации<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">import pandera as pa
from pandera import Field, Check

class NewDataSchema(pa.DataFrameModel):
    &quot;&quot;&quot;Схема для валидации новых данных.&quot;&quot;&quot;

    id: pa.typing.Series[str] = Field(description=&quot;Идентификатор&quot;)
    name: pa.typing.Series[str] = Field(description=&quot;Название&quot;)
    value: pa.typing.Series[float] = Field(
        description=&quot;Значение&quot;,
        checks=[Check.greater_than(0)]
    )

    class Config:
        coerce = True
        strict = True
</code></pre>
<h3 id="_29">Создание нового пайплайна<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">from library.pipelines.base import BasePipeline

class NewPipeline(BasePipeline):
    &quot;&quot;&quot;Новый пайплайн.&quot;&quot;&quot;

    def __init__(self, config: Config):
        super().__init__(config)

    def extract(self) -&gt; pd.DataFrame:
        &quot;&quot;&quot;Извлечение данных.&quot;&quot;&quot;
        # Реализация извлечения
        pass

    def transform(self, df: pd.DataFrame) -&gt; pd.DataFrame:
        &quot;&quot;&quot;Трансформация данных.&quot;&quot;&quot;
        # Реализация трансформации
        pass

    def load(self, df: pd.DataFrame) -&gt; None:
        &quot;&quot;&quot;Загрузка данных.&quot;&quot;&quot;
        # Реализация загрузки
        pass
</code></pre>
<h2 id="_30">Производительность<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h2>
<h3 id="_31">Оптимизация<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h3>
<pre><code class="language-python"># Использование батчевой обработки
def process_in_batches(df: pd.DataFrame, batch_size: int = 1000) -&gt; pd.DataFrame:
    &quot;&quot;&quot;Обработка данных батчами.&quot;&quot;&quot;
    results = []
    for i in range(0, len(df), batch_size):
        batch = df.iloc[i:i + batch_size]
        processed_batch = process_batch(batch)
        results.append(processed_batch)
    return pd.concat(results, ignore_index=True)

# Использование кэширования
from functools import lru_cache

@lru_cache(maxsize=128)
def cached_api_call(endpoint: str, params: str) -&gt; Dict[str, Any]:
    &quot;&quot;&quot;Кэшированный API вызов.&quot;&quot;&quot;
    return api_client.get(endpoint, params)
</code></pre>
<h3 id="_32">Мониторинг<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">import time
from contextlib import contextmanager

@contextmanager
def measure_time(operation_name: str):
    &quot;&quot;&quot;Измерение времени выполнения операции.&quot;&quot;&quot;
    start_time = time.time()
    try:
        yield
    finally:
        end_time = time.time()
        duration = end_time - start_time
        logger.info(f&quot;{operation_name} выполнена за {duration:.2f} секунд&quot;)

# Использование
with measure_time(&quot;Извлечение данных&quot;):
    data = extract_data()
</code></pre>
<h2 id="_33">Безопасность<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h2>
<h3 id="_34">Валидация входных данных<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">def validate_input_data(data: Any) -&gt; bool:
    &quot;&quot;&quot;Валидация входных данных.&quot;&quot;&quot;
    if not isinstance(data, (str, int, float, list, dict)):
        return False

    # Дополнительные проверки безопасности
    if isinstance(data, str):
        # Проверка на SQL инъекции
        if any(keyword in data.upper() for keyword in ['SELECT', 'INSERT', 'UPDATE', 'DELETE']):
            return False

    return True
</code></pre>
<h3 id="_35">Обработка секретов<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h3>
<pre><code class="language-python">import os
from typing import Optional

def get_secret(secret_name: str) -&gt; Optional[str]:
    &quot;&quot;&quot;Безопасное получение секрета.&quot;&quot;&quot;
    return os.getenv(secret_name)

def validate_api_key(api_key: str) -&gt; bool:
    &quot;&quot;&quot;Валидация API ключа.&quot;&quot;&quot;
    if not api_key:
        return False

    # Проверка формата API ключа
    if len(api_key) &lt; 10:
        return False

    return True
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.indexes", "content.code.copy", "content.action.edit"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>