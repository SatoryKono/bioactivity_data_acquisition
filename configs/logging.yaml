version: 1
disable_existing_loggers: false

formatters:
  console:
    format: "%(asctime)s %(levelname)s %(name)s â€” %(message)s"
    datefmt: "%Y-%m-%d %H:%M:%S"
  json:
    (): pythonjsonlogger.jsonlogger.JsonFormatter
    fmt: "%(asctime)s %(levelname)s %(name)s %(message)s run_id:%(run_id)s stage:%(stage)s trace_id:%(trace_id)s"
    datefmt: "%Y-%m-%dT%H:%M:%S"

filters:
  redact_secrets:
    (): library.logging_setup.RedactSecretsFilter
  add_context:
    (): library.logging_setup.AddContextFilter

handlers:
  console:
    class: logging.StreamHandler
    level: INFO
    formatter: console
    filters: [redact_secrets, add_context]
    stream: ext://sys.stderr
  file:
    class: logging.handlers.RotatingFileHandler
    level: DEBUG
    formatter: json
    filters: [redact_secrets, add_context]
    filename: logs/app.log
    maxBytes: 10485760  # 10MB
    backupCount: 10
    encoding: utf-8
  file_timed:
    class: logging.handlers.TimedRotatingFileHandler
    level: DEBUG
    formatter: json
    filters: [redact_secrets, add_context]
    filename: logs/app.log
    when: midnight
    interval: 1
    backupCount: 14
    encoding: utf-8
    suffix: "%Y-%m-%d"

loggers:
  "":
    level: INFO
    handlers: [console, file]
    propagate: false
  library:
    level: DEBUG
    handlers: [console, file]
    propagate: false
  library.clients:
    level: INFO
    handlers: [console, file]
    propagate: false
  library.etl:
    level: DEBUG
    handlers: [console, file]
    propagate: false
  library.documents:
    level: DEBUG
    handlers: [console, file]
    propagate: false
  requests:
    level: WARNING
    handlers: [console, file]
    propagate: false
  urllib3:
    level: WARNING
    handlers: [console, file]
    propagate: false
  backoff:
    level: INFO
    handlers: [console, file]
    propagate: false

root:
  level: INFO
  handlers: [console, file]
