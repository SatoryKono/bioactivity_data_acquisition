extends:
  - ../../profiles/base.yaml
  - ../../profiles/determinism.yaml
  - ../../profiles/chembl.yaml
  - ../../profiles/validation.yaml
  - ../../profiles/postprocess.yaml

pipeline:
  name: target_chembl
  version: "1.0.0"
  owner: "Data Acquisition Team"
  description: "Extract target records from ChEMBL API"

sources:
  chembl:
    batch_size: 25
    parameters:
      base_url: https://www.ebi.ac.uk/chembl/api/data
      max_url_length: 2000
      select_fields:
        - target_chembl_id
        - pref_name
        - target_type
        - organism
        - tax_id
        - species_group_flag
        - protein_class_desc
        - component_count
        - cross_references
        - target_components

cli:
  input_file: data/input/target.csv

determinism:
  sort:
    by:
      - target_chembl_id
    ascending:
      - true
    na_position: last
  column_order:
    - target_chembl_id
    - pref_name
    - target_type
    - organism
    - tax_id
    - species_group_flag
    - cross_references__flat
    - target_components__flat
    - target_component_synonyms__flat
    - uniprot_accessions
    - protein_class_desc
    - protein_class_list
    - protein_class_top
    - component_count
  hashing:
    business_key_fields:
      - target_chembl_id

transform:
  arrays_to_header_rows:
    - cross_references
    - target_components

validation:
  schema_out: bioetl.schemas.target.target_chembl.TargetSchema
  coerce: false

