{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Bioactivity Data Acquisition Configuration",
  "description": "Schema for validating bioactivity ETL pipeline configuration",
  "type": "object",
  "required": ["http", "sources", "io", "logging"],
  "properties": {
    "http": {
      "type": "object",
      "required": ["global"],
      "properties": {
        "global": {
          "type": "object",
          "required": ["timeout_sec", "retries"],
          "properties": {
            "timeout_sec": {
              "type": "number",
              "minimum": 1.0,
              "maximum": 300.0,
              "description": "HTTP timeout in seconds"
            },
            "retries": {
              "type": "object",
              "properties": {
                "total": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 10,
                  "description": "Total number of retry attempts"
                },
                "max_tries": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 10,
                  "description": "Alias for total number of retry attempts"
                },
                "backoff_multiplier": {
                  "type": "number",
                  "minimum": 0.1,
                  "maximum": 10.0,
                  "description": "Backoff multiplier for exponential retry delay"
                },
                "backoff_factor": {
                  "type": "number",
                  "minimum": 0.1,
                  "maximum": 10.0,
                  "description": "Legacy alias for backoff_multiplier"
                }
              }
            },
            "headers": {
              "type": "object",
              "description": "Global HTTP headers"
            }
          }
        },
        "sources": {
          "type": "object",
          "description": "Source-specific HTTP settings"
        }
      }
    },
    "sources": {
      "type": "object",
      "required": ["chembl"],
      "properties": {
        "chembl": {
          "type": "object",
          "required": ["name", "enabled", "http"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Source name identifier"
            },
            "enabled": {
              "type": "boolean",
              "description": "Whether this source is enabled"
            },
            "endpoint": {
              "type": "string",
              "description": "API endpoint path"
            },
            "http": {
              "type": "object",
              "required": ["base_url"],
              "properties": {
                "base_url": {
                  "type": "string",
                  "format": "uri",
                  "description": "Base URL for the API"
                },
                "timeout_sec": {
                  "type": "number",
                  "minimum": 1.0,
                  "maximum": 300.0,
                  "description": "HTTP timeout in seconds"
                },
                "headers": {
                  "type": "object",
                  "description": "HTTP headers for this source"
                },
                "rate_limit": {
                  "type": "object",
                  "properties": {
                    "max_calls": {
                      "type": "integer",
                      "minimum": 1,
                      "description": "Maximum calls per period"
                    },
                    "period": {
                      "type": "number",
                      "minimum": 0.1,
                      "description": "Rate limit period in seconds"
                    }
                  }
                },
                "retries": {
                  "type": "object",
                  "properties": {
                    "total": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 20,
                      "description": "Total number of retry attempts"
                    },
                    "max_tries": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 20,
                      "description": "Alias for total number of retry attempts"
                    },
                    "backoff_multiplier": {
                      "type": "number",
                      "minimum": 0.1,
                      "maximum": 10.0,
                      "description": "Backoff multiplier for exponential retry delay"
                    },
                    "backoff_factor": {
                      "type": "number",
                      "minimum": 0.1,
                      "maximum": 10.0,
                      "description": "Legacy alias for backoff_multiplier"
                    }
                  }
                }
              }
            },
            "params": {
              "type": "object",
              "description": "Default query parameters"
            },
            "pagination": {
              "type": "object",
              "properties": {
                "page_param": {
                  "type": "string",
                  "description": "Parameter name for page number"
                },
                "size_param": {
                  "type": "string",
                  "description": "Parameter name for page size"
                },
                "size": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 1000,
                  "description": "Default page size"
                },
                "max_pages": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Maximum number of pages to fetch"
                }
              }
            }
          }
        },
        "crossref": {
          "type": "object",
          "required": ["name", "enabled", "http"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Source name identifier"
            },
            "enabled": {
              "type": "boolean"
            },
            "endpoint": {
              "type": "string",
              "description": "API endpoint path"
            },
            "params": {
              "type": "object",
              "description": "Default query parameters"
            },
            "pagination": {
              "type": "object",
              "properties": {
                "page_param": {
                  "type": "string",
                  "description": "Parameter name for page number"
                },
                "size_param": {
                  "type": "string",
                  "description": "Parameter name for page size"
                },
                "size": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 1000,
                  "description": "Default page size"
                },
                "max_pages": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Maximum number of pages to fetch"
                }
              }
            },
            "http": {
              "type": "object",
              "required": ["base_url"],
              "properties": {
                "base_url": {
                  "type": "string",
                  "format": "uri"
                },
                "timeout_sec": {
                  "type": "number",
                  "minimum": 1.0,
                  "maximum": 300.0,
                  "description": "HTTP timeout in seconds"
                },
                "headers": {
                  "type": "object",
                  "description": "HTTP headers for this source"
                },
                "rate_limit": {
                  "type": "object",
                  "properties": {
                    "max_calls": {
                      "type": "integer",
                      "minimum": 1,
                      "description": "Maximum calls per period"
                    },
                    "period": {
                      "type": "number",
                      "minimum": 0.1,
                      "description": "Rate limit period in seconds"
                    }
                  }
                },
                "retries": {
                  "type": "object",
                  "properties": {
                    "total": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 20,
                      "description": "Total number of retry attempts"
                    },
                    "max_tries": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 20,
                      "description": "Alias for total number of retry attempts"
                    },
                    "backoff_multiplier": {
                      "type": "number",
                      "minimum": 0.1,
                      "maximum": 10.0,
                      "description": "Backoff multiplier for exponential retry delay"
                    },
                    "backoff_factor": {
                      "type": "number",
                      "minimum": 0.1,
                      "maximum": 10.0,
                      "description": "Legacy alias for backoff_multiplier"
                    }
                  }
                }
              }
            }
          }
        },
        "openalex": {
          "type": "object",
          "required": ["name", "enabled", "http"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Source name identifier"
            },
            "enabled": {
              "type": "boolean"
            },
            "endpoint": {
              "type": "string",
              "description": "API endpoint path"
            },
            "params": {
              "type": "object",
              "description": "Default query parameters"
            },
            "pagination": {
              "type": "object",
              "properties": {
                "page_param": {
                  "type": "string",
                  "description": "Parameter name for page number"
                },
                "size_param": {
                  "type": "string",
                  "description": "Parameter name for page size"
                },
                "size": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 1000,
                  "description": "Default page size"
                },
                "max_pages": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Maximum number of pages to fetch"
                }
              }
            },
            "http": {
              "type": "object",
              "required": ["base_url"],
              "properties": {
                "base_url": {
                  "type": "string",
                  "format": "uri"
                },
                "timeout_sec": {
                  "type": "number",
                  "minimum": 1.0,
                  "maximum": 300.0,
                  "description": "HTTP timeout in seconds"
                },
                "headers": {
                  "type": "object",
                  "description": "HTTP headers for this source"
                },
                "rate_limit": {
                  "type": "object",
                  "properties": {
                    "max_calls": {
                      "type": "integer",
                      "minimum": 1,
                      "description": "Maximum calls per period"
                    },
                    "period": {
                      "type": "number",
                      "minimum": 0.1,
                      "description": "Rate limit period in seconds"
                    }
                  }
                },
                "retries": {
                  "type": "object",
                  "properties": {
                    "total": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 20,
                      "description": "Total number of retry attempts"
                    },
                    "max_tries": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 20,
                      "description": "Alias for total number of retry attempts"
                    },
                    "backoff_multiplier": {
                      "type": "number",
                      "minimum": 0.1,
                      "maximum": 10.0,
                      "description": "Backoff multiplier for exponential retry delay"
                    },
                    "backoff_factor": {
                      "type": "number",
                      "minimum": 0.1,
                      "maximum": 10.0,
                      "description": "Legacy alias for backoff_multiplier"
                    }
                  }
                }
              }
            }
          }
        },
        "pubmed": {
          "type": "object",
          "required": ["name", "enabled", "http"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Source name identifier"
            },
            "enabled": {
              "type": "boolean"
            },
            "endpoint": {
              "type": "string",
              "description": "API endpoint path"
            },
            "params": {
              "type": "object",
              "description": "Default query parameters"
            },
            "pagination": {
              "type": "object",
              "properties": {
                "page_param": {
                  "type": "string",
                  "description": "Parameter name for page number"
                },
                "size_param": {
                  "type": "string",
                  "description": "Parameter name for page size"
                },
                "size": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 1000,
                  "description": "Default page size"
                },
                "max_pages": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Maximum number of pages to fetch"
                }
              }
            },
            "http": {
              "type": "object",
              "required": ["base_url"],
              "properties": {
                "base_url": {
                  "type": "string",
                  "format": "uri"
                },
                "timeout_sec": {
                  "type": "number",
                  "minimum": 1.0,
                  "maximum": 300.0,
                  "description": "HTTP timeout in seconds"
                },
                "headers": {
                  "type": "object",
                  "description": "HTTP headers for this source"
                },
                "rate_limit": {
                  "type": "object",
                  "properties": {
                    "max_calls": {
                      "type": "integer",
                      "minimum": 1
                    },
                    "period": {
                      "type": "number",
                      "minimum": 0.1
                    }
                  }
                },
                "retries": {
                  "type": "object",
                  "properties": {
                    "total": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 20,
                      "description": "Total number of retry attempts"
                    },
                    "max_tries": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 20,
                      "description": "Alias for total number of retry attempts"
                    },
                    "backoff_multiplier": {
                      "type": "number",
                      "minimum": 0.1,
                      "maximum": 10.0,
                      "description": "Backoff multiplier for exponential retry delay"
                    },
                    "backoff_factor": {
                      "type": "number",
                      "minimum": 0.1,
                      "maximum": 10.0,
                      "description": "Legacy alias for backoff_multiplier"
                    }
                  }
                }
              }
            }
          }
        },
        "semantic_scholar": {
          "type": "object",
          "required": ["name", "enabled", "http"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Source name identifier"
            },
            "enabled": {
              "type": "boolean"
            },
            "endpoint": {
              "type": "string",
              "description": "API endpoint path"
            },
            "params": {
              "type": "object",
              "description": "Default query parameters"
            },
            "pagination": {
              "type": "object",
              "properties": {
                "page_param": {
                  "type": "string",
                  "description": "Parameter name for page number"
                },
                "size_param": {
                  "type": "string",
                  "description": "Parameter name for page size"
                },
                "size": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 1000,
                  "description": "Default page size"
                },
                "max_pages": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Maximum number of pages to fetch"
                }
              }
            },
            "http": {
              "type": "object",
              "required": ["base_url"],
              "properties": {
                "base_url": {
                  "type": "string",
                  "format": "uri"
                },
                "timeout_sec": {
                  "type": "number",
                  "minimum": 1.0,
                  "maximum": 300.0,
                  "description": "HTTP timeout in seconds"
                },
                "headers": {
                  "type": "object",
                  "description": "HTTP headers for this source"
                },
                "rate_limit": {
                  "type": "object",
                  "properties": {
                    "max_calls": {
                      "type": "integer",
                      "minimum": 1
                    },
                    "period": {
                      "type": "number",
                      "minimum": 0.1
                    }
                  }
                },
                "retries": {
                  "type": "object",
                  "properties": {
                    "total": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 20,
                      "description": "Total number of retry attempts"
                    },
                    "max_tries": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 20,
                      "description": "Alias for total number of retry attempts"
                    },
                    "backoff_multiplier": {
                      "type": "number",
                      "minimum": 0.1,
                      "maximum": 10.0,
                      "description": "Backoff multiplier for exponential retry delay"
                    },
                    "backoff_factor": {
                      "type": "number",
                      "minimum": 0.1,
                      "maximum": 10.0,
                      "description": "Legacy alias for backoff_multiplier"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "io": {
      "type": "object",
      "required": ["input", "output"],
      "properties": {
        "input": {
          "type": "object",
          "properties": {
            "documents_csv": {
              "type": "string",
              "description": "Path to input CSV file"
            }
          }
        },
        "output": {
          "type": "object",
          "required": ["data_path", "qc_report_path", "correlation_path"],
          "properties": {
            "data_path": {
              "type": "string",
              "description": "Path to main output data file"
            },
            "qc_report_path": {
              "type": "string",
              "description": "Path to QC report file"
            },
            "correlation_path": {
              "type": "string",
              "description": "Path to correlation analysis file"
            },
            "format": {
              "type": "string",
              "enum": ["csv", "parquet"],
              "description": "Output format"
            },
            "csv": {
              "type": "object",
              "properties": {
                "encoding": {
                  "type": "string",
                  "description": "CSV file encoding"
                },
                "float_format": {
                  "type": "string",
                  "description": "Float number format"
                },
                "date_format": {
                  "type": "string",
                  "description": "Date format string"
                },
                "line_terminator": {
                  "type": "string",
                  "description": "Line terminator character"
                },
                "na_rep": {
                  "type": "string",
                  "description": "Representation of missing values"
                }
              }
            },
            "parquet": {
              "type": "object",
              "properties": {
                "compression": {
                  "type": "string",
                  "description": "Parquet compression algorithm"
                }
              }
            },
            "dir": {
              "type": "string",
              "description": "Legacy alias for output directory path"
            }
          }
        }
      }
    },
    "runtime": {
      "type": "object",
      "required": ["workers"],
      "properties": {
        "workers": {
          "type": "integer",
          "minimum": 1,
          "maximum": 32,
          "description": "Number of worker threads"
        },
        "limit": {
          "type": ["integer", "null"],
          "minimum": 1,
          "description": "Maximum number of documents to process (null for unlimited)"
        },
        "date_tag": {
          "type": ["string", "null"],
          "pattern": "^\\d{8}$",
          "description": "Date tag in YYYYMMDD format (null for auto-generation)"
        },
        "dry_run": {
          "type": "boolean",
          "description": "Run without writing output files"
        }
      }
    },
    "logging": {
      "type": "object",
      "required": ["level"],
      "properties": {
        "level": {
          "type": "string",
          "enum": ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"],
          "description": "Logging level"
        }
      }
    },
    "validation": {
      "type": "object",
      "properties": {
        "strict": {
          "type": "boolean",
          "description": "Enable strict validation mode"
        },
        "qc": {
          "type": "object",
          "properties": {
            "max_missing_fraction": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Maximum allowed fraction of missing values"
            },
            "max_duplicate_fraction": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Maximum allowed fraction of duplicate values"
            },
            "min_fill_rate": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Legacy alias for (1 - max_missing_fraction)"
            }
          }
        }
      }
    },
    "determinism": {
      "type": "object",
      "properties": {
        "sort": {
          "type": "object",
          "properties": {
            "by": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Columns to sort by"
            },
            "ascending": {
              "oneOf": [
                {
                  "type": "boolean",
                  "description": "Sort all columns in ascending order"
                },
                {
                  "type": "array",
                  "items": {
                    "type": "boolean"
                  },
                  "description": "Sort order for each column"
                }
              ]
            },
            "na_position": {
              "type": "string",
              "enum": ["first", "last"],
              "description": "Position of null values in sort"
            }
          }
        },
        "column_order": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Column order for output"
        },
        "sort_order": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Legacy alias for sort.by"
        }
      }
    },
    "postprocess": {
      "type": "object",
      "properties": {
        "qc": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable QC report generation"
            },
            "enhanced": {
              "type": "boolean",
              "description": "Enable enhanced QC reporting with detailed metrics"
            }
          }
        },
        "correlation": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable correlation analysis"
            },
            "enhanced": {
              "type": "boolean",
              "description": "Enable enhanced correlation analysis with multiple correlation types"
            }
          }
        },
        "journal_normalization": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable journal name normalization"
            },
            "columns": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Columns to normalize"
            }
          }
        },
        "citation_formatting": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable citation formatting"
            },
            "columns": {
              "type": "object",
              "description": "Column mappings for citation formatting"
            }
          }
        }
      }
    },
    "transforms": {
      "type": "object",
      "properties": {
        "unit_conversion": {
          "type": "object",
          "description": "Unit conversion factors"
        }
      }
    }
  }
}
