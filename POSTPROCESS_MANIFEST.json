{
  "module": "documents",
  "source_tables": ["raw.documents", "raw.crossref", "raw.openalex", "raw.pubmed", "raw.semantic_scholar"],
  "postprocess_steps": [
    {
      "id": "P01_normalize_keys",
      "inputs": ["document_chembl_id", "doi", "document_pubmed_id"],
      "outputs": ["doi_key", "pmid_key"],
      "description": "Нормализация ключей DOI и PMID для дедупликации"
    },
    {
      "id": "P02_merge_bibliography", 
      "inputs": ["chembl_*", "crossref_*", "openalex_*", "pubmed_*", "semantic_scholar_*"],
      "outputs": ["merged_*"],
      "description": "Детерминированный merge метаданных из внешних источников"
    },
    {
      "id": "P03_dedupe_and_conflicts",
      "inputs": ["document_chembl_id", "doi_key", "pmid_key", "title"],
      "outputs": ["deduplicated_*", "conflict_log"],
      "description": "Удаление дублей и разрешение конфликтов метаданных"
    },
    {
      "id": "P04_enrich_fields",
      "inputs": ["journal", "year", "title", "volume", "issue", "first_page", "last_page"],
      "outputs": ["journal_normalized", "year_str", "title_norm", "document_citation"],
      "description": "Вычисление производных полей и нормализация"
    },
    {
      "id": "P05_qc_validation",
      "inputs": ["all_fields"],
      "outputs": ["valid_*", "invalid_*", "qc_report"],
      "description": "Валидация Pandera: типы, уникальность, диапазоны, not-null"
    },
    {
      "id": "P06_deterministic_export",
      "inputs": ["processed_data"],
      "outputs": ["documents.csv", "documents.parquet", "documents_meta.json"],
      "description": "Экспорт CSV/Parquet с фиксированным порядком колонок и строк"
    }
  ],
  "artifacts": {
    "intermediate": [
      "post/01_keys.parquet",
      "post/02_merged.parquet", 
      "post/03_resolved.parquet",
      "post/04_enriched.parquet",
      "post/05_validated.parquet"
    ],
    "final": [
      "out/documents.csv",
      "out/documents.parquet", 
      "out/documents_meta.json",
      "out/documents_quality_report.csv",
      "out/documents_correlation_report.csv"
    ]
  },
  "determinism": {
    "sorted_by": ["document_chembl_id", "doi_key"],
    "column_order": [
      "index",
      "document_chembl_id",
      "document_pubmed_id", 
      "document_classification",
      "referenses_on_previous_experiments",
      "original_experimental_document",
      "document_citation",
      "retrieved_at",
      "pubmed_mesh_descriptors",
      "pubmed_mesh_qualifiers", 
      "pubmed_chemical_list",
      "crossref_subject",
      "chembl_pmid",
      "crossref_pmid",
      "openalex_pmid", 
      "pubmed_pmid",
      "semantic_scholar_pmid",
      "chembl_title",
      "crossref_title",
      "openalex_title",
      "pubmed_article_title",
      "semantic_scholar_title",
      "chembl_abstract",
      "crossref_abstract",
      "openalex_abstract",
      "pubmed_abstract",
      "chembl_authors",
      "crossref_authors",
      "openalex_authors", 
      "pubmed_authors",
      "semantic_scholar_authors",
      "chembl_doi",
      "crossref_doi",
      "openalex_doi",
      "pubmed_doi",
      "semantic_scholar_doi",
      "chembl_doc_type",
      "crossref_doc_type",
      "openalex_doc_type",
      "openalex_crossref_doc_type",
      "pubmed_doc_type",
      "semantic_scholar_doc_type",
      "chembl_issn",
      "crossref_issn",
      "openalex_issn",
      "pubmed_issn",
      "semantic_scholar_issn",
      "chembl_journal",
      "crossref_journal",
      "openalex_journal",
      "pubmed_journal",
      "semantic_scholar_journal",
      "chembl_year",
      "crossref_year",
      "openalex_year",
      "pubmed_year",
      "chembl_volume",
      "crossref_volume",
      "openalex_volume",
      "pubmed_volume",
      "chembl_issue",
      "crossref_issue",
      "openalex_issue",
      "pubmed_issue",
      "crossref_first_page",
      "openalex_first_page",
      "pubmed_first_page",
      "crossref_last_page",
      "openalex_last_page",
      "pubmed_last_page",
      "chembl_error",
      "crossref_error",
      "openalex_error",
      "pubmed_error",
      "semantic_scholar_error",
      "pubmed_year_completed",
      "pubmed_month_completed",
      "pubmed_day_completed",
      "pubmed_year_revised",
      "pubmed_month_revised",
      "pubmed_day_revised",
      "valid_doi",
      "valid_journal",
      "valid_year",
      "valid_volume",
      "valid_issue",
      "invalid_doi",
      "invalid_journal",
      "invalid_year",
      "invalid_volume",
      "invalid_issue"
    ],
    "na_policy": {
      "string": "",
      "int": null,
      "float": null,
      "bool": null
    }
  },
  "cli": {
    "command": "etl documents postprocess",
    "options": [
      "--config PATH",
      "--output PATH", 
      "--qc-report PATH",
      "--format {csv,parquet}",
      "--fail-on-qc"
    ]
  },
  "logging": {
    "level": "INFO",
    "file": "logs/documents_post.log",
    "json": true
  }
}
