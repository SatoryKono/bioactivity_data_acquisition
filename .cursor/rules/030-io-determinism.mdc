---
description: Детерминированный IO: порядок колонок/строк, каноническая сериализация, атомарная запись
globs:
  - "src/**/*.py"
  - "bioetl/**/*.py"
  - "artifacts/**/*.csv"
  - "artifacts/**/*.parquet"
alwaysApply: false
tags: [io, determinism]
version: "1.0.0"
---

# context
Модули записи/чтения артефактов и кода, их порождающего.

# requirements
- ДОЛЖЕН явно задавать порядок колонок при записи таблиц и сортировать строки по ключам.
- ДОЛЖЕН сериализовать даты/время в UTC и ISO-8601.
- ДОЛЖЕН использовать temp-файл и os.replace для атомарности.
- НЕЛЬЗЯ пропускать столбцы молча при записи.

# examples
## valid
```py
cols = ["document_id","assay_id","value","unit"]
df = df[cols].sort_values(cols)
tmp = path.with_suffix(".tmp")
df.to_csv(tmp, index=False)
os.replace(tmp, path)
```
## invalid
```py
df.to_csv(path)  # порядок/UTC не зафиксированы
```
