# Vault Policy for BioETL Secrets

Эта политика описывает работу с секретами в HashiCorp Vault для всех
проектов BioETL. Документ определяет организацию пространств имён,
правила доступа, контроль версий и процессы аудита.

## 1. Пространства имён и пути хранения

- **Корневой префикс**: `bioetl/<environment>/`.
- **Среды**: `dev`, `staging`, `prod`.
- **Путь хранения**: `secret/data/bioetl/<environment>/secrets` для ключей,
  используемых пайплайнами и утилитами.
- **Формат значений**: JSON-объект с ключами верхнего уровня в верхнем
  регистре (`PUBMED_API_KEY`, `SEMANTIC_SCHOLAR_API_KEY`, и т.п.).

## 2. Минимизация привилегий

- Пайплайны и сервисные аккаунты получают отдельные роли Vault.
- Каждой роли разрешён только `read` выбранных секретов и запрещены операции
  `list` и `delete`.
- Доступ к среде `prod` выдаётся только участникам команды данных через
  группу `bioetl-prod-admin`.

## 3. Выдача и ротация токенов

- Пайплайны используют короткоживущие токены (TTL ≤ 1 час) с возможностью
  продления до 8 часов при длительных задачах.
- Ручные токены для разработчиков ограничены TTL ≤ 24 часов и не подлежат
  продлению.
- Ротация секретов выполняется минимум ежеквартально либо сразу после
  инцидента безопасности.

## 4. Аудит и журналирование

- Включён аудиторский лог Vault (`file` backend) с отправкой в центральный
  журнал безопасности.
- Все запросы `read`/`write` логируются и хранятся не менее 180 дней.
- Инциденты доступа анализируются в течение 24 часов с момента срабатывания
  алерта SIEM.

## 5. Онбординг и офбординг

- Онбординг разработчика требует подтверждения руководителя команды и
  назначения роли `bioetl-dev`.
- Перед офбордингом выполняется отзыв всех активных токенов и пересмотр
  секретов, с которыми работал сотрудник.

## 6. Интеграция с CI/CD

- GitHub Actions используют OIDC для получения временных токенов Vault.
- Токены ограничены ролью `bioetl-ci` и имеют доступ только к `dev` или
  `staging` секретам.
- Запуск `detect-secrets` в CI блокирует случайное попадание секретов в
  репозиторий, а pre-commit хуки делают то же самое локально.

## 7. Тестовые окружения

- Для локальной разработки разрешено временно хранить секреты в `.env`
  файлах, полученных из Vault, с обязательным включением в `.gitignore`.
- Шаблоны `.env.*.template` хранятся в `configs/templates/` и служат только
  документированием ожидаемых переменных.

## 8. Управление инцидентами

- После обнаружения утечки секрет немедленно отзывается и заменяется.
- Проводится RCA с фиксацией в системе тикетов.
- Вносятся обновления в политику или автоматические проверки, если инцидент
  выявил пробелы в контролях.

Эта политика пересматривается ежеквартально командой безопасности и команды
данных BioETL.
