# Data sources

Минимальная информация по источникам и типовым ограничениям.

## ChEMBL

- Базовый URL: <https://www.ebi.ac.uk/chembl/api/data>
- Типовые ограничения: страничная пагинация, возможные 5xx/429

## Crossref

- Базовый URL: <https://api.crossref.org/works>
- Токен: заголовок `Crossref-Plus-API-Token`

## OpenAlex

- Базовый URL: <https://api.openalex.org/works>

## PubMed

- Базовый URL: <https://eutils.ncbi.nlm.nih.gov/entrez/eutils/>
- Ключ `api_key` повышает лимиты RPS

## Semantic Scholar

- Базовый URL: <https://api.semanticscholar.org/graph/v1/paper>
- Строгие лимиты без API‑ключа; рекомендуется ключ `x-api-key`

См. также: api-limits.md и docs/operations.md для скриптов мониторинга и интерпретации отчётов.
**Лимиты:**

- RPS: ≤3 запроса в секунду
- Бюджет: ≤30,000 запросов в день
- TTL кэша: 14 дней

**Особенности:**

- Обогащение данных о мишенях
- Приоритет reviewed > unreviewed
- Нормализация UniProt ID (удаление суффиксов -1, -2)
- Маппинг на organism

### IUPHAR/Guide to Pharmacology

**Описание:** База данных фармакологических мишеней  
**URL:** <https://www.guidetopharmacology.org>  
**Тип данных:** Фармакологические мишени

**Лимиты:**

- RPS: ≤2 запроса в секунду
- Бюджет: ≤10,000 запросов в день
- TTL кэша: 14 дней

**Особенности:**

- Дополнительная информация о мишенях
- Фармакологическая классификация
- Связи с лекарствами

### Crossref

**Описание:** Реестр DOI и метаданных публикаций  
**URL:** <https://api.crossref.org>  
**Тип данных:** Метаданные публикаций

**Лимиты:**

- RPS: ≤3 запроса в секунду
- Бюджет: ≤30,000 запросов в день
- TTL кэша: 7 дней

**Особенности:**

- Обогащение документов
- Валидация DOI
- Восстановление года публикации
- Приоритет в конфликт-резолюции: PubMed > Crossref > OpenAlex > Semantic Scholar

### PubMed

**Описание:** База данных медицинских публикаций  
**URL:** <https://eutils.ncbi.nlm.nih.gov>  
**Тип данных:** Метаданные публикаций

**Лимиты:**

- RPS: ≤3 запроса в секунду
- Бюджет: ≤50,000 запросов в день
- TTL кэша: 7 дней

**Особенности:**

- Высший приоритет в конфликт-резолюции
- PMID идентификаторы
- Медицинская специфика

### OpenAlex

**Описание:** Открытая база научных публикаций  
**URL:** <https://api.openalex.org>  
**Тип данных:** Метаданные публикаций

**Лимиты:**

- RPS: ≤3 запроса в секунду
- Бюджет: ≤30,000 запросов в день
- TTL кэша: 7 дней

**Особенности:**

- Открытые данные
- Широкое покрытие
- Альтернативный источник метаданных

### Semantic Scholar

**Описание:** Семантический поиск научных публикаций  
**URL:** <https://api.semanticscholar.org>  
**Тип данных:** Метаданные публикаций

**Лимиты:**

- RPS: ≤3 запроса в секунду
- Бюджет: ≤30,000 запросов в день
- TTL кэша: 7 дней

**Особенности:**

- Семантический анализ
- AI-powered поиск
- Низший приоритет в конфликт-резолюции

### PubChem

**Описание:** База данных химических соединений  
**URL:** <https://pubchem.ncbi.nlm.nih.gov/rest/pug>  
**Тип данных:** Химические данные молекул

**Лимиты:**

- RPS: ≤5 запросов в секунду
- Бюджет: ≤50,000 запросов в день
- TTL кэша: 7 дней

**Особенности:**

- Обогащение данных о молекулах
- Химические свойства
- SMILES валидация

## Мониторинг и отчётность

### API Usage Report

Отчёт об использовании API сохраняется в `outputs/qa/api_usage.report.json`:

```json
{
  "source": "chembl",
  "calls_used": 15000,
  "budget": 100000,
  "rps_peak": 4.2,
  "rps_95p": 3.8,
  "retries_total": 45,
  "http_2xx": 14950,
  "http_4xx": 30,
  "http_5xx": 20,
  "http_429": 5
}
```

### Пороговые значения

**Красные зоны:**

- ≥90% использования бюджета — предупреждение
- >100% использования бюджета — ошибка
- 4xx ошибки — немедленная ошибка
- 5xx/429 ошибки — ошибка после ретраев

### Кэширование

**Стратегия кэширования:**

- Ключ: `SHA256(base_url + "?" + normalized_query)`
- Для POST: хеш отсортированного JSON
- Цель: `cache_hit_rate ≥ 95%`

**TTL по источникам:**

- ChEMBL: 1 день
- PubMed/Crossref/OpenAlex/Semantic Scholar: 7 дней
- UniProt/IUPHAR: 14 дней
- PubChem: 7 дней

## Настройка источников

### Конфигурация

```yaml
sources:
  chembl:
    base_url: "https://www.ebi.ac.uk/chembl/api/data"
    timeout: 60
    retries: 3
    rate_limit: 5  # RPS
    budget: 100000  # запросов в день
  
  uniprot:
    base_url: "https://rest.uniprot.org"
    timeout: 45
    retries: 3
    rate_limit: 3
    budget: 30000
  
  crossref:
    base_url: "https://api.crossref.org"
    timeout: 30
    retries: 3
    rate_limit: 3
    budget: 30000
    api_key: null  # опционально
```

### Переменные окружения

```bash
# API ключи (если требуются)
export BIOACTIVITY__SOURCES__CROSSREF__API_KEY=your_key
export BIOACTIVITY__SOURCES__OPENALEX__API_KEY=your_key

# Переопределение лимитов
export BIOACTIVITY__SOURCES__CHEMBL__RATE_LIMIT=3
export BIOACTIVITY__SOURCES__CHEMBL__BUDGET=50000
```

## Обработка ошибок

### Ретраи

**Стратегия ретраев:**

- 5xx/сеть: до 3 попыток
- 429 (Rate Limited): до 5 попыток
- Backoff: `t_k = min(2^k, 60)s` с jitter ±10%

### Тайм-ауты

- Connect: 5 секунд
- Read: 20 секунд
- Total: 25 секунд

### Параллелизм

- ≤8 запросов на источник
- ≤24 запросов глобально

## Лучшие практики

### Эффективное использование

1. **Используйте кэширование** — повторные запросы в пределах TTL
2. **Соблюдайте лимиты** — мониторьте RPS и бюджеты
3. **Обрабатывайте ошибки** — логируйте и ретрайте при необходимости
4. **Батчируйте запросы** — группируйте связанные запросы

### Мониторинг

1. **Проверяйте отчёты** — `outputs/qa/api_usage.report.json`
2. **Следите за логами** — ошибки и предупреждения
3. **Мониторьте кэш** — hit rate должен быть ≥95%
4. **Проверяйте бюджеты** — не превышайте дневные лимиты

### Отладка

1. **Включите DEBUG логирование** для детальной информации
2. **Проверяйте HTTP статусы** в отчётах
3. **Анализируйте ретраи** — частые ретраи указывают на проблемы
4. **Проверяйте кэш** — низкий hit rate может указывать на проблемы

## Связанные документы

- [Конфигурация](reference/configuration/index.md)
- [CLI](reference/cli/index.md)
- [Пайплайны](pipelines/documents.md)
- [FAQ](faq.md)
