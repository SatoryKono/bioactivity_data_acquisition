# Git LFS Workflow для больших бинарных файлов

## Обзор

Этот репозиторий настроен для использования Git Large File Storage (LFS) для отслеживания больших бинарных файлов (>500KB). Git LFS позволяет эффективно работать с большими файлами, не засоряя основную историю Git.

## Настройка Git LFS

### Первоначальная настройка (уже выполнена)

```bash
# Установка Git LFS (выполнено)
git lfs install

# Файл .gitattributes уже создан и зафиксирован
```

### Проверка статуса

```bash
# Проверить, какие файлы отслеживаются Git LFS
git lfs ls-files

# Проверить статус Git LFS
git lfs status
```

## Отслеживаемые форматы файлов

Следующие типы файлов автоматически отслеживаются Git LFS:

### Форматы данных
- `*.parquet` - Apache Parquet файлы
- `*.pkl`, `*.pickle` - Python pickle файлы
- `*.h5`, `*.hdf5` - HDF5 файлы
- `*.joblib` - Joblib сериализованные файлы

### Excel файлы
- `*.xlsm` - Excel с макросами
- `*.xlsx` - Excel файлы
- `*.xls` - Старые Excel файлы

### Медиа файлы
- `*.png`, `*.jpg`, `*.jpeg` - Изображения
- `*.gif`, `*.bmp`, `*.tiff`, `*.svg` - Другие форматы изображений
- `*.mp4`, `*.avi`, `*.mov`, `*.mkv` - Видео файлы
- `*.mp3`, `*.wav`, `*.flac` - Аудио файлы

### Архивы и базы данных
- `*.zip`, `*.tar.gz`, `*.7z`, `*.rar` - Архивы
- `*.db`, `*.sqlite`, `*.sqlite3` - Базы данных

### Документы
- `*.pdf` - PDF документы

### Большие текстовые файлы
- `*.json`, `*.csv`, `*.tsv`, `*.xml` - Структурированные данные
- `*.log` - Лог файлы

## Рабочий процесс

### Добавление новых больших файлов

1. **Автоматическое отслеживание**: Файлы, соответствующие паттернам в `.gitattributes`, автоматически отслеживаются Git LFS при добавлении.

```bash
# Добавить файл (автоматически будет отслежен LFS если соответствует паттерну)
git add large_dataset.parquet
git commit -m "Add large dataset"
```

2. **Ручное добавление паттерна** (если нужно):

```bash
# Добавить новый тип файла в .gitattributes
echo "*.newformat filter=lfs diff=lfs merge=lfs -text" >> .gitattributes
git add .gitattributes
git commit -m "Add LFS tracking for .newformat files"
```

### Миграция существующих файлов

⚠️ **Внимание**: Миграция существующих файлов требует осторожности и может повлиять на историю Git.

```bash
# 1. Найти большие файлы в истории
git rev-list --objects --all | git cat-file --batch-check='%(objecttype) %(objectname) %(objectsize) %(rest)' | awk '/^blob/ {print substr($0,6)}' | sort --numeric-sort --key=2 | tail -10

# 2. Мигрировать конкретный файл (ОСТОРОЖНО!)
git lfs migrate import --include="*.parquet" --everything

# 3. Принудительно обновить удаленный репозиторий (ОСТОРОЖНО!)
git push --force-with-lease origin main
```

### Работа с командой

```bash
# Клонирование репозитория с LFS файлами
git clone <repository-url>
git lfs pull

# Обновление LFS файлов
git lfs pull

# Проверка целостности LFS файлов
git lfs fsck
```

## Рекомендации

### Когда использовать Git LFS

✅ **Используйте Git LFS для:**
- Файлов данных >500KB
- Моделей машинного обучения
- Больших датасетов
- Медиа файлов
- Архивов

❌ **НЕ используйте Git LFS для:**
- Исходного кода
- Конфигурационных файлов
- Документации (Markdown, текстовые файлы)
- Небольших файлов (<500KB)

### Лучшие практики

1. **Планируйте заранее**: Настройте `.gitattributes` до добавления больших файлов
2. **Используйте .gitignore**: Исключайте временные и промежуточные файлы
3. **Документируйте**: Указывайте в README, какие файлы требуют LFS
4. **Мониторьте размер**: Регулярно проверяйте размер репозитория

### Ограничения

- **Размер файла**: GitHub ограничивает LFS файлы до 2GB
- **Квота**: GitHub предоставляет 1GB бесплатного LFS хранилища
- **Производительность**: LFS файлы загружаются по требованию

## Устранение неполадок

### Проблемы с загрузкой LFS файлов

```bash
# Переустановить LFS
git lfs uninstall
git lfs install

# Очистить кэш LFS
git lfs prune

# Принудительно загрузить все LFS файлы
git lfs pull --all
```

### Проверка статуса

```bash
# Проверить, какие файлы должны быть в LFS
git lfs ls-files

# Проверить, какие файлы фактически в LFS
git lfs status

# Проверить конфигурацию LFS
git lfs env
```

## Связанные документы

- [Git LFS официальная документация](https://git-lfs.github.io/)
- [GitHub LFS документация](https://docs.github.com/en/repositories/working-with-files/managing-large-files)
- [План развития репозитория - Stage 10](../archive/REFORM_PLAN.md)

---

**Примечание**: Этот документ соответствует Stage 10 плана развития репозитория и обеспечивает подготовку к работе с большими бинарными активами.
