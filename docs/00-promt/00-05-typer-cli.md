Роль и режим работы

Ты — системный аналитик ETL и разработчик. Работаешь строго по содержимому ветки test_refactoring_32 репозитория bioactivity_data_acquisition. Никаких внешних предположений. Источник истины — только файлы репозитория. Все ссылки в тексте оформляй строго так:

[ref: repo:

Обязательные источники

[ref: repo:README.md@refactoring_001] ← быстрый старт и примеры команд python -m bioetl.cli.main list|activity|assay|... (см. блок Quick Start). GitHub

[ref: repo:src/bioetl/cli/app.py@refactoring_001] ← определение Typer-приложения, регистрация команд и опций.

[ref: repo:docs/cli/CLI.md@refactoring_001] ← базовая точка для связки с новой страницей CLI (README прямо на неё ссылается). GitHub

При необходимости: [ref: repo:src/bioetl/configs/models.py@refactoring_001], [ref: repo:docs/configs/CONFIGS.md@refactoring_001] для описания загрузки профилей (base.yaml, determinism.yaml), на что указывает README. GitHub

Задача

Подготовь полноценную спецификацию и справочник по Typer-CLI: «реестр пайплайнов, команды, флаги, профили окружений, коды возврата, формат ошибок/логов и примеры». Документ должен быть самодостаточным: по нему можно понять, какие команды есть, как они регистрируются, какие параметры обязательны, как подключаются профили, что возвращают коды завершения, и как выглядит вывод в --dry-run.

Что нужно выдать

Сформируй два файла Markdown:

docs/cli/00-cli-overview.md — обзор и принципы

docs/cli/01-cli-commands.md — детальная справка по командам

Оба файла связаны из [ref: repo:docs/cli/CLI.md@refactoring_001] и из оглавления docs/INDEX.md.

Структура содержимого A. 00-cli-overview.md

Назначение CLI и область применения. Ссылка на каркас стадий пайплайна (extract → transform → validate → write → run) из README. Укажи, что CLI — фронт к PipelineBase и к конфиг-моделям. GitHub

Архитектура: единое Typer-приложение, реестр команд, как команды находят соответствующий пайплайн. Ссылки на исходники регистрации: [ref: repo:src/bioetl/cli/app.py@refactoring_001].

Профили конфигураций: порядок мерджа base.yaml + determinism.yaml, откуда берутся пути, как приоритеты влияют на выполнение. Приведи точную логику загрузки по коду. GitHub

Логирование и формат вывода: где включается --dry-run, какой формат логов по умолчанию, где хранятся артефакты и meta.yaml.

Среды/окружения: dev/test/prod настройки, если различаются в коде/конфигах.

Стандарты ошибок и коды возврата: политика exit codes для успешного прогона, валидационных ошибок, ошибок конфигурации, сетевых сбоев и «неизвестной» ошибки.

B. 01-cli-commands.md

Команда list

Назначение: показать зарегистрированные пайплайны и их алиасы.

Формат: python -m bioetl.cli.main list (пример есть в README). Обязательные и опциональные флаги. GitHub

Пример вывода и коды возврата.

Команды пайплайнов: activity, assay, target, document, testitem Для каждой команды оформи одинаковый шаблон:

Синопсис:

python -m bioetl.cli.main

Описание стадий, которые выполняются при --dry-run и при обычном запуске.

Параметры: обязательные/опциональные, типы, значения по умолчанию, поведение при конфликте флагов и профилей.

Примеры запуска из README адаптировать и расширить (минимальный, полный, --dry-run, с профилем детерминизма). GitHub

Коды возврата и типовые сообщения об ошибках.

Где лежат артефакты вывода и meta.yaml.

Вспомогательные команды/флаги, если есть в app.py

Версия, автодополнение, отладочные флаги, уровни логирования.

Любые «скрытые» или внутренние команды задокументируй отдельно с пометкой INTERNAL.

Таблица совместимости флагов

Матрица «флаг → команды, где поддержан» и «взаимоисключающие флаги».

Контракты вывода

Что именно гарантируется на stdout/stderr.

Формат JSON-вывода, если предусмотрен в коде.

Инварианты --dry-run: отсутствие побочных эффектов, валидация конфигурации и схем.

Тест-план CLI

Golden-тесты примеров помощи (--help) и синопсисов.

Интеграционный тест list проверяет, что зарегистрированные команды совпадают с теми, что задокументированы.

Жёсткие требования (MUST)

Используй только данные из ветки test_refactoring_32.

Все ссылки внутри файлов в формате [ref: repo:

Приведи минимум по одному рабочему примеру команды для каждого пайплайна из реальных путей в репозитории (как в README Quick Start). GitHub

Зафиксируй точные имена флагов, алиасов и коды возврата в строгих таблицах, сверяясь с [ref: repo:src/bioetl/cli/app.py@refactoring_001].

Опиши логику подключения профилей (base.yaml, determinism.yaml) и их приоритет. GitHub

Форматирование

Язык: русский.

Маркдауны с короткими код-блоками и таблицами, без лишней воды.

Примеры запуска — копируемые, многострочные со слэшами на переносах.

Разделы «Назначение», «Синопсис», «Флаги», «Примеры», «Коды возврата», «Ошибки».