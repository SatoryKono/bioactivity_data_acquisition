# Устранение неполадок

## Обзор

Руководство по устранению типичных проблем при работе с проектом Bioactivity Data Acquisition.

## Проблемы с установкой

### Ошибки зависимостей

**Проблема:** Ошибки при установке пакетов

**Решение:**
```bash
# Обновите pip
pip install --upgrade pip

# Очистите кэш
pip cache purge

# Переустановите зависимости
pip install -r requirements.txt --force-reinstall
```

### Проблемы с Git LFS

**Проблема:** Файлы не загружаются через Git LFS

**Решение:**
```bash
# Установите Git LFS
git lfs install

# Загрузите файлы
git lfs pull

# Проверьте статус
git lfs status
```

## Проблемы с API

### Rate Limiting

**Проблема:** Ошибки 429 Too Many Requests

**Решение:**
- Увеличьте задержки в конфигурации
- Используйте API ключи для увеличения лимитов
- Запустите пайплайн с меньшим количеством воркеров

### Недоступность API

**Проблема:** API недоступен

**Решение:**
- Проверьте интернет-соединение
- Убедитесь в корректности API ключей
- Проверьте статус API провайдера
- Используйте fallback источники данных

## Проблемы с данными

### Неполные данные

**Проблема:** Много NULL значений в выходных данных

**Решение:**
- Проверьте качество входных данных
- Убедитесь в доступности всех источников
- Проверьте маппинги полей
- Настройте валидацию для допустимых долей пропущенных значений

### Дубликаты

**Проблема:** Дубликаты в выходных данных

**Решение:**
- Проверьте логику дедупликации
- Убедитесь в корректности ключей для определения дубликатов
- Проверьте источники данных на дубликаты

## Проблемы с производительностью

### Медленная работа

**Проблема:** Пайплайн работает медленно

**Решение:**
- Увеличьте количество воркеров
- Оптимизируйте запросы к API
- Используйте кэширование
- Проверьте сетевые задержки

### Проблемы с памятью

**Проблема:** Нехватка памяти

**Решение:**
- Уменьшите размер батчей
- Используйте потоковую обработку
- Очистите промежуточные файлы
- Увеличьте лимиты памяти

## Проблемы с конфигурацией

### Неверная конфигурация

**Проблема:** Ошибки валидации конфигурации

**Решение:**
- Проверьте синтаксис YAML
- Убедитесь в корректности путей к файлам
- Проверьте обязательные параметры
- Используйте примеры конфигураций

### Переменные окружения

**Проблема:** Переменные окружения не загружаются

**Решение:**
- Проверьте файл `.env`
- Убедитесь в корректности синтаксиса
- Проверьте права доступа к файлу
- Перезапустите приложение

## Проблемы с логированием

### Отсутствие логов

**Проблема:** Логи не создаются

**Решение:**
- Проверьте настройки логирования
- Убедитесь в правах на запись в директорию логов
- Проверьте уровень логирования
- Убедитесь в корректности путей

### Слишком много логов

**Проблема:** Логи занимают много места

**Решение:**
- Настройте ротацию логов
- Увеличьте уровень логирования
- Очистите старые логи
- Настройте сжатие логов

## Получение помощи

### Логи и отчёты

При обращении за помощью предоставьте:
- Полные логи выполнения
- Конфигурационный файл
- Описание проблемы
- Шаги для воспроизведения

### Отладка

Для отладки используйте:
- Режим `dry_run`
- Увеличенный уровень логирования
- Тестовые конфигурации
- Пошаговое выполнение пайплайна

## Отладочные скрипты

Для диагностики и отладки доступны специальные скрипты в директории `scripts/dev/`:

### Основные отладочные инструменты

- **`check_columns.py`** — проверка структуры и заполненности колонок в CSV файлах
- **`check_field_fill.py`** — анализ заполненности полей в данных
- **`check_specific_limits.py`** — проверка специфических лимитов API
- **`check_version_consistency.py`** — проверка консистентности версий

### Тестовые скрипты

В директории `tests/` находятся временные тестовые скрипты для отладки:

- **`test_assay_types.py`** — тестирование различных типов ассев
- **`test_final_fix.py`** — финальные исправления и тесты
- **`test_fix.py`** — базовые исправления
- **`test_multiple_assay_types.py`** — тестирование множественных типов ассев
- **`test_separate_queries.py`** — тестирование раздельных запросов
- **`test_variant_assays.py`** — тестирование вариантов ассев
- **`test_variant_profile.py`** — тестирование профилей вариантов

### Использование отладочных скриптов

```bash
# Проверка структуры данных
python scripts/dev/check_columns.py data/input/documents.csv

# Анализ заполненности полей
python scripts/dev/check_field_fill.py data/output/activity_20241201.csv

# Запуск тестовых скриптов
python tests/test_assay_types.py
```

**Примечание:** Отладочные скрипты предназначены для разработки и диагностики. Не используйте их в продакшене без предварительного тестирования.