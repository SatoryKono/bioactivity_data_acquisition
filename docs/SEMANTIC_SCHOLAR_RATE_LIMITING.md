# Semantic Scholar Rate Limiting - Руководство по решению

## Проблема

Semantic Scholar API имеет очень строгие ограничения на количество запросов без API ключа:
- **Без API ключа**: ~1 запрос в минуту
- **С API ключом**: до 100 запросов в минуту

## Ошибка

```
rate limited: rate limited by api (status 429). message: {"message": "too many requests. please wait and try again or apply for a key for higher rate limits. https://www.semanticscholar.org/product/api#api-key-form", "code": "429"}
```

## Решения

### 1. Получить API ключ (Рекомендуется)

1. Перейдите на страницу запроса API ключа:
   https://www.semanticscholar.org/product/api#api-key-form

2. Заполните форму запроса API ключа

3. После получения ключа добавьте его в конфигурацию:
   ```yaml
   sources:
     semantic_scholar:
       headers:
         x-api-key: "ваш_api_ключ_здесь"
   ```

### 2. Отключить Semantic Scholar

Если API ключ недоступен, отключите Semantic Scholar в конфигурации:

```yaml
sources:
  semantic_scholar:
    enabled: false
```

### 3. Использовать консервативные настройки

Текущие настройки уже оптимизированы для работы без API ключа:
- 65 секунд задержки между запросами
- Дополнительные 30 секунд после завершения
- Специальная fallback стратегия с длинными задержками

## Улучшения в коде

### 1. Специальная fallback стратегия
- Создана `SemanticScholarFallbackStrategy` с консервативными настройками
- Очень длинные задержки для rate limiting (2-5 минут)
- Минимальное количество повторных попыток

### 2. Улучшенная обработка ошибок
- Специальные сообщения для rate limiting ошибок
- Информативные сообщения о том, как получить API ключ
- Продолжение работы с другими источниками при ошибках

### 3. Адаптивные задержки
- 65 секунд между запросами (чуть больше минуты)
- Дополнительные 30 секунд после завершения обработки
- Информативные сообщения о задержках

## Мониторинг

Система автоматически логирует:
- Количество успешных запросов
- Ошибки rate limiting
- Рекомендации по получению API ключа

## Рекомендации

1. **Для разработки**: Отключите Semantic Scholar или получите API ключ
2. **Для продакшена**: Обязательно получите API ключ
3. **Для больших датасетов**: Рассмотрите возможность пакетной обработки

## Альтернативы

Если Semantic Scholar недоступен, система будет использовать данные из других источников:
- ChEMBL
- Crossref  
- OpenAlex
- PubMed

Все эти источники имеют более мягкие ограничения на rate limiting.
