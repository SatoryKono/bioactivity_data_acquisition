# Repository Topology

Этот раздел описывает слоистую структуру репозитория `bioetl` и правила работы с артефактами.

## Слои репозитория

### `src/`
Основной прикладной код фреймворка и пайплайнов. Директория разбита на модули с
типовыми интерфейсами (клиенты источников, нормализаторы, пайплайны). Все
реализации обязаны следовать контрактам, описанным в `docs/etl_contract/` и
`docs/pipelines/`. Подсистема `bioetl.cli` подчиняется строгим правилам
зависимостей: модули CLI не импортируют `requests` и его исключения, вместо
этого используют адаптационный слой `bioetl.clients.exceptions`. Конфигурационные
модели CLI всегда подтягиваются из подпакетов `bioetl.config.models.*`, чтобы
гарантировать единый источник правды для типизированных настроек.

### `tests/`
Юнит-, интеграционные и golden-тесты располагаются в `tests/bioetl/`. Структура
зеркалирует модули из `src/`, что упрощает навигацию и поиск примеров
использования. Фикстуры и общие утилиты тестов собраны в `tests/bioetl/conftest.py`
и подпакете `tests/bioetl/unit/utils`.

### `configs/`
Типизированные конфигурации и профили, описанные в
[`docs/configs/00-typed-configs-and-profiles.md`](configs/00-typed-configs-and-profiles.md).
Каталог содержит Pydantic-модели, схемы конфигураций и материалы для генерации
документации. Конфиги являются источником правды для параметров пайплайнов и
всегда синхронизируются с документацией через CI.

### `data/`
Каталог для артефактов, необходимых в процессе разработки: локальные заглушки
источников, подготовленные фикстуры и golden-снепшоты, если они не генерируются
динамически. Большие производственные выгрузки и приватные данные в репозиторий
не добавляются. Для воспроизводимых примеров используйте небольшие
детерминированные выборки.

### `scripts/`
Скрипты обслуживания: вспомогательные утилиты CLI, миграции, средства анализа
и диагностики. Все скрипты должны быть идемпотентны и документированы в
`docs/cli/` или соответствующих технических разделах. Конфигурация запуска
определяется через профили в `configs/`.

### `.cache/`
Локальный кэш промежуточных файлов (например, результаты HTTP-запросов или
прекомпилированные артефакты), используемый для ускорения разработки. Каталог
исключён из коммитов и CI; артефакты здесь недолговечны и могут быть безопасно
удалены.

## Источники правды

- **Конфигурации**: описываются в `configs/` и документации раздела `docs/configs/`;
  изменения проходят через код-ревью и валидируются CI.
- **Секреты**: хранятся во внешнем секрет-менеджере (Vault) и доставляются через
  переменные окружения. Локальные шаблоны (`.env.key.template`) остаются пустыми
  и служат лишь ориентирами. Подробности — в README.md и в разделе
  [`Secrets and Configuration`](styleguide/09-secrets-config.md).
- **Документация**: каталог `docs/` содержит каноничные описания архитектуры,
  контрактов и процессов. Любые изменения архитектуры сопровождаются правками в
  соответствующих разделах и проверяются пайплайном `Documentation`.

## Размещение артефактов

1. **Долгоживущие артефакты** (схемы, стабильные фикстуры) размещаются в
   поддиректориях `data/` или `tests/bioetl/` и должны быть детерминированы.
2. **Временные и крупные артефакты** сохраняются в `.cache/` или внешнем хранилище
   (S3, GCS). Такие данные не коммитятся и очищаются перед публикацией.
3. **Сгенерированные отчёты и документация** публикуются через CI в GitHub Pages;
   локально их можно хранить в `site/`, который исключён из репозитория.
4. **Секреты и ключи доступа** никогда не размещаются в репозитории. Используйте
   переменные окружения и интеграцию Vault, описанную в `README.md`.
